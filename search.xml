<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ·±å…¥ç†è§£JSå¼‚æ­¥</title>
      <link href="/2019/10/30/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JS%E5%BC%82%E6%AD%A5/"/>
      <url>/2019/10/30/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JS%E5%BC%82%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/wangfupeng1988" target="_blank" rel="noopener">æœ¬æ–‡å‡ºè‡ª</a></p><h2 id="ä»€ä¹ˆæ˜¯å¼‚æ­¥"><a href="#ä»€ä¹ˆæ˜¯å¼‚æ­¥" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼‚æ­¥"></a>ä»€ä¹ˆæ˜¯å¼‚æ­¥</h2><h3 id="JS-ä¸ºä½•ä¼šæœ‰å¼‚æ­¥"><a href="#JS-ä¸ºä½•ä¼šæœ‰å¼‚æ­¥" class="headerlink" title="JS ä¸ºä½•ä¼šæœ‰å¼‚æ­¥"></a>JS ä¸ºä½•ä¼šæœ‰å¼‚æ­¥</h3><p>é¦–å…ˆè®°ä½ä¸€å¥è¯ â€”â€” <strong>JS æ˜¯å•çº¿ç¨‹çš„è¯­è¨€</strong>ï¼Œæ‰€è°“â€œå•çº¿ç¨‹â€å°±æ˜¯ä¸€æ ¹ç­‹ï¼Œå¯¹äºæ‹¿åˆ°çš„ç¨‹åºï¼Œä¸€è¡Œä¸€è¡Œçš„æ‰§è¡Œï¼Œä¸Šé¢çš„æ‰§è¡Œä¸ºå®Œæˆï¼Œå°±å‚»å‚»çš„ç­‰ç€ã€‚ä¾‹å¦‚</p><pre><code>var i, t = Date.now()for (i = 0; i &lt; 100000000; i++) {}console.log(Date.now() - t)  // 308 ï¼ˆchromeæµè§ˆå™¨ï¼‰</code></pre><p>ä¸Šé¢çš„ç¨‹åºèŠ±è´¹ 308ms çš„æ—¶é—´æ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å°±ä¼šæœ‰å¡é¡¿ï¼Œå…¶ä»–çš„äº‹å„¿å°±å…ˆæ’‚ä¸€è¾¹ä¸ç®¡äº†ã€‚</p><p>æ‰§è¡Œç¨‹åºè¿™æ ·æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¯¹äº JS æœ€åˆä½¿ç”¨çš„ç¯å¢ƒ â€”â€”â€”â€” æµè§ˆå™¨å®¢æˆ·ç«¯ â€”â€”â€”â€” å°±ä¸ä¸€æ ·äº†ã€‚å› æ­¤åœ¨æµè§ˆå™¨ç«¯è¿è¡Œçš„ js ï¼Œå¯èƒ½ä¼šæœ‰å¤§é‡çš„ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸€ä¸ªç½‘ç»œèµ„æºå•¥æ—¶å€™è¿”å›ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ä¸å¯é¢„ä¼°çš„ã€‚è¿™ç§æƒ…å†µä¹Ÿè¦å‚»å‚»çš„ç­‰ç€ã€å¡é¡¿ç€ã€å•¥éƒ½ä¸åšå—ï¼Ÿâ€”â€”â€”â€” é‚£è‚¯å®šä¸è¡Œã€‚</p><p>å› æ­¤ï¼ŒJS å¯¹äºè¿™ç§åœºæ™¯å°±è®¾è®¡äº†å¼‚æ­¥ â€”â€”â€”â€” å³ï¼Œ<strong>å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå°±å…ˆä¸ç®¡è¿™è¾¹äº†ï¼Œå…ˆå¹²å…¶ä»–äº‹å„¿ï¼Œç½‘ç»œè¯·æ±‚å•¥æ—¶å€™è¿”å›ç»“æœï¼Œåˆ°æ—¶å€™å†è¯´</strong>ã€‚è¿™æ ·å°±èƒ½ä¿è¯ä¸€ä¸ªç½‘é¡µçš„æµç¨‹è¿è¡Œã€‚</p><h3 id="å¼‚æ­¥çš„å®ç°åŸç†"><a href="#å¼‚æ­¥çš„å®ç°åŸç†" class="headerlink" title="å¼‚æ­¥çš„å®ç°åŸç†"></a>å¼‚æ­¥çš„å®ç°åŸç†</h3><p>å…ˆçœ‹ä¸€æ®µæ¯”è¾ƒå¸¸è§çš„ä»£ç </p><pre><code>var ajax = $.ajax({    url: &#39;/data/data1.json&#39;,    success: function () {        console.log(&#39;success&#39;)    }})</code></pre><p>ä¸Šé¢ä»£ç ä¸­<code>$.ajax()</code>éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°è¿›å»ï¼Œurlå’Œsuccessï¼Œå…¶ä¸­urlæ˜¯è¯·æ±‚çš„è·¯ç”±ï¼Œsuccessæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚<strong>è¿™ä¸ªå‡½æ•°ä¼ é€’è¿‡å»ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰ç€è¯·æ±‚æˆåŠŸä¹‹åæ‰èƒ½æ‰§è¡Œ</strong>ã€‚å¯¹äºè¿™ç§ä¼ é€’è¿‡å»ä¸æ‰§è¡Œï¼Œç­‰å‡ºæ¥ç»“æœä¹‹åå†æ‰§è¡Œçš„å‡½æ•°ï¼Œå«åšcallbackï¼Œå³<strong>å›è°ƒå‡½æ•°</strong></p><p>å†çœ‹ä¸€æ®µæ›´åŠ èƒ½è¯´æ˜å›è°ƒå‡½æ•°çš„ nodejs ä»£ç ã€‚å’Œä¸Šé¢ä»£ç åŸºæœ¬ä¸€æ ·ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼šä¸Šé¢ä»£ç æ—¶ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸‹é¢ä»£ç æ—¶ IO æ“ä½œã€‚</p><p>var fs = require(â€˜fsâ€™)<br>fs.readFile(â€˜data1.jsonâ€™, (err, data) =&gt; {<br>    console.log(data.toString())<br>})<br>ä»ä¸Šé¢ä¸¤ä¸ª demo çœ‹æ¥ï¼Œå®ç°å¼‚æ­¥çš„æœ€æ ¸å¿ƒåŸç†ï¼Œå°±æ˜¯<strong>å°†callbackä½œä¸ºå‚æ•°ä¼ é€’ç»™å¼‚æ­¥æ‰§è¡Œå‡½æ•°ï¼Œå½“æœ‰ç»“æœè¿”å›ä¹‹åå†è§¦å‘ callbackæ‰§è¡Œ</strong>ï¼Œå°±æ˜¯å¦‚æ­¤ç®€å•ï¼</p><h3 id="å¸¸ç”¨çš„å¼‚æ­¥æ“ä½œ"><a href="#å¸¸ç”¨çš„å¼‚æ­¥æ“ä½œ" class="headerlink" title="å¸¸ç”¨çš„å¼‚æ­¥æ“ä½œ"></a>å¸¸ç”¨çš„å¼‚æ­¥æ“ä½œ</h3><p>å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å¼‚æ­¥æ“ä½œæœ‰ï¼š</p><ul><li>ç½‘ç»œè¯·æ±‚ï¼Œå¦‚ajax http.get</li><li>IO æ“ä½œï¼Œå¦‚readFile readdir</li><li>å®šæ—¶å‡½æ•°ï¼Œå¦‚setTimeout setInterval</li></ul><h2 id="jQuery-1-5-ä¹‹åçš„-ajax"><a href="#jQuery-1-5-ä¹‹åçš„-ajax" class="headerlink" title="jQuery-1.5 ä¹‹åçš„ ajax"></a>jQuery-1.5 ä¹‹åçš„ ajax</h2><p><code>$.ajax</code>è¿™ä¸ªå‡½æ•°å„ä½åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œè¦å®Œæ•´çš„è®²è§£ js çš„å¼‚æ­¥æ“ä½œï¼Œå°±å¿…é¡»å…ˆä»$.ajaxè¿™ä¸ªæ–¹æ³•è¯´èµ·ã€‚</p><h3 id="ä¼ ç»Ÿçš„-ajax"><a href="#ä¼ ç»Ÿçš„-ajax" class="headerlink" title="ä¼ ç»Ÿçš„$.ajax"></a>ä¼ ç»Ÿçš„$.ajax</h3><p>å…ˆæ¥ä¸€æ®µæœ€å¸¸è§çš„$.ajaxçš„ä»£ç ï¼Œå½“ç„¶æ˜¯ä½¿ç”¨ä¸‡æ¶çš„callbackæ–¹å¼</p><pre><code>var ajax = $.ajax({    url: &#39;data.json&#39;,    success: function () {        console.log(&#39;success&#39;)    },    error: function () {        console.log(&#39;error&#39;)    }})console.log(ajax) // è¿”å›ä¸€ä¸ª XHR å¯¹è±¡</code></pre><p>è‡³äºè¿™ä¹ˆåšä¼šäº§ç”Ÿä»€ä¹ˆæ ·å­çš„è¯Ÿç—…ï¼Œæˆ‘æƒ³å¤§å®¶åº”è¯¥éƒ½å¾ˆæ˜ç™½äº†ã€‚ä¸æ˜ç™½çš„è‡ªå·±ç§ä¸‹å»æŸ¥ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ï¼Œä½ åªéœ€è¦è®°ä½è¿™æ ·åšå¾ˆä¸å¥½å°±æ˜¯äº†ï¼Œè¦ä¸ç„¶ jquery ä¹Ÿä¸ä¼šå†åé¢è¿›è¡Œæ”¹è¿›</p><h3 id="1-5-ç‰ˆæœ¬ä¹‹åçš„-ajax"><a href="#1-5-ç‰ˆæœ¬ä¹‹åçš„-ajax" class="headerlink" title="1.5 ç‰ˆæœ¬ä¹‹åçš„$.ajax"></a>1.5 ç‰ˆæœ¬ä¹‹åçš„$.ajax</h3><p>ä½†æ˜¯ä»v1.5å¼€å§‹ï¼Œä»¥ä¸Šä»£ç å°±å¯ä»¥è¿™æ ·å†™äº†ï¼šå¯ä»¥é“¾å¼çš„æ‰§è¡Œdoneæˆ–è€…failæ–¹æ³•</p><pre><code>var ajax = $.ajax(&#39;data.json&#39;)ajax.done(function () {    console.log(&#39;success 1&#39;)}).fail(function () {    console.log(&#39;error&#39;)}).done(function () {        console.log(&#39;success 2&#39;)})console.log(ajax) // è¿”å›ä¸€ä¸ª deferred å¯¹è±¡</code></pre><p>å¤§å®¶æ³¨æ„çœ‹ä»¥ä¸Šä¸¤æ®µä»£ç ä¸­éƒ½æœ‰ä¸€ä¸ªconsole.log(ajax)ï¼Œä½†æ˜¯è¿”å›å€¼æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚</p><p>v1.5ä¹‹å‰ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªXHRå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸å¯èƒ½æœ‰doneæˆ–è€…failçš„æ–¹æ³•çš„<br>v1.5å¼€å§‹ï¼Œè¿”å›ä¸€ä¸ªdeferredå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±å¸¦æœ‰doneå’Œfailçš„æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯ç­‰ç€è¯·æ±‚è¿”å›ä¹‹åå†å»è°ƒç”¨</p><h3 id="æ”¹è¿›ä¹‹åçš„å¥½å¤„"><a href="#æ”¹è¿›ä¹‹åçš„å¥½å¤„" class="headerlink" title="æ”¹è¿›ä¹‹åçš„å¥½å¤„"></a>æ”¹è¿›ä¹‹åçš„å¥½å¤„</h3><p>è¿™æ˜¯ä¸€ä¸ªæ ‡å¿—æ€§çš„æ”¹é€ ï¼Œä¸ç®¡è¿™ä¸ªæ¦‚å¿µæ˜¯è°æœ€å…ˆæå‡ºçš„ï¼Œå®ƒåœ¨ jquery ä¸­é¦–å…ˆå¤§é‡ä½¿ç”¨å¹¶è®©å…¨çƒå¼€å‘è€…éƒ½çŸ¥é“åŸæ¥ ajax è¯·æ±‚è¿˜å¯ä»¥è¿™æ ·å†™ã€‚è¿™ä¸ºä»¥åçš„Promiseæ ‡å‡†åˆ¶å®šæä¾›äº†å¾ˆå¤§æ„ä¹‰çš„å‚è€ƒï¼Œä½ å¯ä»¥ä»¥ä¸ºè¿™å°±æ˜¯åé¢Promiseçš„åŸå‹ã€‚</p><p>è®°ä½ä¸€å¥è¯â€”â€”â€”â€”<strong>è™½ç„¶ JS æ˜¯å¼‚æ­¥æ‰§è¡Œçš„è¯­è¨€ï¼Œä½†æ˜¯äººçš„æ€ç»´æ˜¯åŒæ­¥çš„</strong>â€”â€”â€”â€”å› æ­¤ï¼Œå¼€å‘è€…æ€»æ˜¯åœ¨å¯»æ±‚å¦‚ä½•ä½¿ç”¨é€»è¾‘ä¸Šçœ‹ä¼¼åŒæ­¥çš„ä»£ç æ¥å®Œæˆ JS çš„å¼‚æ­¥è¯·æ±‚ã€‚è€Œ jquery çš„è¿™ä¸€æ¬¡æ›´æ–°ï¼Œè®©å¼€å‘è€…åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¾—åˆ°äº†è¿™æ ·çš„å¥½å¤„ã€‚</p><p>ä¹‹å‰æ— è®ºæ˜¯ä»€ä¹ˆæ“ä½œï¼Œæˆ‘éƒ½éœ€è¦ä¸€è‚¡è„‘å†™åˆ°callbackä¸­ï¼Œç°åœ¨ä¸ç”¨äº†ã€‚ç°åœ¨æˆåŠŸäº†å°±å†™åˆ°doneä¸­ï¼Œå¤±è´¥äº†å°±å†™åˆ°failä¸­ï¼Œå¦‚æœæˆåŠŸäº†æœ‰å¤šä¸ªæ­¥éª¤çš„æ“ä½œï¼Œé‚£æˆ‘å°±å†™å¾ˆå¤šä¸ªdoneï¼Œç„¶åé“¾å¼è¿æ¥èµ·æ¥å°± OK äº†ã€‚</p><h3 id="å’Œåæ¥çš„Promiseçš„å…³ç³»"><a href="#å’Œåæ¥çš„Promiseçš„å…³ç³»" class="headerlink" title="å’Œåæ¥çš„Promiseçš„å…³ç³»"></a>å’Œåæ¥çš„Promiseçš„å…³ç³»</h3><p>ä»¥ä¸Šçš„è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·å†™ã€‚å³ä¸ç”¨doneå’Œfailå‡½æ•°ï¼Œè€Œæ˜¯ç”¨thenå‡½æ•°ã€‚thenå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆåŠŸä¹‹åæ‰§è¡Œçš„å‡½æ•°ï¼ˆå³ä¹‹å‰çš„doneï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¤±è´¥ä¹‹åæ‰§è¡Œçš„å‡½æ•°ï¼ˆå³ä¹‹å‰çš„failï¼‰ã€‚è€Œä¸”thenå‡½æ•°è¿˜å¯ä»¥é“¾å¼è¿æ¥ã€‚</p><pre><code>var ajax = $.ajax(&#39;data.json&#39;)ajax.then(function () {    console.log(&#39;success 1&#39;)}, function () {    console.log(&#39;error 1&#39;)}).then(function () {    console.log(&#39;success 2&#39;)}, function () {    console.log(&#39;error 2&#39;)})</code></pre><h2 id="jQuery-deferred"><a href="#jQuery-deferred" class="headerlink" title="jQuery deferred"></a>jQuery deferred</h2><h3 id="å†™ä¸€ä¸ªä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ"><a href="#å†™ä¸€ä¸ªä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ" class="headerlink" title="å†™ä¸€ä¸ªä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ"></a>å†™ä¸€ä¸ªä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ</h3><p>ç»™å‡ºä¸€æ®µéå¸¸ç®€å•çš„å¼‚æ­¥æ“ä½œä»£ç ï¼Œä½¿ç”¨setTimeoutå‡½æ•°ã€‚</p><pre><code>var wait = function () {    var task = function () {        console.log(&#39;æ‰§è¡Œå®Œæˆ&#39;)    }    setTimeout(task, 2000)}wait()</code></pre><p>ä»¥ä¸Šè¿™äº›ä»£ç æ‰§è¡Œçš„ç»“æœå¤§å®¶åº”è¯¥éƒ½æ¯”è¾ƒæ˜ç¡®äº†ï¼Œå³ 2s ä¹‹åæ‰“å°å‡ºæ‰§è¡Œå®Œæˆã€‚ä½†æ˜¯æˆ‘å¦‚æœå†åŠ ä¸€ä¸ªéœ€æ±‚ â€”â€”â€”â€” è¦åœ¨æ‰§è¡Œå®Œæˆä¹‹åè¿›è¡ŒæŸäº›ç‰¹åˆ«å¤æ‚çš„æ“ä½œï¼Œä»£ç å¯èƒ½ä¼šå¾ˆå¤šï¼Œè€Œä¸”åˆ†å¥½å‡ ä¸ªæ­¥éª¤ â€”â€”â€”â€” é‚£è¯¥æ€ä¹ˆåŠï¼Ÿ å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼</p><p>å¦‚æœä½ ä¸çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œè€Œä¸”ç›®å‰è¿˜æ²¡æœ‰Promiseçš„è¿™ä¸ªæ€ç»´ï¼Œé‚£ä¼°è®¡ä½ ä¼šè¯´ï¼šç›´æ¥åœ¨taskå‡½æ•°ä¸­å†™å°±æ˜¯äº†ï¼ä¸è¿‡ç›¸ä¿¡ä½ çœ‹å®Œä¸‹é¢çš„å†…å®¹ä¹‹åï¼Œä¼šæ”¾å¼ƒä½ ç°åœ¨çš„æƒ³æ³•ã€‚</p><h3 id="ä½¿ç”¨-Deferredå°è£…"><a href="#ä½¿ç”¨-Deferredå°è£…" class="headerlink" title="ä½¿ç”¨$.Deferredå°è£…"></a>ä½¿ç”¨$.Deferredå°è£…</h3><p>å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è®©åˆšæ‰ç®€å•çš„å‡ è¡Œä»£ç å˜å¾—æ›´åŠ å¤æ‚ã€‚ä¸ºä½•è¦å˜å¾—æ›´åŠ å¤æ‚ï¼Ÿæ˜¯å› ä¸ºè®©ä»¥åæ›´åŠ å¤æ‚çš„åœ°æ–¹å˜å¾—ç®€å•ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† jquery çš„<code>$.Deferred</code>ï¼Œè‡³äºè¿™ä¸ªæ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Œå¤§å®¶å…ˆä¸ç”¨å…³å¿ƒï¼Œåªéœ€è¦çŸ¥é“<code>$.Deferred()</code>ä¼šè¿”å›ä¸€ä¸ªdeferredå¯¹è±¡ï¼Œå…ˆçœ‹ä»£ç ï¼Œdeferredå¯¹è±¡çš„ä½œç”¨æˆ‘ä»¬ä¼šé¢ä¼šè¯´ã€‚</p><pre><code>function waitHandle() {    var dtd = $.Deferred()  // åˆ›å»ºä¸€ä¸ª deferred å¯¹è±¡    var wait = function (dtd) {  // è¦æ±‚ä¼ å…¥ä¸€ä¸ª deferred å¯¹è±¡        var task = function () {            console.log(&#39;æ‰§è¡Œå®Œæˆ&#39;)            dtd.resolve()  // è¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡å·²ç»å®Œæˆ        }        setTimeout(task, 2000)        return dtd  // è¦æ±‚è¿”å› deferred å¯¹è±¡    }    // æ³¨æ„ï¼Œè¿™é‡Œä¸€å®šè¦æœ‰è¿”å›å€¼    return wait(dtd)}</code></pre><p>ä»¥ä¸Šä»£ç ä¸­ï¼Œåˆä½¿ç”¨ä¸€ä¸ªwaitHandleæ–¹æ³•å¯¹waitæ–¹æ³•è¿›è¡Œå†æ¬¡çš„å°è£…ã€‚waitHandleå†…éƒ¨ä»£ç ï¼Œæˆ‘ä»¬åˆ†æ­¥éª¤æ¥åˆ†æã€‚è·Ÿç€æˆ‘çš„èŠ‚å¥æ…¢æ…¢æ¥ï¼Œä¿è¯ä½ ä¸ä¼šä¹±ã€‚</p><ul><li>ä½¿ç”¨var dtd = $.Deferred()åˆ›å»ºdeferredå¯¹è±¡ã€‚é€šè¿‡ä¸Šä¸€èŠ‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªdeferredå¯¹è±¡ä¼šæœ‰done failå’Œthenæ–¹æ³•ï¼ˆä¸æ˜ç™½çš„å»çœ‹ä¸Šä¸€èŠ‚ï¼‰</li><li>é‡æ–°å®šä¹‰waitå‡½æ•°ï¼Œä½†æ˜¯ï¼šç¬¬ä¸€ï¼Œè¦ä¼ å…¥ä¸€ä¸ªdeferredå¯¹è±¡ï¼ˆdtdå‚æ•°ï¼‰ï¼›ç¬¬äºŒï¼Œå½“taskå‡½æ•°ï¼ˆå³callbackï¼‰æ‰§è¡Œå®Œæˆä¹‹åï¼Œè¦æ‰§è¡Œdtd.resolve()å‘Šè¯‰ä¼ å…¥çš„deferredå¯¹è±¡ï¼Œé©å‘½å·²ç»æˆåŠŸã€‚ç¬¬ä¸‰ï¼›å°†è¿™ä¸ªdeferredå¯¹è±¡è¿”å›ã€‚</li><li>è¿”å›wait(dtd)çš„æ‰§è¡Œç»“æœã€‚å› ä¸ºwaitå‡½æ•°ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªdeferredå¯¹è±¡ï¼ˆdtdå‚æ•°ï¼‰ï¼Œå› æ­¤wait(dtd)è¿”å›çš„å°±æ˜¯dtdâ€”â€”â€”â€”å¦‚æœä½ æ„Ÿè§‰è¿™é‡Œå¾ˆä¹±ï¼Œæ²¡å…³ç³»ï¼Œæ…¢æ…¢æ‹ï¼Œä¸€è¡Œä¸€è¡Œçœ‹ï¼Œç›¸ä¿¡ä¸¤ä¸‰åˆ†é’Ÿå°±èƒ½æ‹é¡ºï¼   </li></ul><p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼ŒwaitHandleå‡½æ•°æœ€ç»ˆreturn wait(dtd)å³æœ€ç»ˆè¿”å›dtdï¼ˆä¸€ä¸ªdeferredï¼‰å¯¹è±¡ã€‚é’ˆå¯¹ä¸€ä¸ªdeferredå¯¹è±¡ï¼Œå®ƒæœ‰done failå’Œthenæ–¹æ³•ï¼ˆä¸Šä¸€èŠ‚è¯´è¿‡ï¼‰ï¼Œå®ƒè¿˜æœ‰resolve()æ–¹æ³•ï¼ˆå…¶å®å’Œresolveç›¸å¯¹çš„è¿˜æœ‰ä¸€ä¸ªrejectæ–¹æ³•ï¼Œåé¢ä¼šæåˆ°ï¼‰</p><h3 id="åº”ç”¨thenæ–¹æ³•"><a href="#åº”ç”¨thenæ–¹æ³•" class="headerlink" title="åº”ç”¨thenæ–¹æ³•"></a>åº”ç”¨thenæ–¹æ³•</h3><p>æ¥ç€ä¸Šé¢çš„ä»£ç ç»§ç»­å†™</p><pre><code>var w = waitHandle()w.then(function () {    console.log(&#39;ok 1&#39;)}, function () {    console.log(&#39;err 1&#39;)}).then(function () {    console.log(&#39;ok 2&#39;)}, function () {    console.log(&#39;err 2&#39;)})</code></pre><p>ä¸Šé¢å·²ç»è¯´è¿‡ï¼ŒwaitHandleå‡½æ•°æœ€ç»ˆè¿”å›ä¸€ä¸ªdeferredå¯¹è±¡ï¼Œè€Œdeferredå¯¹è±¡å…·æœ‰done fail thenæ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æ˜¯thenæ–¹æ³•ã€‚è‡³äºthenæ–¹æ³•çš„ä½œç”¨ï¼Œæˆ‘ä»¬ä¸Šä¸€èŠ‚å·²ç»è®²è¿‡äº†ï¼Œä¸æ˜ç™½çš„åŒå­¦æŠ“ç´§å›å»è¡¥è¯¾ã€‚</p><p>æ‰§è¡Œè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬æ‰“å°å‡ºæ¥ä»¥ä¸‹ç»“æœã€‚å¯ä»¥å°†ç»“æœå¯¹æ ‡ä»¥ä¸‹ä»£ç æ—¶å“ªä¸€è¡Œã€‚</p><pre><code>æ‰§è¡Œå®Œæˆok 1ok 2</code></pre><p>æ­¤æ—¶ï¼Œä½ å†å›å¤´æƒ³æƒ³æˆ‘åˆšæ‰è¯´æå‡ºçš„éœ€æ±‚ï¼ˆè¦åœ¨æ‰§è¡Œå®Œæˆä¹‹åè¿›è¡ŒæŸäº›ç‰¹åˆ«å¤æ‚çš„æ“ä½œï¼Œä»£ç å¯èƒ½ä¼šå¾ˆå¤šï¼Œè€Œä¸”åˆ†å¥½å‡ ä¸ªæ­¥éª¤ï¼‰ï¼Œæ˜¯ä¸æ˜¯æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆäº†ï¼Ÿ</p><p>æœ‰åŒå­¦è‚¯å®šå‘ç°äº†ï¼Œä»£ç ä¸­<code>console.log(&#39;err 1&#39;)å’Œconsole.log(&#39;err 2&#39;)</code>ä»€ä¹ˆæ—¶å€™ä¼šæ‰§è¡Œå‘¢ â€”â€”â€”â€” ä½ è‡ªå·±æŠŠwaitHandleå‡½æ•°ä¸­çš„<code>dtd.resolve()</code>æ”¹æˆ<code>dtd.reject()</code>è¯•ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚</p><p><code>dtd.resolve()</code> è¡¨ç¤ºé©å‘½å·²ç»æˆåŠŸï¼Œä¼šè§¦å‘thenä¸­ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå‡½æ•°ï¼‰çš„æ‰§è¡Œï¼Œ<br><code>dtd.reject()</code> è¡¨ç¤ºé©å‘½å¤±è´¥äº†ï¼Œä¼šè§¦å‘thenä¸­ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå‡½æ•°ï¼‰æ‰§è¡Œ</p><p>æ€»ç»“ä¸€ä¸‹ä¸€ä¸ªdeferredå¯¹è±¡å…·æœ‰çš„å‡½æ•°å±æ€§ï¼Œå¹¶åˆ†ä¸ºä¸¤ç»„ï¼š</p><ul><li>dtd.resolve dtd.reject</li><li>dtd.then dtd.done dtd.fail</li></ul><p>æˆ‘ä¸ºä½•è¦åˆ†æˆä¸¤ç»„ â€”â€”â€”â€” è¿™ä¸¤ç»„å‡½æ•°ï¼Œä»è®¾è®¡åˆ°æ‰§è¡Œä¹‹åçš„æ•ˆæœæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚ç¬¬ä¸€ç»„æ˜¯ä¸»åŠ¨è§¦å‘ç”¨æ¥æ”¹å˜çŠ¶æ€ï¼ˆæˆåŠŸæˆ–è€…å¤±è´¥ï¼‰ï¼Œç¬¬äºŒç»„æ˜¯çŠ¶æ€å˜åŒ–ä¹‹åæ‰ä¼šè§¦å‘çš„ç›‘å¬å‡½æ•°ã€‚</p><h2 id="jQuery-promise"><a href="#jQuery-promise" class="headerlink" title="jQuery promise"></a>jQuery promise</h2><h3 id="è¿”å›promise"><a href="#è¿”å›promise" class="headerlink" title="è¿”å›promise"></a>è¿”å›promise</h3><p>æˆ‘ä»¬å¯¹ä¸Šä¸€èŠ‚çš„çš„ä»£ç åšä¸€ç‚¹å°å°çš„æ”¹åŠ¨ï¼Œåªæ”¹åŠ¨äº†ä¸€è¡Œï¼Œä¸‹é¢æ³¨é‡Šã€‚</p><pre><code>function waitHandle() {    var dtd = $.Deferred()    var wait = function (dtd) {        var task = function () {            console.log(&#39;æ‰§è¡Œå®Œæˆ&#39;)            dtd.resolve()        }        setTimeout(task, 2000)        return dtd.promise()  // æ³¨æ„ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯ primise è€Œä¸æ˜¯ç›´æ¥è¿”å› deferred å¯¹è±¡    }    return wait(dtd)}var w = waitHandle() // ç»è¿‡ä¸Šé¢çš„æ”¹åŠ¨ï¼Œw æ¥æ”¶çš„å°±æ˜¯ä¸€ä¸ª promise å¯¹è±¡$.when(w) .then(function () {    console.log(&#39;ok 1&#39;) }) .then(function () {    console.log(&#39;ok 2&#39;) })</code></pre><p>æ”¹åŠ¨çš„ä¸€è¡Œåœ¨è¿™é‡Œreturn dtd.promise()ï¼Œä¹‹å‰æ˜¯return dtdã€‚dtdæ˜¯ä¸€ä¸ªdeferredå¯¹è±¡ï¼Œè€Œdtd.promiseå°±æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ã€‚</p><p>promiseå¯¹è±¡å’Œdeferredå¯¹è±¡æœ€é‡è¦çš„åŒºåˆ«ï¼Œè®°ä½äº†â€”â€”â€”â€”<strong>promiseå¯¹è±¡ç›¸æ¯”äºdeferredå¯¹è±¡ï¼Œç¼ºå°‘äº†.resolveå’Œ.rejectè¿™ä¿©å‡½æ•°å±æ€§</strong>ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œå¯å°±å®Œå…¨ä¸ä¸€æ ·äº†ã€‚</p><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬æåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨ç¨‹åºçš„æœ€åä¸€è¡ŒåŠ ä¸€å¥<code>w.reject()</code>ä¼šå¯¼è‡´ä¹±å¥—ï¼Œä½ ç°åœ¨å†åœ¨æœ€åä¸€è¡ŒåŠ <code>w.reject()</code>è¯•è¯• â€”â€”â€”â€” ä¿è¯ä¹±å¥—ä¸äº† â€”â€”â€”â€” è€Œæ˜¯ä½ çš„ç¨‹åºä¸èƒ½æ‰§è¡Œï¼Œç›´æ¥æŠ¥é”™ã€‚å› ä¸ºï¼Œwæ˜¯promiseå¯¹è±¡ï¼Œä¸å…·å¤‡<code>.reject</code>å±æ€§ã€‚</p><h3 id="è¿”å›promiseçš„å¥½å¤„"><a href="#è¿”å›promiseçš„å¥½å¤„" class="headerlink" title="è¿”å›promiseçš„å¥½å¤„"></a>è¿”å›promiseçš„å¥½å¤„</h3><p>ä¸Šä¸€èŠ‚æåˆ°deferredå¯¹è±¡æœ‰ä¸¤ç»„å±æ€§å‡½æ•°ï¼Œè€Œä¸”æåˆ°åº”è¯¥æŠŠè¿™ä¸¤ç»„å½»åº•åˆ†å¼€ã€‚ç°åœ¨é€šè¿‡ä¸Šé¢ä¸€è¡Œä»£ç çš„æ”¹åŠ¨ï¼Œå°±åˆ†å¼€äº†ã€‚</p><ul><li>waitHandleå‡½æ•°å†…éƒ¨ï¼Œä½¿ç”¨<code>dtd.resolve()</code>æ¥è¯¥è¡¨çŠ¶æ€ï¼Œåšä¸»åŠ¨çš„ä¿®æ”¹æ“ä½œ</li><li>waitHandleæœ€ç»ˆè¿”å›promiseå¯¹è±¡ï¼Œåªèƒ½å»è¢«åŠ¨ç›‘å¬å˜åŒ–ï¼ˆthenå‡½æ•°ï¼‰ï¼Œè€Œä¸èƒ½å»ä¸»åŠ¨ä¿®æ”¹æ“ä½œ<br>ä¸€ä¸ªâ€œä¸»åŠ¨â€ä¸€ä¸ªâ€œè¢«åŠ¨â€ï¼Œå®Œå…¨åˆ†å¼€äº†ã€‚</li></ul><h3 id="promise-çš„æ¦‚å¿µ"><a href="#promise-çš„æ¦‚å¿µ" class="headerlink" title="promise çš„æ¦‚å¿µ"></a>promise çš„æ¦‚å¿µ</h3><p>jquery v1.5 ç‰ˆæœ¬å‘å¸ƒæ—¶é—´è·ç¦»ç°åœ¨å·²ç»è€æ—©ä¹‹å‰äº†ï¼Œé‚£ä¼šå„¿å¤§å®¶ç½‘é¡µæ ‡é…éƒ½æ˜¯ jquery ã€‚æ— è®ºé‡Œé¢çš„deferredå’Œpromiseè¿™ä¸ªæ¦‚å¿µå’Œæƒ³æ³•æœ€æ—©æ˜¯å“ªä½æå‡ºæ¥çš„ï¼Œä½†æ˜¯æœ€æ—©å±•ç¤ºç»™å…¨ä¸–ç•Œå¼€å‘è€…çš„æ˜¯ jquery ï¼Œè¿™ç®—æ˜¯Promiseè¿™ä¸€æ¦‚å¿µæœ€å…ˆçš„æå‡ºè€…ã€‚</p><p>å…¶å®æœ¬æ¬¡è¯¾ç¨‹ä¸»è¦æ˜¯ç»™å¤§å®¶åˆ†æ ES6 çš„Promise Generatorå’Œasync-awaitï¼Œä½†æ˜¯ä¸ºä½•è¦ä» jquery å¼€å§‹ï¼ˆå¤§å®¶ç°åœ¨ç”¨ jquery è¶Šæ¥è¶Šå°‘ï¼‰ï¼Ÿå°±æ˜¯è¦ç»™å¤§å®¶å±•ç¤ºä¸€ä¸‹è¿™æ®µå†å²çš„ä¸€äº›èµ·ç‚¹å’Œå‘å±•çš„çŸ¥è¯†ã€‚æœ‰äº†è¿™äº›åŸºç¡€ï¼Œä½ å†å»æ¥å—æœ€æ–°çš„æ¦‚å¿µä¼šéå¸¸å®¹æ˜“ï¼Œå› ä¸ºæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ä»æœ€åˆé¡ºå…¶è‡ªç„¶å‘å±•è¿›åŒ–è€Œæ¥çš„ï¼Œæˆ‘ä»¬è¦å»ç”¨ä¸€ä¸ªå‘å±•è¿›åŒ–çš„çœ¼å…‰å­¦ä¹ çŸ¥è¯†ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒã€‚</p><h2 id="Promise-åŠ å…¥-ES6-æ ‡å‡†"><a href="#Promise-åŠ å…¥-ES6-æ ‡å‡†" class="headerlink" title="Promise åŠ å…¥ ES6 æ ‡å‡†"></a>Promise åŠ å…¥ ES6 æ ‡å‡†</h2><h3 id="å†™ä¸€æ®µä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ"><a href="#å†™ä¸€æ®µä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ" class="headerlink" title="å†™ä¸€æ®µä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ"></a>å†™ä¸€æ®µä¼ ç»Ÿçš„å¼‚æ­¥æ“ä½œ</h3><p>è¿˜æ˜¯æ‹¿ä¹‹å‰è®² jquery deferredå¯¹è±¡æ—¶çš„é‚£æ®µsetTimeoutç¨‹åº</p><pre><code>var wait = function () {    var task = function () {        console.log(&#39;æ‰§è¡Œå®Œæˆ&#39;)    }    setTimeout(task, 2000)}wait()</code></pre><p>ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨ jquery å°è£…çš„ï¼Œæ¥ä¸‹æ¥å°†ä½¿ç”¨ ES6 çš„Promiseè¿›è¡Œå°è£…ï¼Œå¤§å®¶æ³¨æ„çœ‹æœ‰ä½•ä¸åŒã€‚</p><h3 id="ç”¨Promiseè¿›è¡Œå°è£…"><a href="#ç”¨Promiseè¿›è¡Œå°è£…" class="headerlink" title="ç”¨Promiseè¿›è¡Œå°è£…"></a>ç”¨Promiseè¿›è¡Œå°è£…</h3><pre><code>const wait =  function () {    // å®šä¹‰ä¸€ä¸ª promise å¯¹è±¡    const promise = new Promise((resolve, reject) =&gt; {        // å°†ä¹‹å‰çš„å¼‚æ­¥æ“ä½œï¼ŒåŒ…æ‹¬åˆ°è¿™ä¸ª new Promise å‡½æ•°ä¹‹å†…        const task = function () {            console.log(&#39;æ‰§è¡Œå®Œæˆ&#39;)            resolve()  // callback ä¸­å»æ‰§è¡Œ resolve æˆ–è€… reject        }        setTimeout(task, 2000)    })    // è¿”å› promise å¯¹è±¡    return promise}</code></pre><p>æ³¨æ„çœ‹çœ‹ç¨‹åºä¸­çš„æ³¨é‡Šï¼Œé‚£éƒ½æ˜¯é‡ç‚¹éƒ¨åˆ†ã€‚ä»æ•´ä½“çœ‹æ¥ï¼Œæ„Ÿè§‰è¿™æ¬¡æ¯”ç”¨ jquery é‚£æ¬¡ç®€å•ä¸€äº›ï¼Œé€»è¾‘ä¸Šä¹Ÿæ›´åŠ æ¸…æ™°ä¸€äº›ã€‚</p><p>å°†ä¹‹å‰çš„å¼‚æ­¥æ“ä½œé‚£å‡ è¡Œç¨‹åºï¼Œç”¨<code>new Promise((resolve,reject) =&gt; {.....})</code>åŒ…è£…èµ·æ¥ï¼Œæœ€åreturnå³å¯<br>å¼‚æ­¥æ“ä½œçš„å†…éƒ¨ï¼Œåœ¨callbackä¸­æ‰§è¡Œresolve()ï¼ˆè¡¨æ˜æˆåŠŸäº†ï¼Œå¤±è´¥çš„è¯æ‰§è¡Œrejectï¼‰<br>æ¥ç€ä¸Šé¢çš„ç¨‹åºç»§ç»­å¾€ä¸‹å†™ã€‚wait()è¿”å›çš„è‚¯å®šæ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œè€Œpromiseå¯¹è±¡æœ‰thenå±æ€§ã€‚</p><pre><code>const w = wait()w.then(() =&gt; {    console.log(&#39;ok 1&#39;)}, () =&gt; {    console.log(&#39;err 1&#39;)}).then(() =&gt; {    console.log(&#39;ok 2&#39;)}, () =&gt; {    console.log(&#39;err 2&#39;)})</code></pre><p>thenè¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆå‡½æ•°ï¼‰ï¼Œç¬¬ä¸€ä¸ªåœ¨æˆåŠŸæ—¶ï¼ˆè§¦å‘resolveï¼‰æ‰§è¡Œï¼Œç¬¬äºŒä¸ªåœ¨å¤±è´¥æ—¶(è§¦å‘reject)æ—¶æ‰§è¡Œã€‚è€Œä¸”ï¼Œthenè¿˜å¯ä»¥è¿›è¡Œé“¾å¼æ“ä½œã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ ES6 çš„Promiseçš„åŸºæœ¬ä½¿ç”¨æ¼”ç¤ºã€‚çœ‹å®Œä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œè¿™è·Ÿä¹‹å‰è®²è¿° jquery çš„ä¸å·®ä¸å¤šå— â€”â€”â€”â€” å¯¹äº†ï¼Œè¿™å°±æ˜¯æˆ‘è¦åœ¨ä¹‹å‰å…ˆè®² jquery çš„åŸå› ï¼Œè®©ä½ æ„Ÿè§‰ä¸€ç¯‡ä¸€ç¯‡çœ‹èµ·æ¥å¦‚ä¸èˆ¬é¡ºæ»‘ï¼</p><h2 id="Promise-åœ¨-ES6-ä¸­çš„å…·ä½“åº”ç”¨"><a href="#Promise-åœ¨-ES6-ä¸­çš„å…·ä½“åº”ç”¨" class="headerlink" title="Promise åœ¨ ES6 ä¸­çš„å…·ä½“åº”ç”¨"></a>Promise åœ¨ ES6 ä¸­çš„å…·ä½“åº”ç”¨</h2><h3 id="Promiseå°è£…"><a href="#Promiseå°è£…" class="headerlink" title="Promiseå°è£…"></a>Promiseå°è£…</h3><p>å› ä¸ºä»¥ä¸‹æ‰€æœ‰çš„ä»£ç éƒ½ä¼šç”¨åˆ°Promiseï¼Œå› æ­¤å¹²è„†åœ¨æ‰€æœ‰ä»‹ç»ä¹‹å‰ï¼Œå…ˆå°è£…ä¸€ä¸ªPromiseï¼Œå°è£…ä¸€æ¬¡ï¼Œä¸ºä¸‹é¢å¤šæ¬¡åº”ç”¨ã€‚</p><pre><code>const fs = require(&#39;fs&#39;)const path = require(&#39;path&#39;)  // åé¢è·å–æ–‡ä»¶è·¯å¾„æ—¶å€™ä¼šç”¨åˆ°const readFilePromise = function (fileName) {    return new Promise((resolve, reject) =&gt; {        fs.readFile(fileName, (err, data) =&gt; {            if (err) {                reject(err)  // æ³¨æ„ï¼Œè¿™é‡Œæ‰§è¡Œ reject æ˜¯ä¼ é€’äº†å‚æ•°ï¼Œåé¢ä¼šæœ‰åœ°æ–¹æ¥æ”¶åˆ°è¿™ä¸ªå‚æ•°            } else {                resolve(data.toString())  // æ³¨æ„ï¼Œè¿™é‡Œæ‰§è¡Œ resolve æ—¶ä¼ é€’äº†å‚æ•°ï¼Œåé¢ä¼šæœ‰åœ°æ–¹æ¥æ”¶åˆ°è¿™ä¸ªå‚æ•°            }        })    })}</code></pre><p>ä»¥ä¸Šä»£ç ä¸€ä¸ªä¸€æ®µ nodejs ä»£ç ï¼Œå°†è¯»å–æ–‡ä»¶çš„å‡½æ•°fs.readFileå°è£…ä¸ºä¸€ä¸ªPromiseã€‚ç»è¿‡ä¸Šä¸€èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘æƒ³å¤§å®¶è‚¯å®šéƒ½èƒ½çœ‹æ˜ç™½ä»£ç çš„å«ä¹‰ï¼Œè¦æ˜¯çœ‹ä¸æ˜ç™½ï¼Œä½ å°±éœ€è¦å›ç‚‰é‡é€ äº†ï¼</p>]]></content>
      
      
      <categories>
          
          <category> å¼‚æ­¥ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Promise </tag>
            
            <tag> async-await </tag>
            
            <tag> Generator </tag>
            
            <tag> ä»»åŠ¡é˜Ÿåˆ— </tag>
            
            <tag> event-loop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç¯‡ä¹‹---Vue åŒå‘ç»‘å®šåŸç†</title>
      <link href="/2019/10/29/%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/"/>
      <url>/2019/10/29/%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒå‘ç»‘å®š </tag>
            
            <tag> Proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç¯‡ä¹‹---è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/2019/10/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
      <url>/2019/10/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€è°ˆä¸‹ä½ å¯¹äº”å±‚ç½‘ç»œåè®®ä½“ç³»ç»“æ„çš„ç†è§£ï¼Ÿ"><a href="#1ã€è°ˆä¸‹ä½ å¯¹äº”å±‚ç½‘ç»œåè®®ä½“ç³»ç»“æ„çš„ç†è§£ï¼Ÿ" class="headerlink" title="1ã€è°ˆä¸‹ä½ å¯¹äº”å±‚ç½‘ç»œåè®®ä½“ç³»ç»“æ„çš„ç†è§£ï¼Ÿ"></a>1ã€è°ˆä¸‹ä½ å¯¹äº”å±‚ç½‘ç»œåè®®ä½“ç³»ç»“æ„çš„ç†è§£ï¼Ÿ</h2><p>å­¦ä¹ è®¡ç®—æœºç½‘ç»œæ—¶æˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨æŠ˜ä¸­çš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯ä¸­å’Œ OSI å’Œ TCP/IP çš„ä¼˜ç‚¹ï¼Œé‡‡ç”¨ä¸€ç§åªæœ‰äº”å±‚åè®®çš„ä½“ç³»ç»“æ„ï¼Œè¿™æ ·æ—¢ç®€æ´åˆèƒ½å°†æ¦‚å¿µé˜è¿°æ¸…æ¥šã€‚</p><ul><li><strong>åº”ç”¨å±‚åº”ç”¨å±‚ï¼ˆapplication-layerï¼‰</strong><br>çš„ä»»åŠ¡æ˜¯é€šè¿‡åº”ç”¨è¿›ç¨‹é—´çš„äº¤äº’æ¥å®Œæˆç‰¹å®šç½‘ç»œåº”ç”¨ã€‚åº”ç”¨å±‚åè®®å®šä¹‰çš„æ˜¯åº”ç”¨è¿›ç¨‹ï¼ˆè¿›ç¨‹ï¼šä¸»æœºä¸­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼‰é—´çš„é€šä¿¡å’Œäº¤äº’çš„è§„åˆ™ã€‚å¯¹äºä¸åŒçš„ç½‘ç»œåº”ç”¨éœ€è¦ä¸åŒçš„åº”ç”¨å±‚åè®®ã€‚åœ¨äº’è”ç½‘ä¸­åº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå¦‚åŸŸåç³»ç»Ÿ DNSï¼Œæ”¯æŒä¸‡ç»´ç½‘åº”ç”¨çš„ HTTP åè®®ï¼Œæ”¯æŒç”µå­é‚®ä»¶çš„ SMTP åè®®ç­‰ç­‰ã€‚æˆ‘ä»¬æŠŠåº”ç”¨å±‚äº¤äº’çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡ã€‚</li><li><strong>è¿è¾“å±‚è¿è¾“å±‚ï¼ˆtransport layerï¼‰</strong><br>çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯è´Ÿè´£å‘ä¸¤å°ä¸»æœºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚åº”ç”¨è¿›ç¨‹åˆ©ç”¨è¯¥æœåŠ¡ä¼ é€åº”ç”¨å±‚æŠ¥æ–‡ã€‚â€œé€šç”¨çš„â€æ˜¯æŒ‡å¹¶ä¸é’ˆå¯¹æŸä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œåº”ç”¨ï¼Œè€Œæ˜¯å¤šç§åº”ç”¨å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿è¾“å±‚æœåŠ¡ã€‚ç”±äºä¸€å°ä¸»æœºå¯åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå› æ­¤è¿è¾“å±‚æœ‰å¤ç”¨å’Œåˆ†ç”¨çš„åŠŸèƒ½ã€‚æ‰€è°“å¤ç”¨å°±æ˜¯æŒ‡å¤šä¸ªåº”ç”¨å±‚è¿›ç¨‹å¯åŒæ—¶ä½¿ç”¨ä¸‹é¢è¿è¾“å±‚çš„æœåŠ¡ï¼Œåˆ†ç”¨å’Œå¤ç”¨ç›¸åï¼Œæ˜¯è¿è¾“å±‚æŠŠæ”¶åˆ°çš„ä¿¡æ¯åˆ†åˆ«äº¤ä»˜ä¸Šé¢åº”ç”¨å±‚ä¸­çš„ç›¸åº”è¿›ç¨‹</li><li><strong>ç½‘ç»œå±‚</strong><br>åœ¨è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œé€šä¿¡çš„ä¸¤ä¸ªè®¡ç®—æœºä¹‹é—´å¯èƒ½ä¼šç»è¿‡å¾ˆå¤šä¸ªæ•°æ®é“¾è·¯ï¼Œä¹Ÿå¯èƒ½è¿˜è¦ç»è¿‡å¾ˆå¤šé€šä¿¡å­ç½‘ã€‚ç½‘ç»œå±‚çš„ä»»åŠ¡å°±æ˜¯é€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢ç»“ç‚¹ï¼Œ ç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€ã€‚åœ¨å‘é€æ•°æ®æ—¶ï¼Œç½‘ç»œå±‚æŠŠè¿è¾“å±‚äº§ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„å’ŒåŒ…è¿›è¡Œä¼ é€ã€‚åœ¨ TCP / IP ä½“ç³»ç»“æ„ä¸­ï¼Œç”±äºç½‘ç»œå±‚ä½¿ç”¨ IP åè®®ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå« IP æ•°æ®æŠ¥ï¼Œç®€ç§°æ•°æ®æŠ¥ã€‚</li><li><strong>æ•°æ®é“¾è·¯å±‚æ•°æ®é“¾è·¯å±‚ï¼ˆdata link layerï¼‰</strong><br>é€šå¸¸ç®€ç§°ä¸ºé“¾è·¯å±‚ã€‚ä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨ä¸€æ®µä¸€æ®µçš„é“¾è·¯ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®®ã€‚åœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œæ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„ IP æ•°æ®æŠ¥ç»„è£…æˆå¸§ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹é—´çš„é“¾è·¯ä¸Šä¼ é€å¸§ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚ï¼šåŒæ­¥ä¿¡æ¯ï¼Œåœ°å€ä¿¡æ¯ï¼Œå·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡æ¯ä½¿æ¥æ”¶ç«¯èƒ½å¤ŸçŸ¥é“ä¸€ä¸ªå¸§ä»å“ªä¸ªæ¯”ç‰¹å¼€å§‹å’Œåˆ°å“ªä¸ªæ¯”ç‰¹ç»“æŸã€‚è¿™æ ·ï¼Œæ•°æ®é“¾è·¯å±‚åœ¨æ”¶åˆ°ä¸€ä¸ªå¸§åï¼Œå°±å¯ä»ä¸­æå‡ºæ•°æ®éƒ¨åˆ†ï¼Œä¸Šäº¤ç»™ç½‘ç»œå±‚ã€‚æ§åˆ¶ä¿¡æ¯è¿˜ä½¿æ¥æ”¶ç«¯èƒ½å¤Ÿæ£€æµ‹åˆ°æ‰€æ”¶åˆ°çš„å¸§ä¸­æœ‰æ— å·®é”™ã€‚å¦‚æœå‘ç°å·®é”™ï¼Œæ•°æ®é“¾è·¯å±‚å°±ç®€å•åœ°ä¸¢å¼ƒè¿™ä¸ªå‡ºäº†å·®é”™çš„å¸§ï¼Œä»¥é¿å…ç»§ç»­åœ¨ç½‘ç»œä¸­ä¼ é€ä¸‹å»ç™½ç™½æµªè´¹ç½‘ç»œèµ„æºã€‚å¦‚æœéœ€è¦æ”¹æ­£æ•°æ®åœ¨é“¾è·¯å±‚ä¼ è¾“æ—¶å‡ºç°å·®é”™ï¼ˆè¿™å°±æ˜¯è¯´ï¼Œæ•°æ®é“¾è·¯å±‚ä¸ä»…è¦æ£€é”™ï¼Œè€Œä¸”è¿˜è¦çº é”™ï¼‰ï¼Œé‚£ä¹ˆå°±è¦é‡‡ç”¨å¯é æ€§ä¼ è¾“åè®®æ¥çº æ­£å‡ºç°çš„å·®é”™ã€‚è¿™ç§æ–¹æ³•ä¼šä½¿é“¾è·¯å±‚çš„åè®®å¤æ‚äº›ã€‚</li><li><strong>ç‰©ç†å±‚</strong><br>åœ¨ç‰©ç†å±‚ä¸Šæ‰€ä¼ é€çš„æ•°æ®å•ä½æ˜¯æ¯”ç‰¹ã€‚ç‰©ç†å±‚ï¼ˆphysical layerï¼‰çš„ä½œç”¨æ˜¯å®ç°ç›¸é‚»è®¡ç®—æœºèŠ‚ç‚¹ä¹‹é—´æ¯”ç‰¹æµçš„é€æ˜ä¼ é€ï¼Œå°½å¯èƒ½å±è”½æ‰å…·ä½“ä¼ è¾“ä»‹è´¨å’Œç‰©ç†è®¾å¤‡çš„å·®å¼‚ã€‚ä½¿å…¶ä¸Šé¢çš„æ•°æ®é“¾è·¯å±‚ä¸å¿…è€ƒè™‘ç½‘ç»œçš„å…·ä½“ä¼ è¾“ä»‹è´¨æ˜¯ä»€ä¹ˆã€‚â€œé€æ˜ä¼ é€æ¯”ç‰¹æµâ€è¡¨ç¤ºç»å®é™…ç”µè·¯ä¼ é€åçš„æ¯”ç‰¹æµæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯¹ä¼ é€çš„æ¯”ç‰¹æµæ¥è¯´ï¼Œè¿™ä¸ªç”µè·¯å¥½åƒæ˜¯çœ‹ä¸è§çš„ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¯æ—¥ä¸€é¢˜</title>
      <link href="/2019/10/29/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/"/>
      <url>/2019/10/29/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€é¢˜-â€˜1â€™-â€˜2â€™-â€˜3â€™-map-parseInt"><a href="#ç¬¬ä¸€é¢˜-â€˜1â€™-â€˜2â€™-â€˜3â€™-map-parseInt" class="headerlink" title="ç¬¬ä¸€é¢˜ : [â€˜1â€™, â€˜2â€™, â€˜3â€™].map(parseInt)"></a>ç¬¬ä¸€é¢˜ : [â€˜1â€™, â€˜2â€™, â€˜3â€™].map(parseInt)</h2><p>ç¬¬ä¸€çœ¼çœ‹åˆ°è¿™ä¸ªé¢˜ç›®çš„æ—¶å€™ï¼Œè„‘æµ·è·³å‡ºçš„ç­”æ¡ˆæ˜¯ [1, 2, 3]ï¼Œä½†æ˜¯çœŸæ­£çš„ç­”æ¡ˆæ˜¯[1, NaN, NaN]ã€‚</p><ul><li><p>é¦–å…ˆè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œ<code>map</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°callbackï¼š<br><code>var new_array = arr.map(function callback(currentValue[, index[, array]]) { // Return element for new_array }[, thisArg])</code><br>è¿™ä¸ªcallbackä¸€å…±å¯ä»¥æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨å½“å‰è¢«å¤„ç†çš„å…ƒç´ ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨è¯¥å…ƒç´ çš„ç´¢å¼•ã€‚</p></li><li><p>è€ŒparseIntåˆ™æ˜¯ç”¨æ¥è§£æå­—ç¬¦ä¸²çš„ï¼Œä½¿å­—ç¬¦ä¸²æˆä¸ºæŒ‡å®šåŸºæ•°çš„æ•´æ•°ã€‚<br>parseInt(string, radix)<br>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºè¢«å¤„ç†çš„å€¼ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºä¸ºè§£ææ—¶çš„åŸºæ•°ã€‚</p></li><li><p>äº†è§£è¿™ä¸¤ä¸ªå‡½æ•°åï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸‹è¿è¡Œæƒ…å†µ</p></li></ul><ol><li>parseInt(â€˜1â€™, 0) //radixä¸º0æ—¶ï¼Œä¸”stringå‚æ•°ä¸ä»¥â€œ0xâ€å’Œâ€œ0â€å¼€å¤´æ—¶ï¼ŒæŒ‰ç…§10ä¸ºåŸºæ•°å¤„ç†ã€‚è¿™ä¸ªæ—¶å€™è¿”å›1</li><li>parseInt(â€˜2â€™, 1) //åŸºæ•°ä¸º1ï¼ˆ1è¿›åˆ¶ï¼‰è¡¨ç¤ºçš„æ•°ä¸­ï¼Œæœ€å¤§å€¼å°äº2ï¼Œæ‰€ä»¥æ— æ³•è§£æï¼Œè¿”å›NaN</li><li>parseInt(â€˜3â€™, 2) //åŸºæ•°ä¸º2ï¼ˆ2è¿›åˆ¶ï¼‰è¡¨ç¤ºçš„æ•°ä¸­ï¼Œæœ€å¤§å€¼å°äº3ï¼Œæ‰€ä»¥æ— æ³•è§£æï¼Œè¿”å›NaN<br>mapå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æœ€åç»“æœä¸º<strong>[1, NaN, NaN]</strong></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é€è¡Œè§£æAxiosæºç </title>
      <link href="/2019/10/27/axios/"/>
      <url>/2019/10/27/axios/</url>
      
        <content type="html"><![CDATA[<h2 id="æºç ç›®å½•ç»“æ„"><a href="#æºç ç›®å½•ç»“æ„" class="headerlink" title="æºç ç›®å½•ç»“æ„"></a>æºç ç›®å½•ç»“æ„</h2><p><a href="https://juejin.im/post/5d501512518825159e3d7be6" target="_blank" rel="noopener">è½¬è‡ªæ˜é‡‘åšä¸»</a></p><pre><code># ğŸ“ lib# |â€”â€”  ğŸ“ adapters // axiosä¸»è¦ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•# |â€”â€”  |â€”â€”  ğŸ“ƒ http.js  // axiosä¸­nodeç«¯ä½¿ç”¨çš„è¯·æ±‚å‡½æ•°# |â€”â€”  |â€”â€”  ğŸ“ƒ xhr.js  // axiosä¸­æµè§ˆå™¨ç«¯ä½¿ç”¨çš„è¯·æ±‚å‡½æ•°# |â€”â€”  ğŸ“ cancel# |â€”â€”  |â€”â€”  ğŸ“ƒ Cancel.js // å®šä¹‰äº†ï¼Œå–æ¶ˆè¯·æ±‚è¿”å›çš„ä¿¡æ¯ç»“æ„# |â€”â€”  |â€”â€”  ğŸ“ƒ CancelToken.js // å®šä¹‰äº†ç”¨äºå–æ¶ˆè¯·æ±‚çš„ä¸»è¦æ–¹æ³•# |â€”â€”  |â€”â€”  ğŸ“ƒ isCancel.js // åˆ¤æ–­æ˜¯å¦æ˜¯å–æ¶ˆè¯·æ±‚çš„ä¿¡æ¯# |â€”â€”  ğŸ“ core# |â€”â€”  |â€”â€”  ğŸ“ƒ Axios.js // Axiosç±»# |â€”â€”  |â€”â€”  ğŸ“ƒ dispatchRequest.js // å‘èµ·è¯·æ±‚çš„åœ°æ–¹ # |â€”â€”  |â€”â€”  ğŸ“ƒ InterceptorManager.js // InterceptorManagerç±»ï¼Œæ‹¦æˆªå™¨ç±»# |â€”â€”  |â€”â€”  ğŸ“ƒ mergeConfig.js // åˆå¹¶é…ç½®é¡¹# |â€”â€”  |â€”â€”  ğŸ“ƒ settle.js // æ ¹æ®è¯·æ±‚çŠ¶æ€ï¼Œå¤„ç†Promise# |â€”â€”  |â€”â€”  ğŸ“ƒ createError.js // ç”ŸæˆæŒ‡å®šçš„error# |â€”â€”  |â€”â€”  ğŸ“ƒ enhanceError.js // æŒ‡å®šerrorå¯¹è±¡çš„toJSONæ–¹æ³•# |â€”â€”  |â€”â€”  ğŸ“ƒ transformData.js // ä½¿ç”¨default.jsä¸­transformRequestå’ŒtransformResponseå¯¹å“åº”ä»¥åŠè¯·æ±‚è¿›è¡Œæ ¼å¼åŒ–# |â€”â€”  ğŸ“ helpers# |â€”â€”  |â€”â€”  ğŸ“ƒ bind.js // å·¥å…·å‡½æ•°# |â€”â€”  |â€”â€”  ğŸ“ƒ parseHeaders.js // å°†getAllResponseHeadersè¿”å›çš„headerä¿¡æ¯è½¬åŒ–ä¸ºå¯¹è±¡# |â€”â€”  |â€”â€”  ğŸ“ƒ buildURL.js // å°†paramså‚æ•°# |â€”â€”  |â€”â€”  ğŸ“ƒ cookies.js // å°è£…äº†è¯»å–ï¼Œå†™å…¥ï¼Œåˆ é™¤cookiesçš„æ–¹æ³•# |â€”â€”  |â€”â€”  ğŸ“ƒ isURLSameOrigin.js // æ£€æµ‹å½“å‰çš„urlä¸è¯·æ±‚çš„urlæ˜¯å¦åŒæº# |â€”â€”  |â€”â€”  ğŸ“ƒ normalizeHeaderName.js // å¯¹å¯¹è±¡å±æ€§åçš„è¿›è¡Œæ ¼å¼åŒ–ï¼Œåˆ é™¤ï¼Œæ–°å»ºç¬¦åˆå¤§å°å†™è§„èŒƒçš„å±æ€§# |â€”â€”  |â€”â€”  ğŸ“ƒ combineURLs.js // ç»„åˆbaseurl# |â€”â€”  |â€”â€”  ğŸ“ƒ isAbsoluteURL.js // åˆ¤æ–­æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ï¼ˆæŒ‡çš„://æˆ–//å¼€å¤´çš„ä¸ºç»å¯¹è·¯å¾„ï¼‰# |â€”â€”  ğŸ“ƒ axios.js# |â€”â€”  ğŸ“ƒ defaults.js // axiosä¸­é»˜è®¤é…ç½®# |â€”â€”  ğŸ“ƒ utils.js // ä¸€äº›å·¥å…·æ–¹æ³•# |â€”â€”  |â€”â€”  â¹ isFormData // åˆ¤æ–­æ˜¯å¦æ˜¯formDataå¯¹è±¡# |â€”â€”  |â€”â€”  â¹ isStandardBrowserEnv // åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºæ ‡å‡†æµè§ˆå™¨ç¯å¢ƒ# |â€”â€”  |â€”â€”  â¹ isUndefined // åˆ¤æ–­æ˜¯å¦ä¸ºundefined# |â€”â€”  |â€”â€”  â¹ merge# |â€”â€”  |â€”â€”  â¹ isURLSearchParams // åˆ¤æ–­æ˜¯å¦ä¸ºURLSearchParamså¯¹è±¡</code></pre><h2 id="è¯·æ±‚æµç¨‹æ¦‚è§ˆ"><a href="#è¯·æ±‚æµç¨‹æ¦‚è§ˆ" class="headerlink" title="è¯·æ±‚æµç¨‹æ¦‚è§ˆ"></a>è¯·æ±‚æµç¨‹æ¦‚è§ˆ</h2><p><img src="https://user-gold-cdn.xitu.io/2019/8/8/16c708fba0d57810?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt></p><h2 id="æºç é€è¡Œåˆ†æ"><a href="#æºç é€è¡Œåˆ†æ" class="headerlink" title="æºç é€è¡Œåˆ†æ"></a>æºç é€è¡Œåˆ†æ</h2><h3 id="lib-cancel-CancelToken-js"><a href="#lib-cancel-CancelToken-js" class="headerlink" title="/lib/cancel/CancelToken.js"></a>/lib/cancel/CancelToken.js</h3><blockquote><p>CancelToken.jsä¸­å®šä¹‰äº†å–æ¶ˆaxiosè¯·æ±‚çš„ç›¸å…³è¡Œä¸ºçš„ä»£ç ã€‚ä½†CancelToken.sourceè¿”å›çš„å–æ¶ˆè¯·æ±‚çš„cancelæ–¹æ³•ï¼Œä½¿ç”¨çš„å‰æï¼Œæ˜¯éœ€è¦å°†CancelToken.sourceè¿”å›tokençš„ï¼Œç»“åˆåˆ°å…·ä½“çš„è¯·æ±‚çš„configä¸­æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p></blockquote><h4 id="å¦‚ä½•åœ¨axiosä¸­ä½¿ç”¨å–æ¶ˆè¯·æ±‚çš„åŠŸèƒ½ï¼Ÿ"><a href="#å¦‚ä½•åœ¨axiosä¸­ä½¿ç”¨å–æ¶ˆè¯·æ±‚çš„åŠŸèƒ½ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨axiosä¸­ä½¿ç”¨å–æ¶ˆè¯·æ±‚çš„åŠŸèƒ½ï¼Ÿ"></a>å¦‚ä½•åœ¨axiosä¸­ä½¿ç”¨å–æ¶ˆè¯·æ±‚çš„åŠŸèƒ½ï¼Ÿ</h4><p>æˆ‘åœ¨çœ‹axiosæºç ä¹‹å‰ï¼Œç”šè‡³å¹¶ä¸çŸ¥é“axioså¯ä»¥å‘å‡ºçš„è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹å¦‚ä½•åœ¨axioså–æ¶ˆä¸€ä¸ªè¯·æ±‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ğŸŒ°</p><pre><code>// axiosç”¨äºå–æ¶ˆè¯·æ±‚çš„ç±»const CancelToken = axios.CancelToken// sourceæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡åŒ…å«// {  // token, æ·»åŠ åˆ°è¯·æ±‚çš„configï¼Œç”¨äºæ ‡è¯†è¯·æ±‚  // cancel, è°ƒç”¨cancelæ–¹æ³•å–æ¶ˆè¯·æ±‚// }const source = CancelToken.source()axios.get(&#39;/info&#39;, {  cancelToken: source.token}).catch(function(error) {  if (axios.isCancel(error)) {    console.log(&#39;å–æ¶ˆè¯·æ±‚çš„é”™è¯¯&#39;)  } else {    // å…¶ä»–é”™è¯¯  }})// è°ƒç”¨source.cancelå¯ä»¥å–æ¶ˆaxios.get(&#39;/info&#39;)çš„è¯·æ±‚source.cancel(&#39;å–æ¶ˆè¯·æ±‚&#39;)</code></pre><h4 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h4><pre><code>var Cancel = require(&#39;./Cancel&#39;);function CancelToken(executor) {  if (typeof executor !== &#39;function&#39;) {    throw new TypeError(&#39;executor must be a function.&#39;);  }  var resolvePromise;  // åˆ›å»ºä¸€ä¸ªPromise  // åœ¨è°ƒç”¨cancelå‡½æ•°å‰è¯¥promiseä¼šä¸€ç›´å¤„äºpendingçŠ¶æ€  this.promise = new Promise(function promiseExecutor(resolve) {    resolvePromise = resolve;  });  var token = this;  executor(function cancel(message) {    // åˆ¤æ–­æ˜¯å¦å·²ç»å–æ¶ˆè¯·æ±‚äº†    if (token.reason) {      return;    }    // åˆ›å»ºå–æ¶ˆè¯·æ±‚çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯æ·»åŠ åˆ°å®ä¾‹çš„reasonå±æ€§ä¸Š    token.reason = new Cancel(message);    // ç»“æŸthis.promiseçš„pendingçŠ¶æ€    // å°†this.promiseçŠ¶æ€è®¾ç½®ä¸ºresolve    resolvePromise(token.reason);  });}// åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦å·²ç»è¢«å–æ¶ˆçš„æ–¹æ³•CancelToken.prototype.throwIfRequested = function throwIfRequested() {  if (this.reason) {    throw this.reason;  }};CancelToken.source = function source() {  var cancel;  var token = new CancelToken(function executor(c) {    cancel = c;  });  return {    token: token,    cancel: cancel  };};module.exports = CancelToken;</code></pre><p>ğŸ¤” çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æ˜¯æ— æ³•äº†è§£axiosæ˜¯å¦‚ä½•å–æ¶ˆä¸€ä¸ªè¯·æ±‚çš„ã€‚å› ä¸ºå•ç‹¬ä½¿ç”¨CancelToken.sourceè¿”å›çš„cancelæ˜¯æ— æ³•å–æ¶ˆä¸€ä¸ªè¯·æ±‚çš„ï¼Œæˆ‘ä»¬éœ€è¦ç»“åˆxhr.jsä¸­çš„ä»£ç æ¥ç†è§£ã€‚</p><pre><code>// /lib/adapters/xhr.jsrequest.open()// ...çœç•¥// å¦‚æœé…ç½®äº†cancelTokené€‰é¡¹if (config.cancelToken) {  // å¯¹CancelTokenä¸­åˆ›å»ºçš„Promiseæ·»åŠ æˆåŠŸçš„å›è°ƒ  // å½“è°ƒç”¨CancelToken.sourceæš´éœ²çš„cancelå‡½æ•°æ—¶ï¼Œå›è°ƒä¼šè¢«è§¦å‘  config.cancelToken.promise.then(function onCanceled(cancel) {    if (!request) {      return;    }    // å–æ¶ˆxhrè¯·æ±‚    request.abort();    // å°†axiosè¿”å›çš„promiseï¼Œç½®ä¸ºrejectæ€    reject(cancel);    request = null;  });}// ...çœç•¥request.send()</code></pre><p>æƒ³å¿…å¤§å®¶çœ‹åˆ°è¿™é‡Œï¼Œå¯¹axiosä¸­å¦‚ä½•è¯·æ±‚æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ã€‚æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡<strong>CancelTokenï¼Œåˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„PromiseAï¼Œå¹¶å°†PromiseAæŒ‚è½½åˆ°configä¸­ï¼ŒåŒæ—¶å°†è¯¥PromiseAçš„resolveæ–¹æ³•æš´éœ²å‡ºå»ã€‚æˆ‘ä»¬åœ¨è°ƒç”¨sendæ–¹æ³•å‰ï¼ˆå‘é€è¯·æ±‚å‰ï¼‰æ·»åŠ å¯¹PromiseAçš„çŠ¶æ€è¿›è¡Œç›‘å¬ï¼Œå½“PromiseAçš„çŠ¶æ€è¢«ä¿®æ”¹ï¼Œæˆ‘ä»¬ä¼šåœ¨PromiseAçš„callbackä¸­å–æ¶ˆè¯·æ±‚ï¼Œå¹¶ä¸”å°†axiosè¿”å›çš„PromiseBçš„çŠ¶æ€ç½®ä¸ºrejectã€‚ä»è€Œè¾¾åˆ°å–æ¶ˆè¯·æ±‚çš„ç›®çš„</strong>.</p><h3 id="lib-adapters-xhr-js"><a href="#lib-adapters-xhr-js" class="headerlink" title="/lib/adapters/xhr.js"></a>/lib/adapters/xhr.js</h3><blockquote><p>xhr.jså¯¼å‡ºçš„xhrAdapteræ–¹æ³•æ˜¯axiosåœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ä½¿ç”¨çš„é»˜è®¤è¯·æ±‚æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä¸­ä½¿ç”¨adapteré…ç½®é¡¹å¯¹é»˜è®¤è¯·æ±‚æ–¹æ³•è¿›è¡Œæ›¿æ¢ã€‚</p></blockquote><h4 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h4><pre><code>module.exports = function xhrAdapter(config) {  return new Promise(function dispatchXhrRequest(resolve, reject) {    var requestData = config.data;    var requestHeaders = config.headers;    // åˆ¤æ–­æ˜¯å¦æ˜¯FormDataå¯¹è±¡, å¦‚æœæ˜¯, åˆ é™¤headerçš„Content-Typeå­—æ®µï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®Content-Typeå­—æ®µ    if (utils.isFormData(requestData)) {      delete requestHeaders[&#39;Content-Type&#39;];    }    // åˆ›å»ºxtrå¯¹è±¡    var request = new XMLHttpRequest();    // è®¾ç½®httpè¯·æ±‚å¤´ä¸­çš„Authorizationå­—æ®µ    // å…³äºAuthorizationå­—æ®µ    // æ›´å¤šå†…å®¹å‚è€ƒhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Authorization    if (config.auth) {      var username = config.auth.username || &#39;&#39;;      var password = config.auth.password || &#39;&#39;;      // ä½¿ç”¨btoaæ–¹æ³•base64ç¼–ç usernameå’Œpassword      requestHeaders.Authorization = &#39;Basic &#39; + btoa(username + &#39;:&#39; + password);    }    // åˆå§‹åŒ–è¯·æ±‚æ–¹æ³•    // open(method: è¯·æ±‚çš„httpæ–¹æ³•, url: è¯·æ±‚çš„urlåœ°å€, æ˜¯å¦æ”¯æŒå¼‚æ­¥)    request.open(      config.method.toUpperCase(),      buildURL(config.url, config.params, config.paramsSerializer),      true    );    // è®¾ç½®è¶…æ—¶æ—¶é—´    request.timeout = config.timeout;    // ç›‘å¬readyStateçŠ¶æ€çš„å˜åŒ–ï¼Œå½“readyStateçŠ¶æ€ä¸º4çš„æ—¶å€™ï¼Œè¡¨ç¤ºajaxè¯·æ±‚æˆåŠŸ    request.onreadystatechange = function handleLoad() {      if (!request || request.readyState !== 4) {        return;      }      // request.statuså“åº”çš„æ•°å­—çŠ¶æ€ç ï¼Œåœ¨å®Œæˆè¯·æ±‚å‰æ•°å­—çŠ¶æ€ç ç­‰äº0      // å¦‚æœrequest.statuså‡ºé”™è¿”å›çš„ä¹Ÿæ˜¯0ï¼Œä½†æ˜¯fileåè®®é™¤å¤–ï¼Œstatusç­‰äº0ä¹Ÿæ˜¯ä¸€ä¸ªæˆåŠŸçš„è¯·æ±‚      // æ›´å¤šå†…å®¹è¯·å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/status      if (request.status === 0 &amp;&amp; !(request.responseURL &amp;&amp; request.responseURL.indexOf(&#39;file:&#39;) === 0)) {        return;      }      // getAllResponseHeadersæ–¹æ³•ä¼šè¿”å›æ‰€æœ‰çš„å“åº”å¤´      // æ›´å¤šå†…å®¹è¯·å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/getAllResponseHeaders      var responseHeaders = &#39;getAllResponseHeaders&#39; in request ? parseHeaders(request.getAllResponseHeaders()) : null;      // å¦‚æœæ²¡æœ‰è®¾ç½®æ•°æ®å“åº”ç±»å‹ï¼ˆé»˜è®¤ä¸ºâ€œjsonâ€ï¼‰æˆ–è€…responseTypeè®¾ç½®ä¸ºtextæ—¶ï¼Œè·å–request.responseTextå€¼å¦åˆ™æ˜¯è·å–request.response      // responseTypeæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œæ‰‹åŠ¨è®¾ç½®è¿”å›æ•°æ®çš„ç±»å‹ æ›´å¤šè¯·å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseType      // responseTextæ˜¯å…¨éƒ¨åç«¯çš„è¿”å›æ•°æ®ä¸ºçº¯æ–‡æœ¬çš„å€¼ æ›´å¤šè¯·å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseText      // responseä¸ºæ­£æ–‡ï¼Œresponseçš„ç±»å‹å–å†³äºresponseType æ›´å¤šè¯·å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/response      var responseData = !config.responseType || config.responseType === &#39;text&#39; ? request.responseText : request.response;      var response = {        data: responseData, // å“åº”æ­£æ–‡        status: request.status, // å“åº”çŠ¶æ€        statusText: request.statusText, // å“åº”çŠ¶æ€çš„æ–‡æœ¬ä¿¡æ¯        headers: responseHeaders, // å“åº”å¤´        config: config,        request: request      };      // status &gt;= 200 &amp;&amp; status &lt; 300 resolve      // å¦åˆ™reject      settle(resolve, reject, response);      request = null;    };    // ajaxä¸­æ–­æ—¶è§¦å‘    request.onabort = function handleAbort() {      if (!request) {        return;      }      // æŠ›å‡ºRequest abortedé”™è¯¯      reject(createError(&#39;Request aborted&#39;, config, &#39;ECONNABORTED&#39;, request));      request = null;    };    // ajaxå¤±è´¥æ—¶è§¦å‘    request.onerror = function handleError() {      // æŠ›å‡ºNetwork Erroré”™è¯¯      reject(createError(&#39;Network Error&#39;, config, null, request));      request = null;    };    // ajaxè¯·æ±‚è¶…æ—¶æ—¶è°ƒç”¨    request.ontimeout = function handleTimeout() {      // æŠ›å‡º timeouté”™è¯¯      reject(createError(&#39;timeout of &#39; + config.timeout + &#39;ms exceeded&#39;, config, &#39;ECONNABORTED&#39;,        request));      request = null;    };    // åˆ¤æ–­å½“å‰æ˜¯ä¸ºæ ‡å‡†æµè§ˆå™¨ç¯å¢ƒï¼Œå¦‚æœæ˜¯ï¼Œæ·»åŠ xsrfå¤´    // ä»€ä¹ˆæ˜¯xsrf headerï¼Ÿ xsrf headeræ˜¯ç”¨æ¥é˜²å¾¡CSRFæ”»å‡»    // åŸç†æ˜¯æœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªXSRF-TOKENï¼Œå¹¶ä¿å­˜åˆ°æµè§ˆå™¨çš„cookieä¸­ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚ä¸­ajaxéƒ½ä¼šå°†XSRF-TOKENè®¾ç½®åˆ°request headerä¸­    // æœåŠ¡å™¨ä¼šæ¯”è¾ƒcookieä¸­çš„XSRF-TOKENä¸headerä¸­XSRF-TOKENæ˜¯å¦ä¸€è‡´    // æ ¹æ®åŒæºç­–ç•¥ï¼ŒéåŒæºçš„ç½‘ç«™æ— æ³•è¯»å–ä¿®æ”¹æœ¬æºçš„ç½‘ç«™cookieï¼Œé¿å…äº†ä¼ªé€ cookie    if (utils.isStandardBrowserEnv()) {      var cookies = require(&#39;./../helpers/cookies&#39;);      // withCredentialsè®¾ç½®è·¨åŸŸè¯·æ±‚ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨cookie æ›´å¤šè¯·å‚è€ƒ https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/withCredentials      // ï¼ˆè®¾ç½®äº†withCredentialsä¸ºtrueæˆ–è€…æ˜¯åŒæºè¯·æ±‚ï¼‰å¹¶ä¸”è®¾ç½®xsrfCookieName      var xsrfValue = (config.withCredentials || isURLSameOrigin(config.url)) &amp;&amp; config.xsrfCookieName ?      // è¯»å–cookieä¸­XSRF-TOKEN        cookies.read(config.xsrfCookieName) :        undefined;      if (xsrfValue) {        // åœ¨request headerä¸­è®¾ç½®XSRF-TOKEN        requestHeaders[config.xsrfHeaderName] = xsrfValue;      }    }    // setRequestHeaderæ˜¯ç”¨æ¥è®¾ç½®è¯·æ±‚å¤´éƒ¨çš„æ–¹æ³•    if (&#39;setRequestHeader&#39; in request) {      // å°†configä¸­é…ç½®çš„requestHeadersï¼Œå¾ªç¯è®¾ç½®åˆ°è¯·æ±‚å¤´ä¸Š      utils.forEach(requestHeaders, function setRequestHeader(val, key) {        if (typeof requestData === &#39;undefined&#39; &amp;&amp; key.toLowerCase() === &#39;content-type&#39;) {          delete requestHeaders[key];        } else {          request.setRequestHeader(key, val);        }      });    }    // è®¾ç½®xhrå¯¹è±¡çš„withCredentialså±æ€§ï¼Œæ˜¯å¦å…è®¸cookieè¿›è¡Œè·¨åŸŸè¯·æ±‚    if (config.withCredentials) {      request.withCredentials = true;    }    // è®¾ç½®xhrå¯¹è±¡çš„responseTypeå±æ€§    if (config.responseType) {      try {        request.responseType = config.responseType;      } catch (e) {        if (config.responseType !== &#39;json&#39;) {          throw e;        }      }    }    // ä¸‹è½½è¿›åº¦    if (typeof config.onDownloadProgress === &#39;function&#39;) {      request.addEventListener(&#39;progress&#39;, config.onDownloadProgress);    }    // ä¸Šä¼ è¿›åº¦    // request.upload XMLHttpRequest.upload å±æ€§è¿”å›ä¸€ä¸ª XMLHttpRequestUploadå¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºä¸Šä¼ çš„è¿›åº¦    if (typeof config.onUploadProgress === &#39;function&#39; &amp;&amp; request.upload) {      request.upload.addEventListener(&#39;progress&#39;, config.onUploadProgress);    }    if (config.cancelToken) {      // å–æ¶ˆè¯·æ±‚ï¼Œåœ¨ä»‹ç»/lib/cancel/CancelToken.jsä¸­ä»¥åŠä»‹ç»ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°      config.cancelToken.promise.then(function onCanceled(cancel) {        if (!request) {          return;        }        request.abort();        reject(cancel);        request = null;      });    }    if (requestData === undefined) {      requestData = null;    }    // å‘é€httpè¯·æ±‚    request.send(requestData);  });};</code></pre><h3 id="lib-core-dispatchRequest-js"><a href="#lib-core-dispatchRequest-js" class="headerlink" title="/lib/core/dispatchRequest.js"></a>/lib/core/dispatchRequest.js</h3><blockquote><p>dispatchRequest.jsæ–‡ä»¶æ˜¯axiosæºç ä¸­å®é™…è°ƒç”¨è¯·æ±‚çš„åœ°æ–¹ã€‚</p></blockquote><h4 id="æºç -2"><a href="#æºç -2" class="headerlink" title="æºç "></a>æºç </h4><pre><code>var utils = require(&#39;./../utils&#39;);var transformData = require(&#39;./transformData&#39;);var isCancel = require(&#39;../cancel/isCancel&#39;);var defaults = require(&#39;../defaults&#39;);var isAbsoluteURL = require(&#39;./../helpers/isAbsoluteURL&#39;);var combineURLs = require(&#39;./../helpers/combineURLs&#39;);// åˆ¤æ–­è¯·æ±‚æ˜¯å¦å·²è¢«å–æ¶ˆï¼Œå¦‚æœå·²ç»è¢«å–æ¶ˆï¼ŒæŠ›å‡ºå·²å–æ¶ˆfunction throwIfCancellationRequested(config) {  if (config.cancelToken) {    config.cancelToken.throwIfRequested();  }}module.exports = function dispatchRequest(config) {  throwIfCancellationRequested(config);  // å¦‚æœåŒ…å«baseUrl, å¹¶ä¸”ä¸æ˜¯config.urlç»å¯¹è·¯å¾„ï¼Œç»„åˆbaseUrlä»¥åŠconfig.url  if (config.baseURL &amp;&amp; !isAbsoluteURL(config.url)) {    // ç»„åˆbaseURLä¸urlå½¢æˆå®Œæ•´çš„è¯·æ±‚è·¯å¾„    config.url = combineURLs(config.baseURL, config.url);  }  config.headers = config.headers || {};  // ä½¿ç”¨/lib/defaults.jsä¸­çš„transformRequestæ–¹æ³•ï¼Œå¯¹config.headerså’Œconfig.dataè¿›è¡Œæ ¼å¼åŒ–  // æ¯”å¦‚å°†headersä¸­çš„Acceptï¼ŒContent-Typeç»Ÿä¸€å¤„ç†æˆå¤§å†™  // æ¯”å¦‚å¦‚æœè¯·æ±‚æ­£æ–‡æ˜¯ä¸€ä¸ªObjectä¼šæ ¼å¼åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¹¶æ·»åŠ application/json;charset=utf-8çš„Content-Type  // ç­‰ä¸€ç³»åˆ—æ“ä½œ  config.data = transformData(    config.data,    config.headers,    config.transformRequest  );  // åˆå¹¶ä¸åŒé…ç½®çš„headersï¼Œconfig.headersçš„é…ç½®ä¼˜å…ˆçº§æ›´é«˜  config.headers = utils.merge(    config.headers.common || {},    config.headers[config.method] || {},    config.headers || {}  );  // åˆ é™¤headersä¸­çš„methodå±æ€§  utils.forEach(    [&#39;delete&#39;, &#39;get&#39;, &#39;head&#39;, &#39;post&#39;, &#39;put&#39;, &#39;patch&#39;, &#39;common&#39;],    function cleanHeaderConfig(method) {      delete config.headers[method];    }  );  // å¦‚æœconfigé…ç½®äº†adapterï¼Œä½¿ç”¨configä¸­é…ç½®adapterçš„æ›¿ä»£é»˜è®¤çš„è¯·æ±‚æ–¹æ³•  var adapter = config.adapter || defaults.adapter;  // ä½¿ç”¨adapteræ–¹æ³•å‘èµ·è¯·æ±‚ï¼ˆadapteræ ¹æ®æµè§ˆå™¨ç¯å¢ƒæˆ–è€…Nodeç¯å¢ƒä¼šæœ‰ä¸åŒï¼‰  return adapter(config).then(    // è¯·æ±‚æ­£ç¡®è¿”å›çš„å›è°ƒ    function onAdapterResolution(response) {      // åˆ¤æ–­æ˜¯å¦ä»¥åŠå–æ¶ˆäº†è¯·æ±‚ï¼Œå¦‚æœå–æ¶ˆäº†è¯·æ±‚æŠ›å‡ºä»¥å–æ¶ˆ      throwIfCancellationRequested(config);      // ä½¿ç”¨/lib/defaults.jsä¸­çš„transformResponseæ–¹æ³•ï¼Œå¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®è¿›è¡Œæ ¼å¼åŒ–      // ä¾‹å¦‚ï¼Œä½¿ç”¨JSON.parseå¯¹å“åº”æ­£æ–‡è¿›è¡Œè§£æ      response.data = transformData(        response.data,        response.headers,        config.transformResponse      );      return response;    },    // è¯·æ±‚å¤±è´¥çš„å›è°ƒ    function onAdapterRejection(reason) {      if (!isCancel(reason)) {        throwIfCancellationRequested(config);        if (reason &amp;&amp; reason.response) {          reason.response.data = transformData(            reason.response.data,            reason.response.headers,            config.transformResponse          );        }      }      return Promise.reject(reason);    }  );};</code></pre><h3 id="lib-core-InterceptorManager-js"><a href="#lib-core-InterceptorManager-js" class="headerlink" title="/lib/core/InterceptorManager.js"></a>/lib/core/InterceptorManager.js</h3><blockquote><p>InterceptorManager.jsæ–‡ä»¶ä¸­å®šä¹‰äº†axiosæ‹¦æˆªå™¨ç±»ã€‚åŒ…å«äº†æ‹¦æˆªå™¨çš„æ·»åŠ ï¼Œåˆ é™¤ï¼Œå¾ªç¯æ‹¦æˆªå™¨ã€‚æ— è®ºæ˜¯å“åº”æ‹¦æˆªå™¨è¿˜æ˜¯è¯·æ±‚æ‹¦æˆªå™¨ï¼Œéƒ½æ˜¯ä½¿ç”¨æ•°ç»„è¿›è¡Œå­˜å‚¨çš„ã€‚</p></blockquote><h4 id="æºç -3"><a href="#æºç -3" class="headerlink" title="æºç "></a>æºç </h4><pre><code>var utils = require(&#39;./../utils&#39;);// æ‹¦æˆªå™¨ç±»function InterceptorManager() {  // handlersæ•°ç»„ç”¨æ¥å­˜å‚¨æ‹¦æˆªå™¨  this.handlers = [];}// æ·»åŠ æ‹¦æˆªå™¨ï¼Œuseæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ŒæˆåŠŸçš„å›è°ƒä»¥åŠå¤±è´¥çš„å›è°ƒInterceptorManager.prototype.use = function use(fulfilled, rejected) {  this.handlers.push({    // æˆåŠŸçš„å›è°ƒ    fulfilled: fulfilled,    // å¤±è´¥çš„å›è°ƒ    rejected: rejected  });  return this.handlers.length - 1;};// æ ¹æ®id(ç´¢å¼•)ï¼Œåˆ é™¤å®ä¾‹handlerså±æ€§ä¸­æ‹¦æˆªå™¨InterceptorManager.prototype.eject = function eject(id) {  if (this.handlers[id]) {    this.handlers[id] = null;  }};// å¾ªç¯æ‹¦æˆªå™¨InterceptorManager.prototype.forEach = function forEach(fn) {  utils.forEach(this.handlers, function forEachHandler(h) {    if (h !== null) {      fn(h);    }  });};</code></pre><h3 id="lib-core-Axios-js"><a href="#lib-core-Axios-js" class="headerlink" title="/lib/core/Axios.js"></a>/lib/core/Axios.js</h3><p><img src="https://user-gold-cdn.xitu.io/2019/8/8/16c708fba0e4e57d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt></p><blockquote><p>Axios.jsæ–‡ä»¶ä¸­å®šä¹‰äº†Axioså®ä¾‹ä¸Šçš„requestï¼Œgetï¼Œpostï¼Œdeleteæ–¹æ³•ã€‚getï¼Œpostï¼Œdeleteç­‰æ–¹æ³•å‡æ˜¯åŸºäºAxios.prototype.requestçš„å°è£…ğŸ“¦ã€‚åœ¨Axios.prototype.requestä¸­ä¼šä¾æ¬¡æ‰§è¡Œè¯·æ±‚æ‹¦æˆªå™¨ï¼ŒdispatchRequestï¼ˆå®é™…å‘èµ·ï¼‰ï¼Œå“åº”æ‹¦æˆªå™¨ã€‚æ•´ä½“çš„æµç¨‹å¦‚ğŸ‘†ä¸Šå›¾æ‰€ç¤ºã€‚</p></blockquote><h4 id="æºç -4"><a href="#æºç -4" class="headerlink" title="æºç "></a>æºç </h4><pre><code>var utils = require(&#39;./../utils&#39;);var buildURL = require(&#39;../helpers/buildURL&#39;);var InterceptorManager = require(&#39;./InterceptorManager&#39;);var dispatchRequest = require(&#39;./dispatchRequest&#39;);var mergeConfig = require(&#39;./mergeConfig&#39;);function Axios(instanceConfig) {  // Axiosçš„é…ç½®  this.defaults = instanceConfig;  // æ‹¦æˆªå™¨  this.interceptors = {    request: new InterceptorManager(), // è¯·æ±‚æ‹¦æˆªå™¨    response: new InterceptorManager() // å“åº”æ‹¦æˆªå™¨  };}Axios.prototype.request = function request(config) {  // å¦‚æœconfigæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŠŠå­—ç¬¦ä¸²å½“ä½œè¯·æ±‚çš„urlåœ°å€  if (typeof config === &#39;string&#39;) {    config = arguments[1] || {};    config.url = arguments[0];  } else {    config = config || {};  }  // åˆå¹¶é…ç½®  config = mergeConfig(this.defaults, config);  // å¦‚æœæ²¡æœ‰æŒ‡å®šè¯·æ±‚æ–¹æ³•ï¼Œä½¿ç”¨getæ–¹æ³•  config.method = config.method ? config.method.toLowerCase() : &#39;get&#39;;  var promise = Promise.resolve(config);  // å°†è¯·æ±‚æ‹¦æˆªå™¨ï¼Œå’Œå“åº”æ‹¦æˆªå™¨ï¼Œä»¥åŠå®é™…çš„è¯·æ±‚ï¼ˆdispatchRequestï¼‰çš„æ–¹æ³•ç»„åˆæˆæ•°ç»„ï¼Œç±»ä¼¼å¦‚ä¸‹çš„ç»“æ„  // [è¯·æ±‚æ‹¦æˆªå™¨1success, è¯·æ±‚æ‹¦æˆªå™¨1error, è¯·æ±‚æ‹¦æˆªå™¨2success, è¯·æ±‚æ‹¦æˆªå™¨2error, dispatchRequest, undefined, å“åº”æ‹¦æˆªå™¨1success, å“åº”æ‹¦æˆªå™¨1error]  var chain = [dispatchRequest, undefined];  this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {    chain.unshift(interceptor.fulfilled, interceptor.rejected);  });  this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {    chain.push(interceptor.fulfilled, interceptor.rejected);  });  // å¼€å§‹æ‰§è¡Œæ•´ä¸ªè¯·æ±‚æµç¨‹ï¼ˆè¯·æ±‚æ‹¦æˆªå™¨-&gt;dispatchRequest-&gt;å“åº”æ‹¦æˆªå™¨ï¼‰  // æµç¨‹å¯ä»¥ç†è§£ä¸ºä¸Šå›¾â¬†ï¸  while (chain.length) {    promise = promise.then(chain.shift(), chain.shift());  }  return promise;};Axios.prototype.getUri = function getUri(config) {  config = mergeConfig(this.defaults, config);  return buildURL(config.url, config.params, config.paramsSerializer).replace(/^\?/, &#39;&#39;);};// åŸºäºAxios.prototype.requestå°è£…å…¶ä»–æ–¹æ³•// å°†deleteï¼Œgetï¼Œheadï¼Œoptionsï¼Œpostï¼Œputï¼Œpatchæ·»åŠ åˆ°Axios.prototypeçš„åŸå‹é“¾ä¸Š// Axios.prototype.delete =// Axios.prototype.get =// Axios.prototype.head =// Axios.prototype.options =// ...utils.forEach([&#39;delete&#39;, &#39;get&#39;, &#39;head&#39;, &#39;options&#39;], function forEachMethodNoData(method) {  Axios.prototype[method] = function(url, config) {    return this.request(utils.merge(config || {}, {      method: method,      url: url    }));  };});utils.forEach([&#39;post&#39;, &#39;put&#39;, &#39;patch&#39;], function forEachMethodWithData(method) {  Axios.prototype[method] = function(url, data, config) {    return this.request(utils.merge(config || {}, {      method: method,      url: url,      data: data    }));  };});module.exports = Axios;</code></pre><h3 id="lib-defaults-js"><a href="#lib-defaults-js" class="headerlink" title="/lib/defaults.js"></a>/lib/defaults.js</h3><blockquote><p>defaults.jsæ–‡ä»¶ä¸­é…ç½®äº†ï¼Œaxiosé»˜è®¤çš„è¯·æ±‚å¤´ã€ä¸åŒçš„ç¯å¢ƒä¸‹axiosé»˜è®¤ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•ã€æ ¼å¼åŒ–è¯·æ±‚æ­£æ–‡çš„æ–¹æ³•ï¼Œæ ¼å¼åŒ–å“åº”æ­£æ–‡æ–¹æ³•ç­‰å†…å®¹</p></blockquote><h4 id="æºç -5"><a href="#æºç -5" class="headerlink" title="æºç "></a>æºç </h4><pre><code>var utils = require(&#39;./utils&#39;);var normalizeHeaderName = require(&#39;./helpers/normalizeHeaderName&#39;);// é»˜è®¤Content-Typevar DEFAULT_CONTENT_TYPE = {  &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;};// è®¾ç½®ContentTypeï¼Œåœ¨æ²¡æœ‰è®¾ç½®çš„æƒ…å†µä¸‹function setContentTypeIfUnset(headers, value) {  if (!utils.isUndefined(headers) &amp;&amp; utils.isUndefined(headers[&#39;Content-Type&#39;])) {    headers[&#39;Content-Type&#39;] = value;  }}// æ ¹æ®å½“å‰ç¯å¢ƒï¼Œè·å–é»˜è®¤çš„è¯·æ±‚æ–¹æ³•function getDefaultAdapter() {  var adapter;  // åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦å­˜åœ¨processå¯¹è±¡  if (typeof process !== &#39;undefined&#39; &amp;&amp; Object.prototype.toString.call(process) === &#39;[object process]&#39;) {    // nodeç¯å¢ƒ    adapter = require(&#39;./adapters/http&#39;);  } else if (typeof XMLHttpRequest !== &#39;undefined&#39;) {    // æµè§ˆå™¨ç¯å¢ƒ    adapter = require(&#39;./adapters/xhr&#39;);  }  return adapter;}var defaults = {  // é»˜è®¤çš„è¯·æ±‚æ–¹æ³•  adapter: getDefaultAdapter(),  // æ ¼å¼åŒ–è¯·æ±‚requestDataï¼Œè¿™ä¼šè¯·æ±‚å‘é€å‰ä½¿ç”¨  transformRequest: [    function transformRequest(data, headers) {      // æ ¼å¼åŒ–headerå±æ€§åï¼Œå°†headerä¸­ä¸æ ‡å‡†çš„å±æ€§åï¼Œæ ¼å¼åŒ–ä¸ºAcceptå±æ€§å      normalizeHeaderName(headers, &#39;Accept&#39;);      // æ ¼å¼åŒ–headerå±æ€§åï¼Œå°†headerä¸­ä¸æ ‡å‡†çš„å±æ€§åï¼Œæ ¼å¼åŒ–ä¸ºContent-Typeå±æ€§å      normalizeHeaderName(headers, &#39;Content-Type&#39;);      if (utils.isFormData(data) ||        utils.isArrayBuffer(data) ||        utils.isBuffer(data) ||        utils.isStream(data) ||        utils.isFile(data) ||        utils.isBlob(data)      ) {        return data;      }      if (utils.isArrayBufferView(data)) {        return data.buffer;      }      // URLSearchParamsæä¾›äº†ä¸€äº›ç”¨æ¥å¤„ç†URLæŸ¥è¯¢å­—ç¬¦ä¸²æ¥å£      // å¦‚æœæ˜¯URLSearchParamså¯¹è±¡      if (utils.isURLSearchParams(data)) {        // Content-Typeè®¾ç½®ä¸ºapplication/x-www-form-urlencoded        // application/x-www-form-urlencodedï¼Œæ•°æ®è¢«ç¼–ç æˆä»¥&amp;åˆ†éš”çš„é”®å€¼å¯¹        setContentTypeIfUnset(headers, &#39;application/x-www-form-urlencoded;charset=utf-8&#39;);        return data.toString();      }      // å¦‚æœæ˜¯å¯¹è±¡      if (utils.isObject(data)) {        // Content-Typeè®¾ç½®ä¸ºapplication/json        setContentTypeIfUnset(headers, &#39;application/json;charset=utf-8&#39;);        // å°†è¯·æ±‚æ­£æ–‡æ ¼å¼åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›        return JSON.stringify(data);      }      return data;    }  ],  // æ ¼å¼åŒ–å“åº”resposeDataï¼Œè¿™ä¼šå“åº”æ¥å—åä½¿ç”¨  transformResponse: [    function transformResponse(data) {      if (typeof data === &#39;string&#39;) {        try {          data = JSON.parse(data);        } catch (e) { /* Ignore */ }      }      return data;    }  ],  // é»˜è®¤è¶…æ—¶æ—¶é—´  timeout: 0,  // xsrfè®¾ç½®çš„cookieçš„key  xsrfCookieName: &#39;XSRF-TOKEN&#39;,  // xsrfè®¾ç½®headerçš„key  xsrfHeaderName: &#39;X-XSRF-TOKEN&#39;,  maxContentLength: -1,  // éªŒè¯è¯·æ±‚çš„çŠ¶æ€  // åœ¨å¤„ç†è¯·æ±‚çš„Promiseä¼šè¢«ä½¿ç”¨  validateStatus: function validateStatus(status) {    return status &gt;= 200 &amp;&amp; status &lt; 300;  }};defaults.headers = {  // é€šç”¨çš„HTTPå­—æ®µ  // Acceptå‘ŠçŸ¥å®¢æˆ·ç«¯å¯ä»¥å¤„ç†çš„ç±»å‹  common: {    &#39;Accept&#39;: &#39;application/json, text/plain, */*&#39;  }};utils.forEach([&#39;delete&#39;, &#39;get&#39;, &#39;head&#39;], function forEachMethodNoData(method) {  defaults.headers[method] = {};});// ä¸ºpostï¼Œputï¼Œpatchè¯·æ±‚è®¾ç½®é»˜è®¤çš„Content-Typeutils.forEach([&#39;post&#39;, &#39;put&#39;, &#39;patch&#39;], function forEachMethodWithData(method) {  defaults.headers[method] = utils.merge(DEFAULT_CONTENT_TYPE);});module.exports = defaults;</code></pre><h3 id="lib-axios-js"><a href="#lib-axios-js" class="headerlink" title="/lib/axios.js"></a>/lib/axios.js</h3><blockquote><p>axios.jsæ–‡ä»¶æ˜¯axioså·¥å…·åº“çš„å…¥å£æ–¹æ³•ï¼Œåœ¨axios.js</p></blockquote><h4 id="æºç -6"><a href="#æºç -6" class="headerlink" title="æºç "></a>æºç </h4><pre><code>var utils = require(&#39;./utils&#39;);var bind = require(&#39;./helpers/bind&#39;);var Axios = require(&#39;./core/Axios&#39;);var mergeConfig = require(&#39;./core/mergeConfig&#39;);var defaults = require(&#39;./defaults&#39;);// åˆ›å»ºaxioså®ä¾‹function createInstance(defaultConfig) {  var context = new Axios(defaultConfig);  // æ›´æ”¹Axios.prototype.requestçš„thisï¼Œæ‰§è¡Œcontextå®ä¾‹  // instanceç­‰äºAxios.prototype.requestæ–¹æ³•  var instance = bind(Axios.prototype.request, context);  // å°†Axios.prototypeï¼Œcontextä¸Šçš„å±æ€§åˆå¹¶åˆ°instance  // instance.get = Axios.prototype.get  // instance.defaults = context.defaults  // ...  utils.extend(instance, Axios.prototype, context);   utils.extend(instance, context);  return instance;}// axiosä¼šç›´æ¥å¯¹ä½¿ç”¨è€…æš´éœ²ä¸€ä¸ªaxios.requestçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨axiosçš„æ—¶å€™å¯ä»¥è¿™æ ·ä½¿ç”¨ã€‚ä¸éœ€è¦newä¸€ä¸ªaxiosçš„å®ä¾‹// import axios from &#39;axios&#39;// axios.get(&#39;/info&#39;)var axios = createInstance(defaults);axios.Axios = Axios;// axios.createå¯ä»¥æ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰çš„configç”Ÿæˆä¸€ä¸ªæ–°çš„axioså®ä¾‹axios.create = function create(instanceConfig) {  return createInstance(mergeConfig(axios.defaults, instanceConfig));};axios.Cancel = require(&#39;./cancel/Cancel&#39;);axios.CancelToken = require(&#39;./cancel/CancelToken&#39;);axios.isCancel = require(&#39;./cancel/isCancel&#39;);axios.all = function all(promises) {  return Promise.all(promises);};axios.spread = require(&#39;./helpers/spread&#39;);module.exports = axios;module.exports.default = axios;</code></pre>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ajax </tag>
            
            <tag> axios </tag>
            
            <tag> ç½‘ç»œè¯·æ±‚ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP/2ä¸HTTP/3 çš„æ–°ç‰¹æ€§</title>
      <link href="/2019/10/25/http/"/>
      <url>/2019/10/25/http/</url>
      
        <content type="html"><![CDATA[<p>æ¥è‡ªå¾®ä¿¡å…¬ä¼—å·å‰ç«¯å·¥åŒ </p><h2 id="HTTP-1-1å‘æ˜ä»¥æ¥å‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼Ÿ"><a href="#HTTP-1-1å‘æ˜ä»¥æ¥å‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼Ÿ" class="headerlink" title="HTTP/1.1å‘æ˜ä»¥æ¥å‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼Ÿ"></a>HTTP/1.1å‘æ˜ä»¥æ¥å‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼Ÿ</h2><p>å¦‚æœä»”ç»†è§‚å¯Ÿæ‰“å¼€é‚£äº›æœ€æµè¡Œçš„ç½‘ç«™é¦–é¡µæ‰€éœ€è¦ä¸‹è½½çš„èµ„æºçš„è¯ï¼Œä¼šå‘ç°ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è¶‹åŠ¿ã€‚è¿‘å¹´æ¥åŠ è½½ç½‘ç«™é¦–é¡µéœ€è¦çš„ä¸‹è½½çš„æ•°æ®é‡åœ¨é€æ¸å¢åŠ ï¼Œå¹¶å·²ç»è¶…è¿‡äº†<strong>2100K</strong>ã€‚ä½†åœ¨è¿™é‡Œæˆ‘ä»¬æ›´åº”è¯¥å…³å¿ƒçš„æ˜¯ï¼šå¹³å‡æ¯ä¸ªé¡µé¢ä¸ºäº†å®Œæˆæ˜¾ç¤ºä¸æ¸²æŸ“æ‰€éœ€è¦ä¸‹è½½çš„èµ„æºæ•°å·²ç»è¶…è¿‡äº†<strong>100ä¸ª</strong>ã€‚  </p><p>æ­£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»2011å¹´ä»¥æ¥,<strong>ä¼ è¾“æ•°æ®å¤§å°</strong>ä¸<strong>å¹³å‡è¯·æ±‚èµ„æºæ•°é‡</strong>ä¸æ–­æŒç»­å¢é•¿ï¼Œå¹¶æ²¡æœ‰å‡ç¼“çš„è¿¹è±¡ã€‚è¯¥å›¾è¡¨ä¸­ç»¿è‰²ç›´çº¿å±•ç¤ºäº†ä¼ è¾“æ•°æ®å¤§å°çš„å¢é•¿ï¼Œçº¢è‰²ç›´çº¿å±•ç¤ºäº†å¹³å‡è¯·æ±‚èµ„æºæ•°é‡çš„å¢é•¿ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e1213d5962b05c?w=654&h=339&f=png&s=75559" alt></p><p><strong>HTTP/1.1</strong>è‡ªä»1997å¹´å‘å¸ƒä»¥æ¥ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨HTTP/1.x ç›¸å½“é•¿ä¸€æ®µæ—¶é—´äº†ï¼Œä½†æ˜¯éšç€è¿‘åå¹´äº’è”ç½‘çš„çˆ†ç‚¸å¼å‘å±•ï¼Œä»å½“åˆç½‘é¡µå†…å®¹ä»¥æ–‡æœ¬ä¸ºä¸»,åˆ°ç°åœ¨ä»¥å¯Œåª’ä½“ï¼ˆå¦‚å›¾ç‰‡ã€å£°éŸ³ã€è§†é¢‘ï¼‰ä¸ºä¸»,è€Œä¸”å¯¹é¡µé¢å†…å®¹å®æ—¶æ€§é«˜è¦æ±‚çš„åº”ç”¨è¶Šæ¥è¶Šå¤š(æ¯”å¦‚èŠå¤©ã€è§†é¢‘ç›´æ’­),äºæ˜¯å½“æ—¶åè®®è§„å®šçš„æŸäº›ç‰¹æ€§ï¼Œå·²ç»æ— æ³•æ»¡è¶³ç°ä»£ç½‘ç»œçš„éœ€æ±‚äº†ã€‚</p><h2 id="HTTP-1-1çš„ç¼ºé™·"><a href="#HTTP-1-1çš„ç¼ºé™·" class="headerlink" title="HTTP/1.1çš„ç¼ºé™·"></a>HTTP/1.1çš„ç¼ºé™·</h2><h3 id="é«˜å»¶è¿Ÿâ€“å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½"><a href="#é«˜å»¶è¿Ÿâ€“å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½" class="headerlink" title="é«˜å»¶è¿Ÿâ€“å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½"></a>é«˜å»¶è¿Ÿâ€“å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½</h3><p>è™½ç„¶è¿‘å‡ å¹´æ¥ç½‘ç»œå¸¦å®½å¢é•¿éå¸¸å¿«ï¼Œç„¶è€Œæˆ‘ä»¬å´å¹¶æ²¡æœ‰çœ‹åˆ°<strong>ç½‘ç»œå»¶è¿Ÿ</strong>æœ‰å¯¹åº”ç¨‹åº¦çš„é™ä½ã€‚ç½‘ç»œå»¶è¿Ÿé—®é¢˜ä¸»è¦ç”±äº<strong>é˜Ÿå¤´é˜»å¡</strong>(Head-Of-Line Blocking),å¯¼è‡´å¸¦å®½æ— æ³•è¢«å……åˆ†åˆ©ç”¨ã€‚   </p><p>é˜Ÿå¤´é˜»å¡æ˜¯æŒ‡å½“é¡ºåºå‘é€çš„è¯·æ±‚åºåˆ—ä¸­çš„ä¸€ä¸ªè¯·æ±‚å› ä¸ºæŸç§åŸå› è¢«é˜»å¡æ—¶ï¼Œåœ¨åé¢æ’é˜Ÿçš„æ‰€æœ‰è¯·æ±‚ä¹Ÿä¸€å¹¶è¢«é˜»å¡ï¼Œä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿Ÿè¿Ÿæ”¶ä¸åˆ°æ•°æ®ã€‚é’ˆå¯¹é˜Ÿå¤´é˜»å¡,äººä»¬å°è¯•è¿‡ä»¥ä¸‹åŠæ³•æ¥è§£å†³: </p><ul><li><p>å°†åŒä¸€é¡µé¢çš„èµ„æºåˆ†æ•£åˆ°ä¸åŒåŸŸåä¸‹ï¼Œæå‡è¿æ¥ä¸Šé™ã€‚<strong>Chromeæœ‰ä¸ªæœºåˆ¶ï¼Œå¯¹äºåŒä¸€ä¸ªåŸŸåï¼Œé»˜è®¤å…è®¸åŒæ—¶å»ºç«‹ 6 ä¸ª TCPæŒä¹…è¿æ¥</strong>ï¼Œä½¿ç”¨æŒä¹…è¿æ¥æ—¶ï¼Œè™½ç„¶èƒ½å…¬ç”¨ä¸€ä¸ªTCPç®¡é“ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªç®¡é“ä¸­åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨å½“å‰çš„è¯·æ±‚æ²¡æœ‰ç»“æŸä¹‹å‰ï¼Œå…¶ä»–çš„è¯·æ±‚åªèƒ½å¤„äºé˜»å¡çŠ¶æ€ã€‚å¦å¤–å¦‚æœåœ¨åŒä¸€ä¸ªåŸŸåä¸‹åŒæ—¶æœ‰10ä¸ªè¯·æ±‚å‘ç”Ÿï¼Œé‚£ä¹ˆå…¶ä¸­4ä¸ªè¯·æ±‚ä¼šè¿›å…¥æ’é˜Ÿç­‰å¾…çŠ¶æ€ï¼Œç›´è‡³è¿›è¡Œä¸­çš„è¯·æ±‚å®Œæˆã€‚</p></li><li><p>Spritingåˆå¹¶å¤šå¼ å°å›¾ä¸ºä¸€å¼ å¤§å›¾,å†ç”¨JavaScriptæˆ–è€…CSSå°†å°å›¾é‡æ–°â€œåˆ‡å‰²â€å‡ºæ¥çš„æŠ€æœ¯ã€‚</p></li><li><p>å†…è”(Inlining)æ˜¯å¦å¤–ä¸€ç§é˜²æ­¢å‘é€å¾ˆå¤šå°å›¾è¯·æ±‚çš„æŠ€å·§ï¼Œå°†å›¾ç‰‡çš„åŸå§‹æ•°æ®åµŒå…¥åœ¨CSSæ–‡ä»¶é‡Œé¢çš„URLé‡Œï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ã€‚</p></li><li><p>æ‹¼æ¥(Concatenation)å°†å¤šä¸ªä½“ç§¯è¾ƒå°çš„JavaScriptä½¿ç”¨webpackç­‰å·¥å…·æ‰“åŒ…æˆ1ä¸ªä½“ç§¯æ›´å¤§çš„JavaScriptæ–‡ä»¶,ä½†å¦‚æœå…¶ä¸­1ä¸ªæ–‡ä»¶çš„æ”¹åŠ¨å°±ä¼šå¯¼è‡´å¤§é‡æ•°æ®è¢«é‡æ–°ä¸‹è½½å¤šä¸ªæ–‡ä»¶ã€‚</p></li></ul><h3 id="æ— çŠ¶æ€ç‰¹æ€§â€“å¸¦æ¥çš„å·¨å¤§HTTPå¤´éƒ¨"><a href="#æ— çŠ¶æ€ç‰¹æ€§â€“å¸¦æ¥çš„å·¨å¤§HTTPå¤´éƒ¨" class="headerlink" title="æ— çŠ¶æ€ç‰¹æ€§â€“å¸¦æ¥çš„å·¨å¤§HTTPå¤´éƒ¨"></a>æ— çŠ¶æ€ç‰¹æ€§â€“å¸¦æ¥çš„å·¨å¤§HTTPå¤´éƒ¨</h3><p>ç”±äºæŠ¥æ–‡<code>Header</code>ä¸€èˆ¬ä¼šæºå¸¦â€User Agentâ€â€Cookieâ€â€Acceptâ€â€Serverâ€ç­‰è®¸å¤šå›ºå®šçš„å¤´å­—æ®µï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œå¤šè¾¾å‡ ç™¾å­—èŠ‚ç”šè‡³ä¸Šåƒå­—èŠ‚ï¼Œä½†Bodyå´ç»å¸¸åªæœ‰å‡ åå­—èŠ‚ï¼ˆæ¯”å¦‚GETè¯·æ±‚ã€ 204/301/304å“åº”ï¼‰ï¼Œæˆäº†ä¸æŠ˜ä¸æ‰£çš„â€œå¤§å¤´å„¿å­â€ã€‚Headeré‡Œæºå¸¦çš„å†…å®¹è¿‡å¤§ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ä¼ è¾“çš„æˆæœ¬ã€‚æ›´è¦å‘½çš„æ˜¯ï¼Œæˆåƒä¸Šä¸‡çš„è¯·æ±‚å“åº”æŠ¥æ–‡é‡Œæœ‰å¾ˆå¤šå­—æ®µå€¼éƒ½æ˜¯é‡å¤çš„ï¼Œéå¸¸æµªè´¹ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e1213ef67b3850?w=729&h=253&f=png&s=121105" alt></p><h3 id="æ˜æ–‡ä¼ è¾“â€“å¸¦æ¥çš„ä¸å®‰å…¨æ€§"><a href="#æ˜æ–‡ä¼ è¾“â€“å¸¦æ¥çš„ä¸å®‰å…¨æ€§" class="headerlink" title="æ˜æ–‡ä¼ è¾“â€“å¸¦æ¥çš„ä¸å®‰å…¨æ€§"></a>æ˜æ–‡ä¼ è¾“â€“å¸¦æ¥çš„ä¸å®‰å…¨æ€§</h3><p>HTTP/1.1åœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯<strong>æ˜æ–‡</strong>ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æ— æ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ— æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><p>ä½ æœ‰æ²¡æœ‰å¬è¯´è¿‡â€å…è´¹WiFié™·é˜±â€ä¹‹ç±»çš„æ–°é—»å‘¢ï¼Ÿé»‘å®¢å°±æ˜¯åˆ©ç”¨äº†HTTPæ˜æ–‡ä¼ è¾“çš„ç¼ºç‚¹ï¼Œåœ¨å…¬å…±åœºæ‰€æ¶è®¾ä¸€ä¸ªWiFiçƒ­ç‚¹å¼€å§‹â€œé’“é±¼â€ï¼Œè¯±éª—ç½‘æ°‘ä¸Šç½‘ã€‚ä¸€æ—¦ä½ è¿ä¸Šäº†è¿™ä¸ªWiFiçƒ­ç‚¹ï¼Œæ‰€æœ‰çš„æµé‡éƒ½ä¼šè¢«æˆªè·ä¿å­˜ï¼Œé‡Œé¢å¦‚æœæœ‰é“¶è¡Œå¡å·ã€ç½‘ç«™å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯çš„è¯é‚£å°±å±é™©äº†ï¼Œé»‘å®¢æ‹¿åˆ°äº†è¿™äº›æ•°æ®å°±å¯ä»¥å†’å……ä½ ä¸ºæ‰€æ¬²ä¸ºã€‚</p><h3 id="ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯"><a href="#ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯" class="headerlink" title="ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯"></a>ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯</h3><h2 id="SPDY-åè®®ä¸-HTTP-2-ç®€ä»‹"><a href="#SPDY-åè®®ä¸-HTTP-2-ç®€ä»‹" class="headerlink" title="SPDY åè®®ä¸ HTTP/2 ç®€ä»‹"></a>SPDY åè®®ä¸ HTTP/2 ç®€ä»‹</h2><h3 id="SPDY-åè®®"><a href="#SPDY-åè®®" class="headerlink" title="SPDY åè®®"></a>SPDY åè®®</h3><p>ä¸Šé¢æˆ‘ä»¬æåˆ°,ç”±äºHTTP/1.xçš„ç¼ºé™·ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥é›ªç¢§å›¾ã€å°†å°å›¾å†…è”ã€ä½¿ç”¨å¤šä¸ªåŸŸåç­‰ç­‰çš„æ–¹å¼æ¥æé«˜æ€§èƒ½ã€‚ä¸è¿‡è¿™äº›ä¼˜åŒ–éƒ½ç»•å¼€äº†åè®®ï¼Œç›´åˆ°2009å¹´ï¼Œè°·æ­Œå…¬å¼€äº†è‡ªè¡Œç ”å‘çš„ SPDY åè®®ï¼Œä¸»è¦è§£å†³HTTP/1.1æ•ˆç‡ä¸é«˜çš„é—®é¢˜ã€‚è°·æ­Œæ¨å‡ºSPDYï¼Œæ‰ç®—æ˜¯æ­£å¼æ”¹é€ HTTPåè®®æœ¬èº«ã€‚é™ä½å»¶è¿Ÿï¼Œå‹ç¼©headerç­‰ç­‰ï¼ŒSPDYçš„å®è·µè¯æ˜äº†è¿™äº›ä¼˜åŒ–çš„æ•ˆæœï¼Œä¹Ÿæœ€ç»ˆå¸¦æ¥HTTP/2çš„è¯ç”Ÿã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e12140c9cbb2aa?w=319&h=329&f=png&s=15867" alt><br><strong>HTTP/1.1æœ‰ä¸¤ä¸ªä¸»è¦çš„ç¼ºç‚¹ï¼šå®‰å…¨ä¸è¶³å’Œæ€§èƒ½ä¸é«˜</strong>ï¼Œç”±äºèƒŒè´Ÿç€ HTTP/1.x åºå¤§çš„å†å²åŒ…è¢±,æ‰€ä»¥åè®®çš„ä¿®æ”¹,å…¼å®¹æ€§æ˜¯é¦–è¦è€ƒè™‘çš„ç›®æ ‡ï¼Œå¦åˆ™å°±ä¼šç ´åäº’è”ç½‘ä¸Šæ— æ•°ç°æœ‰çš„èµ„äº§ã€‚å¦‚ä¸Šå›¾æ‰€ç¤º, SPDYä½äºHTTPä¹‹ä¸‹ï¼ŒTCPå’ŒSSLä¹‹ä¸Šï¼Œè¿™æ ·å¯ä»¥è½»æ¾å…¼å®¹è€ç‰ˆæœ¬çš„HTTPåè®®(å°†HTTP1.xçš„å†…å®¹å°è£…æˆä¸€ç§æ–°çš„frameæ ¼å¼)ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨å·²æœ‰çš„SSLåŠŸèƒ½ã€‚</p><p>SPDY åè®®åœ¨Chromeæµè§ˆå™¨ä¸Šè¯æ˜å¯è¡Œä»¥åï¼Œå°±è¢«å½“ä½œ HTTP/2 çš„åŸºç¡€ï¼Œä¸»è¦ç‰¹æ€§éƒ½åœ¨ HTTP/2 ä¹‹ä¸­å¾—åˆ°ç»§æ‰¿</p><h3 id="HTTP-2-ç®€ä»‹"><a href="#HTTP-2-ç®€ä»‹" class="headerlink" title="HTTP/2 ç®€ä»‹"></a>HTTP/2 ç®€ä»‹</h3><p>2015å¹´ï¼ŒHTTP/2 å‘å¸ƒã€‚HTTP/2æ˜¯ç°è¡ŒHTTPåè®®ï¼ˆHTTP/1.xï¼‰çš„æ›¿ä»£ï¼Œä½†å®ƒä¸æ˜¯é‡å†™ï¼ŒHTTPæ–¹æ³•/çŠ¶æ€ç /è¯­ä¹‰éƒ½ä¸HTTP/1.xä¸€æ ·ã€‚<strong>HTTP/2åŸºäºSPDYï¼Œä¸“æ³¨äºæ€§èƒ½ï¼Œæœ€å¤§çš„ä¸€ä¸ªç›®æ ‡æ˜¯åœ¨ç”¨æˆ·å’Œç½‘ç«™é—´åªç”¨ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰</strong>ã€‚ä»ç›®å‰çš„æƒ…å†µæ¥çœ‹ï¼Œå›½å†…å¤–ä¸€äº›æ’åé å‰çš„ç«™ç‚¹åŸºæœ¬éƒ½å®ç°äº†HTTP/2çš„éƒ¨ç½²ï¼Œä½¿ç”¨HTTP/2èƒ½å¸¦æ¥20%~60%çš„æ•ˆç‡æå‡ã€‚</p><p>HTTP/2ç”±ä¸¤ä¸ªè§„èŒƒï¼ˆSpecificationï¼‰ç»„æˆï¼š</p><ul><li><p>Hypertext Transfer Protocol version 2 - RFC7540</p></li><li><p>HPACK - Header Compression for HTTP/2 - RFC7541</p></li></ul><h2 id="HTTP-2-æ–°ç‰¹æ€§"><a href="#HTTP-2-æ–°ç‰¹æ€§" class="headerlink" title="HTTP/2 æ–°ç‰¹æ€§"></a>HTTP/2 æ–°ç‰¹æ€§</h2><h3 id="äºŒè¿›åˆ¶ä¼ è¾“"><a href="#äºŒè¿›åˆ¶ä¼ è¾“" class="headerlink" title="äºŒè¿›åˆ¶ä¼ è¾“"></a>äºŒè¿›åˆ¶ä¼ è¾“</h3><p><strong>HTTP/2ä¼ è¾“æ•°æ®é‡çš„å¤§å¹…å‡å°‘,ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› :ä»¥äºŒè¿›åˆ¶æ–¹å¼ä¼ è¾“å’ŒHeader å‹ç¼©</strong>ã€‚æˆ‘ä»¬å…ˆæ¥ä»‹ç»äºŒè¿›åˆ¶ä¼ è¾“,HTTP/2 é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ä¼ è¾“æ•°æ®ï¼Œè€ŒéHTTP/1.x é‡Œçº¯æ–‡æœ¬å½¢å¼çš„æŠ¥æ–‡ ï¼ŒäºŒè¿›åˆ¶åè®®è§£æèµ·æ¥æ›´é«˜æ•ˆã€‚<strong>HTTP/2 å°†è¯·æ±‚å’Œå“åº”æ•°æ®åˆ†å‰²ä¸ºæ›´å°çš„å¸§ï¼Œå¹¶ä¸”å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶ç¼–ç ã€‚</strong></p><p>å®ƒæŠŠTCPåè®®çš„éƒ¨åˆ†ç‰¹æ€§æŒªåˆ°äº†åº”ç”¨å±‚ï¼ŒæŠŠåŸæ¥çš„â€Header+Bodyâ€çš„æ¶ˆæ¯â€æ‰“æ•£â€ä¸ºæ•°ä¸ªå°ç‰‡çš„äºŒè¿›åˆ¶â€å¸§â€(Frame),ç”¨â€HEADERSâ€å¸§å­˜æ”¾å¤´æ•°æ®ã€â€DATAâ€å¸§å­˜æ”¾å®ä½“æ•°æ®ã€‚HTP/2æ•°æ®åˆ†å¸§åâ€Header+Bodyâ€çš„æŠ¥æ–‡ç»“æ„å°±å®Œå…¨æ¶ˆå¤±äº†ï¼Œåè®®çœ‹åˆ°çš„åªæ˜¯ä¸€ä¸ªä¸ªçš„â€ç¢ç‰‡â€ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e12146311d2a9f?w=659&h=502&f=png&s=139914" alt><br>HTTP/2 ä¸­ï¼ŒåŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆï¼Œè¯¥è¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚æ¯ä¸ªæ•°æ®æµéƒ½ä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚<strong>å¤šä¸ªå¸§ä¹‹é—´å¯ä»¥ä¹±åºå‘é€ï¼Œæ ¹æ®å¸§é¦–éƒ¨çš„æµæ ‡è¯†å¯ä»¥é‡æ–°ç»„è£…ã€‚</strong></p><h3 id="Header-å‹ç¼©"><a href="#Header-å‹ç¼©" class="headerlink" title="Header å‹ç¼©"></a>Header å‹ç¼©</h3><p>HTTP/2å¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„å‹ç¼©ç®—æ³•ï¼Œè€Œæ˜¯å¼€å‘äº†ä¸“é—¨çš„â€HPACKâ€ç®—æ³•ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸¤ç«¯å»ºç«‹â€œå­—å…¸â€ï¼Œç”¨ç´¢å¼•å·è¡¨ç¤ºé‡å¤çš„å­—ç¬¦ä¸²ï¼Œè¿˜é‡‡ç”¨å“ˆå¤«æ›¼ç¼–ç æ¥å‹ç¼©æ•´æ•°å’Œå­—ç¬¦ä¸²ï¼Œå¯ä»¥è¾¾åˆ°50%~90%çš„é«˜å‹ç¼©ç‡ã€‚</p><p>å…·ä½“æ¥è¯´:</p><ul><li><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨â€œé¦–éƒ¨è¡¨â€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®-å€¼å¯¹ï¼Œå¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€ï¼›</p></li><li><p>é¦–éƒ¨è¡¨åœ¨HTTP/2çš„è¿æ¥å­˜ç»­æœŸå†…å§‹ç»ˆå­˜åœ¨ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ¸è¿›åœ°æ›´æ–°;</p></li><li><p>æ¯ä¸ªæ–°çš„é¦–éƒ¨é”®-å€¼å¯¹è¦ä¹ˆè¢«è¿½åŠ åˆ°å½“å‰è¡¨çš„æœ«å°¾ï¼Œè¦ä¹ˆæ›¿æ¢è¡¨ä¸­ä¹‹å‰çš„å€¼</p></li></ul><p>ä¾‹å¦‚ä¸‹å›¾ä¸­çš„ä¸¤ä¸ªè¯·æ±‚ï¼Œ è¯·æ±‚ä¸€å‘é€äº†æ‰€æœ‰çš„å¤´éƒ¨å­—æ®µï¼Œç¬¬äºŒä¸ªè¯·æ±‚åˆ™åªéœ€è¦å‘é€å·®å¼‚æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†—ä½™æ•°æ®ï¼Œé™ä½å¼€é”€<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e12147db474b76?w=707&h=445&f=png&s=208421" alt></p><h3 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h3><p>åœ¨ HTTP/2 ä¸­å¼•å…¥äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ã€‚å¤šè·¯å¤ç”¨å¾ˆå¥½çš„è§£å†³äº†æµè§ˆå™¨é™åˆ¶åŒä¸€ä¸ªåŸŸåä¸‹çš„è¯·æ±‚æ•°é‡çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæ¥æ›´å®¹æ˜“å®ç°å…¨é€Ÿä¼ è¾“ï¼Œæ¯•ç«Ÿæ–°å¼€ä¸€ä¸ª TCP è¿æ¥éƒ½éœ€è¦æ…¢æ…¢æå‡ä¼ è¾“é€Ÿåº¦ã€‚<br>å¤§å®¶å¯ä»¥é€šè¿‡ è¯¥é“¾æ¥ ç›´è§‚æ„Ÿå—ä¸‹ HTTP/2 æ¯” HTTP/1 åˆ°åº•å¿«äº†å¤šå°‘ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e1215b5b49b627?w=662&h=379&f=png&s=153256" alt><br>TTP/2 ä¸­ï¼Œæœ‰äº†äºŒè¿›åˆ¶åˆ†å¸§ä¹‹åï¼ŒHTTP /2 ä¸å†ä¾èµ– TCP é“¾æ¥å»å®ç°å¤šæµå¹¶è¡Œäº†ï¼Œåœ¨ HTTP/2ä¸­,</p><ul><li><p>åŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆã€‚</p></li><li><p>å•ä¸ªè¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚</p></li><li><p>æ•°æ®æµä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆï¼Œå¤šä¸ªå¸§ä¹‹é—´å¯ä»¥ä¹±åºå‘é€ï¼Œå› ä¸ºæ ¹æ®å¸§é¦–éƒ¨çš„æµæ ‡è¯†å¯ä»¥é‡æ–°ç»„è£…ã€‚</p></li></ul><p>è¿™ä¸€ç‰¹æ€§ï¼Œä½¿æ€§èƒ½æœ‰äº†æå¤§æå‡ï¼š</p><ul><li><p>åŒä¸ªåŸŸååªéœ€è¦å ç”¨ä¸€ä¸ª TCP è¿æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªè¿æ¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”,è¿™æ ·æ•´ä¸ªé¡µé¢èµ„æºçš„ä¸‹è½½è¿‡ç¨‹åªéœ€è¦ä¸€æ¬¡æ…¢å¯åŠ¨ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å¤šä¸ªTCPè¿æ¥ç«äº‰å¸¦å®½æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚</p></li><li><p>å¹¶è¡Œäº¤é”™åœ°å‘é€å¤šä¸ªè¯·æ±‚/å“åº”ï¼Œè¯·æ±‚/å“åº”ä¹‹é—´äº’ä¸å½±å“ã€‚</p></li><li><p>åœ¨HTTP/2ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½å¯ä»¥å¸¦ä¸€ä¸ª31bitçš„ä¼˜å…ˆå€¼ï¼Œ0è¡¨ç¤ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œ æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ã€‚æœ‰äº†è¿™ä¸ªä¼˜å…ˆå€¼ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å¯ä»¥åœ¨å¤„ç†ä¸åŒçš„æµæ—¶é‡‡å–ä¸åŒçš„ç­–ç•¥ï¼Œä»¥æœ€ä¼˜çš„æ–¹å¼å‘é€æµã€æ¶ˆæ¯å’Œå¸§ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e1214b0225bcc8?w=711&h=335&f=png&s=70021" alt><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¤šè·¯å¤ç”¨çš„æŠ€æœ¯å¯ä»¥åªé€šè¿‡ä¸€ä¸ª TCP è¿æ¥å°±å¯ä»¥ä¼ è¾“æ‰€æœ‰çš„è¯·æ±‚æ•°æ®ã€‚</p></li></ul><h3 id="Server-Push"><a href="#Server-Push" class="headerlink" title="Server Push"></a>Server Push</h3><p>HTTP2è¿˜åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ”¹å˜äº†ä¼ ç»Ÿçš„â€œè¯·æ±‚-åº”ç­”â€å·¥ä½œæ¨¡å¼ï¼ŒæœåŠ¡å™¨ä¸å†æ˜¯å®Œå…¨è¢«åŠ¨åœ°å“åº”è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ–°å»ºâ€œæµâ€ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚æ¯”å¦‚ï¼Œåœ¨æµè§ˆå™¨åˆšè¯·æ±‚HTMLçš„æ—¶å€™å°±æå‰æŠŠå¯èƒ½ä¼šç”¨åˆ°çš„JSã€CSSæ–‡ä»¶å‘ç»™å®¢æˆ·ç«¯ï¼Œå‡å°‘ç­‰å¾…çš„å»¶è¿Ÿï¼Œè¿™è¢«ç§°ä¸ºâ€æœåŠ¡å™¨æ¨é€â€ï¼ˆ Server Pushï¼Œä¹Ÿå« Cache pushï¼‰</p><p>ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤º,æœåŠ¡ç«¯ä¸»åŠ¨æŠŠJSå’ŒCSSæ–‡ä»¶æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯è§£æHTMLæ—¶å†å‘é€è¿™äº›è¯·æ±‚ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e1214d3468d2d6?w=697&h=299&f=png&s=106618" alt><br>å¦å¤–éœ€è¦è¡¥å……çš„æ˜¯,æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨æ¨é€ï¼Œå®¢æˆ·ç«¯ä¹Ÿæœ‰æƒåˆ©é€‰æ‹©æ˜¯å¦æ¥æ”¶ã€‚å¦‚æœæœåŠ¡ç«¯æ¨é€çš„èµ„æºå·²ç»è¢«æµè§ˆå™¨ç¼“å­˜è¿‡ï¼Œæµè§ˆå™¨å¯ä»¥é€šè¿‡å‘é€RST_STREAMå¸§æ¥æ‹’æ”¶ã€‚ä¸»åŠ¨æ¨é€ä¹Ÿéµå®ˆåŒæºç­–ç•¥ï¼Œæ¢å¥è¯è¯´ï¼ŒæœåŠ¡å™¨ä¸èƒ½éšä¾¿å°†ç¬¬ä¸‰æ–¹èµ„æºæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œå¿…é¡»æ˜¯ç»è¿‡åŒæ–¹ç¡®è®¤æ‰è¡Œã€‚</p><h3 id="æé«˜å®‰å…¨æ€§"><a href="#æé«˜å®‰å…¨æ€§" class="headerlink" title="æé«˜å®‰å…¨æ€§"></a>æé«˜å®‰å…¨æ€§</h3><p>å‡ºäºå…¼å®¹çš„è€ƒè™‘ï¼ŒHTTP/2å»¶ç»­äº†HTTP/1çš„â€œæ˜æ–‡â€ç‰¹ç‚¹ï¼Œå¯ä»¥åƒä»¥å‰ä¸€æ ·ä½¿ç”¨æ˜æ–‡ä¼ è¾“æ•°æ®ï¼Œä¸å¼ºåˆ¶ä½¿ç”¨åŠ å¯†é€šä¿¡ï¼Œä¸è¿‡æ ¼å¼è¿˜æ˜¯äºŒè¿›åˆ¶ï¼Œåªæ˜¯ä¸éœ€è¦è§£å¯†ã€‚</p><p>ä½†ç”±äºHTTPSå·²ç»æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼Œè€Œä¸”ä¸»æµçš„æµè§ˆå™¨Chromeã€Firefoxç­‰éƒ½å…¬å¼€å®£å¸ƒåªæ”¯æŒåŠ å¯†çš„HTTP/2ï¼Œ<strong>æ‰€ä»¥â€œäº‹å®ä¸Šâ€çš„HTTP/2æ˜¯åŠ å¯†çš„ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œäº’è”ç½‘ä¸Šé€šå¸¸æ‰€èƒ½è§åˆ°çš„HTTP/2éƒ½æ˜¯ä½¿ç”¨â€httpsâ€åè®®åï¼Œè·‘åœ¨TLSä¸Šé¢ã€‚HTTP/2åè®®å®šä¹‰äº†ä¸¤ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼šâ€œh2â€è¡¨ç¤ºåŠ å¯†çš„HTTP/2ï¼Œâ€œh2câ€è¡¨ç¤ºæ˜æ–‡çš„HTTP/2ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e12150cc0a5b80?w=629&h=308&f=png&s=100115" alt></p><h2 id="HTTP-3-æ–°ç‰¹æ€§"><a href="#HTTP-3-æ–°ç‰¹æ€§" class="headerlink" title="HTTP/3 æ–°ç‰¹æ€§"></a>HTTP/3 æ–°ç‰¹æ€§</h2><h3 id="HTTP-2-çš„ç¼ºç‚¹"><a href="#HTTP-2-çš„ç¼ºç‚¹" class="headerlink" title="HTTP/2 çš„ç¼ºç‚¹"></a>HTTP/2 çš„ç¼ºç‚¹</h3><p>è™½ç„¶ HTTP/2 è§£å†³äº†å¾ˆå¤šä¹‹å‰æ—§ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å­˜åœ¨ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œ<strong>ä¸»è¦æ˜¯åº•å±‚æ”¯æ’‘çš„ TCP åè®®é€ æˆçš„</strong>ã€‚HTTP/2çš„ç¼ºç‚¹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>TCP ä»¥åŠ TCP+TLSå»ºç«‹è¿æ¥çš„å»¶æ—¶</li></ul><p>HTTP/2éƒ½æ˜¯ä½¿ç”¨TCPåè®®æ¥ä¼ è¾“çš„ï¼Œè€Œå¦‚æœä½¿ç”¨HTTPSçš„è¯ï¼Œè¿˜éœ€è¦ä½¿ç”¨TLSåè®®è¿›è¡Œå®‰å…¨ä¼ è¾“ï¼Œè€Œä½¿ç”¨TLSä¹Ÿéœ€è¦ä¸€ä¸ªæ¡æ‰‹è¿‡ç¨‹ï¼Œ<strong>è¿™æ ·å°±éœ€è¦æœ‰ä¸¤ä¸ªæ¡æ‰‹å»¶è¿Ÿè¿‡ç¨‹</strong>ï¼š</p><p>â‘ åœ¨å»ºç«‹TCPè¿æ¥çš„æ—¶å€™ï¼Œéœ€è¦å’ŒæœåŠ¡å™¨è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹æ¥ç¡®è®¤è¿æ¥æˆåŠŸï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦åœ¨æ¶ˆè€—å®Œ1.5ä¸ªRTTä¹‹åæ‰èƒ½è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><p>â‘¡è¿›è¡ŒTLSè¿æ¥ï¼ŒTLSæœ‰ä¸¤ä¸ªç‰ˆæœ¬â€”â€”TLS1.2å’ŒTLS1.3ï¼Œæ¯ä¸ªç‰ˆæœ¬å»ºç«‹è¿æ¥æ‰€èŠ±çš„æ—¶é—´ä¸åŒï¼Œå¤§è‡´æ˜¯éœ€è¦1~2ä¸ªRTTã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦èŠ±æ‰ 3ï½4 ä¸ª RTTã€‚</p><ul><li>TCPçš„é˜Ÿå¤´é˜»å¡å¹¶æ²¡æœ‰å½»åº•è§£å†³</li></ul><p>ä¸Šæ–‡æˆ‘ä»¬æåˆ°åœ¨HTTP/2ä¸­ï¼Œå¤šä¸ªè¯·æ±‚æ˜¯è·‘åœ¨ä¸€ä¸ªTCPç®¡é“ä¸­çš„ã€‚ä½†å½“å‡ºç°äº†ä¸¢åŒ…æ—¶ï¼ŒHTTP/2 çš„è¡¨ç°åå€’ä¸å¦‚ HTTP/1 äº†ã€‚å› ä¸ºTCPä¸ºäº†ä¿è¯å¯é ä¼ è¾“ï¼Œæœ‰ä¸ªç‰¹åˆ«çš„â€œä¸¢åŒ…é‡ä¼ â€æœºåˆ¶ï¼Œä¸¢å¤±çš„åŒ…å¿…é¡»è¦ç­‰å¾…é‡æ–°ä¼ è¾“ç¡®è®¤ï¼ŒHTTP/2å‡ºç°ä¸¢åŒ…æ—¶ï¼Œæ•´ä¸ª TCP éƒ½è¦å¼€å§‹ç­‰å¾…é‡ä¼ ï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡è¯¥TCPè¿æ¥ä¸­çš„æ‰€æœ‰è¯·æ±‚ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚è€Œå¯¹äº HTTP/1.1 æ¥è¯´ï¼Œå¯ä»¥å¼€å¯å¤šä¸ª TCP è¿æ¥ï¼Œå‡ºç°è¿™ç§æƒ…å†µååˆ°åªä¼šå½±å“å…¶ä¸­ä¸€ä¸ªè¿æ¥ï¼Œå‰©ä½™çš„ TCP è¿æ¥è¿˜å¯ä»¥æ­£å¸¸ä¼ è¾“æ•°æ®ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e121539aca15d3?w=704&h=254&f=png&s=50980" alt><br>è¯»åˆ°è¿™é‡Œï¼Œå¯èƒ½å°±ä¼šæœ‰äººè€ƒè™‘ä¸ºä»€ä¹ˆä¸ç›´æ¥å»ä¿®æ”¹ TCP åè®®ï¼Ÿå…¶å®è¿™å·²ç»æ˜¯ä¸€ä»¶ä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡äº†ã€‚å› ä¸º TCP å­˜åœ¨çš„æ—¶é—´å®åœ¨å¤ªé•¿ï¼Œå·²ç»å……æ–¥åœ¨å„ç§è®¾å¤‡ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ªåè®®æ˜¯ç”±æ“ä½œç³»ç»Ÿå®ç°çš„ï¼Œæ›´æ–°èµ·æ¥ä¸å¤§ç°å®ã€‚</p><h3 id="HTTP-3ç®€ä»‹"><a href="#HTTP-3ç®€ä»‹" class="headerlink" title="HTTP/3ç®€ä»‹"></a>HTTP/3ç®€ä»‹</h3><p>Google åœ¨æ¨SPDYçš„æ—¶å€™å°±å·²ç»æ„è¯†åˆ°äº†è¿™äº›é—®é¢˜ï¼Œäºæ˜¯å°±å¦èµ·ç‚‰ç¶æäº†ä¸€ä¸ªåŸºäº UDP åè®®çš„â€œQUICâ€åè®®ï¼Œè®©HTTPè·‘åœ¨QUICä¸Šè€Œä¸æ˜¯TCPä¸Šã€‚è€Œè¿™ä¸ªâ€œHTTP over QUICâ€å°±æ˜¯HTTPåè®®çš„ä¸‹ä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼ŒHTTP/3ã€‚å®ƒåœ¨HTTP/2çš„åŸºç¡€ä¸Šåˆå®ç°äº†è´¨çš„é£è·ƒï¼ŒçœŸæ­£â€œå®Œç¾â€åœ°è§£å†³äº†â€œé˜Ÿå¤´é˜»å¡â€é—®é¢˜ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e1215a0f28a2ed?w=655&h=272&f=png&s=119742" alt><br>QUIC è™½ç„¶åŸºäº UDPï¼Œä½†æ˜¯åœ¨åŸæœ¬çš„åŸºç¡€ä¸Šæ–°å¢äº†å¾ˆå¤šåŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹ä»‹ç»å‡ ä¸ªQUICæ–°åŠŸèƒ½ã€‚ä¸è¿‡HTTP/3ç›®å‰è¿˜å¤„äºè‰æ¡ˆé˜¶æ®µï¼Œæ­£å¼å‘å¸ƒå‰å¯èƒ½ä¼šæœ‰å˜åŠ¨ï¼Œæ‰€ä»¥æœ¬æ–‡å°½é‡ä¸æ¶‰åŠé‚£äº›ä¸ç¨³å®šçš„ç»†èŠ‚ã€‚</p><h3 id="QUICæ–°åŠŸèƒ½"><a href="#QUICæ–°åŠŸèƒ½" class="headerlink" title="QUICæ–°åŠŸèƒ½"></a>QUICæ–°åŠŸèƒ½</h3><p>ä¸Šé¢æˆ‘ä»¬æåˆ°QUICåŸºäºUDPï¼Œè€ŒUDPæ˜¯â€œæ— è¿æ¥â€çš„ï¼Œæ ¹æœ¬å°±ä¸éœ€è¦â€œæ¡æ‰‹â€å’Œâ€œæŒ¥æ‰‹â€ï¼Œæ‰€ä»¥å°±æ¯”TCPæ¥å¾—å¿«ã€‚æ­¤å¤–QUICä¹Ÿå®ç°äº†å¯é ä¼ è¾“ï¼Œä¿è¯æ•°æ®ä¸€å®šèƒ½å¤ŸæŠµè¾¾ç›®çš„åœ°ã€‚å®ƒè¿˜å¼•å…¥äº†ç±»ä¼¼HTTP/2çš„â€œæµâ€å’Œâ€œå¤šè·¯å¤ç”¨â€ï¼Œå•ä¸ªâ€œæµâ€æ˜¯æœ‰åºçš„ï¼Œå¯èƒ½ä¼šå› ä¸ºä¸¢åŒ…è€Œé˜»å¡ï¼Œä½†å…¶ä»–â€œæµâ€ä¸ä¼šå—åˆ°å½±å“ã€‚å…·ä½“æ¥è¯´QUICåè®®æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å®ç°äº†ç±»ä¼¼TCPçš„æµé‡æ§åˆ¶ã€ä¼ è¾“å¯é æ€§çš„åŠŸèƒ½ã€‚</li></ul><p>è™½ç„¶UDPä¸æä¾›å¯é æ€§çš„ä¼ è¾“ï¼Œä½†QUICåœ¨UDPçš„åŸºç¡€ä¹‹ä¸Šå¢åŠ äº†ä¸€å±‚æ¥ä¿è¯æ•°æ®å¯é æ€§ä¼ è¾“ã€‚å®ƒæä¾›äº†æ•°æ®åŒ…é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ä»¥åŠå…¶ä»–ä¸€äº›TCPä¸­å­˜åœ¨çš„ç‰¹æ€§ã€‚</p><ul><li>å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½ã€‚</li></ul><p>ç”±äºQUICæ˜¯åŸºäºUDPçš„ï¼Œæ‰€ä»¥QUICå¯ä»¥å®ç°ä½¿ç”¨0-RTTæˆ–è€…1-RTTæ¥å»ºç«‹è¿æ¥ï¼Œè¿™æ„å‘³ç€QUICå¯ä»¥ç”¨æœ€å¿«çš„é€Ÿåº¦æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æå‡é¦–æ¬¡æ‰“å¼€é¡µé¢çš„é€Ÿåº¦ã€‚<strong>0RTT å»ºè¿å¯ä»¥è¯´æ˜¯ QUIC ç›¸æ¯” HTTP2 æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</strong></p><ul><li>é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½ã€‚</li></ul><p>ç›®å‰QUICä½¿ç”¨çš„æ˜¯TLS1.3ï¼Œç›¸è¾ƒäºæ—©æœŸç‰ˆæœ¬TLS1.3æœ‰æ›´å¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯å‡å°‘äº†æ¡æ‰‹æ‰€èŠ±è´¹çš„RTTä¸ªæ•°ã€‚</p><ul><li>å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜</li></ul><p>å’ŒTCPä¸åŒï¼ŒQUICå®ç°äº†åœ¨åŒä¸€ç‰©ç†è¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘æ•°æ®æµï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚å®ç°äº†æ•°æ®æµçš„å•ç‹¬ä¼ è¾“ï¼Œå°±è§£å†³äº†TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/10/28/16e121571a06a492?w=699&h=227&f=png&s=63869" alt></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><p>HTTP/1.1æœ‰ä¸¤ä¸ªä¸»è¦çš„ç¼ºç‚¹ï¼šå®‰å…¨ä¸è¶³å’Œæ€§èƒ½ä¸é«˜ã€‚</p></li><li><p>HTTP/2å®Œå…¨å…¼å®¹HTTP/1ï¼Œæ˜¯â€œæ›´å®‰å…¨çš„HTTPã€æ›´å¿«çš„HTTPSâ€ï¼Œå¤´éƒ¨å‹ç¼©ã€å¤šè·¯å¤ç”¨ç­‰æŠ€æœ¯å¯ä»¥å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œé™ä½å»¶è¿Ÿï¼Œä»è€Œå¤§å¹…åº¦æé«˜ä¸Šç½‘ä½“éªŒï¼›</p></li><li><p>QUIC åŸºäº UDP å®ç°ï¼Œæ˜¯ HTTP/3 ä¸­çš„åº•å±‚æ”¯æ’‘åè®®ï¼Œè¯¥åè®®åŸºäº UDPï¼Œåˆå–äº† TCP ä¸­çš„ç²¾åï¼Œå®ç°äº†å³å¿«åˆå¯é çš„åè®®ã€‚</p></li></ul><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><p>é€è§†HTTPåè®®</p></li><li><p>Webåè®®è¯¦è§£ä¸æŠ“åŒ…å®æˆ˜</p></li><li><p>æµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µ</p></li><li><p>HTTP2è®²è§£</p></li><li><p>ä¸€æ–‡è¯»æ‡‚ HTTP/2 ç‰¹æ€§</p></li><li><p>ç§‘æ™®ï¼šQUICåè®®åŸç†åˆ†æ</p></li><li><p>HTTP2ç®€ä»‹å’ŒåŸºäºHTTP2çš„Webä¼˜åŒ–</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åè®® </tag>
            
            <tag> http </tag>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸå‹é“¾</title>
      <link href="/2019/10/10/%E5%8E%9F%E5%9E%8B%E9%93%BE/"/>
      <url>/2019/10/10/%E5%8E%9F%E5%9E%8B%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="æ„é€ å‡½æ•°-åŸå‹-å®ä¾‹"><a href="#æ„é€ å‡½æ•°-åŸå‹-å®ä¾‹" class="headerlink" title="æ„é€ å‡½æ•°,åŸå‹,å®ä¾‹"></a>æ„é€ å‡½æ•°,åŸå‹,å®ä¾‹</h2><p><img src="https://user-gold-cdn.xitu.io/2019/8/18/16ca353635266a66?w=576&h=617&f=png&s=21273" alt><br>æ„é€ å‡½æ•°å†…éƒ¨æœ‰ä¸€ä¸ªåä¸º<code>prototype</code> çš„å±æ€§ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§å°±èƒ½è®¿é—®åˆ°åŸå‹.</p><p><strong>Person</strong> å°±æ˜¯æ„é€ å‡½æ•°ï¼Œ<strong>Person.prototype</strong> å°±æ˜¯åŸå‹.</p><p>æœ‰ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åŸå‹ä¸Šåˆ›å»ºå¯ä»¥<strong>ç»§æ‰¿</strong>çš„å±æ€§ï¼Œå¹¶é€šè¿‡ <code>new</code> æ“ä½œç¬¦åˆ›å»ºå®ä¾‹.</p><p>å®ä¾‹é€šè¿‡ <code>__proto__</code> è®¿é—®åˆ°åŸå‹ï¼Œæ‰€ä»¥å¦‚æœæ˜¯å®ä¾‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§ç›´æ¥è®¿é—®åˆ°åŸå‹.</p><p>æ—¢ç„¶æ„é€ å‡½æ•°é€šè¿‡ <code>prototype</code> æ¥è®¿é—®åˆ°åŸå‹ï¼Œé‚£ä¹ˆåŸå‹ä¹Ÿåº”è¯¥èƒ½å¤Ÿé€šè¿‡æŸç§é€”å¾„è®¿é—®åˆ°æ„é€ å‡½æ•°ï¼Œè¿™å°±æ˜¯ <code>constructor</code>.</p><p>åŸå‹åŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡ <code>__proto__</code> è®¿é—®åˆ°åŸå‹çš„åŸå‹,ï¼Œå°±ä¼šé€šè¿‡<code>__proto__</code>ä½œä¸ºæ¡¥æ¢è¿æ¥èµ·æ¥çš„ä¸€ç³»åˆ—åŸå‹ã€åŸå‹çš„åŸå‹ï¼Œç›´åˆ°å°½å¤´<code>null</code>ä¸ºæ­¢ã€‚</p><h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><p>new è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚</p><p>å½“ä»£ç  <code>new Foo(...)</code> æ‰§è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹äº‹æƒ…</p><ul><li><p>1ã€æ–°ç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡</p></li><li><p>2ã€é“¾æ¥åˆ°åŸå‹</p></li><li><p>3ã€ç»‘å®š this</p></li><li><p>4ã€è¿”å›æ–°å¯¹è±¡</p><pre><code>function create() {  // åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡ let obj = new Object() // è·å¾—æ„é€ å‡½æ•° let Con = [].shift.call(arguments) // é“¾æ¥åˆ°åŸå‹ obj.__proto__ = Con.prototype // ç»‘å®š thisï¼Œæ‰§è¡Œæ„é€ å‡½æ•° let result = Con.apply(obj, arguments) // ç¡®ä¿ new å‡ºæ¥çš„æ˜¯ä¸ªå¯¹è±¡ return typeof result === &#39;object&#39; ? result : obj}</code></pre><p>è¿”å›å€¼å¯èƒ½ç”±ä¸‰ç§æƒ…å†µ</p></li><li><p>1ã€è¿”å›ä¸€ä¸ªå¯¹è±¡ åªèƒ½è®¿é—®åˆ°è¿”å›å¯¹è±¡ä¸­çš„å±æ€§ã€‚</p></li><li><p>2ã€æ²¡æœ‰ <code>return</code>ï¼Œå³è¿”å› <code>undefined</code> åªèƒ½è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§</p></li><li><p>3ã€è¿”å›<code>undefined</code> ä»¥å¤–çš„åŸºæœ¬ç±»å‹ åªèƒ½è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§<br>æ‰€ä»¥éœ€è¦åˆ¤æ–­ä¸‹è¿”å›çš„å€¼æ˜¯ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯å¯¹è±¡åˆ™è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œä¸ç„¶è¿”å›æ–°åˆ›å»ºçš„ objå¯¹è±¡ã€‚</p></li></ul><p>å¯¹äº <code>new</code> æ¥è¯´ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸‹è¿ç®—ç¬¦ä¼˜å…ˆçº§ã€‚</p><pre><code>function Foo() { return this;}Foo.getName = function () { console.log(&#39;1&#39;);};Foo.prototype.getName = function () { console.log(&#39;2&#39;);};new Foo.getName(); // -&gt; 1new Foo().getName(); // -&gt; 2 </code></pre><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ<code>new Foo()</code> çš„ä¼˜å…ˆçº§å¤§äº <code>new Foo</code>ï¼Œæ‰€ä»¥å¯¹äºä¸Šè¿°ä»£ç æ¥è¯´å¯ ä»¥è¿™æ ·åˆ’åˆ†æ‰§è¡Œé¡ºåº</p><p><code>new (Foo.getName());</code></p><p><code>(new Foo()).getName();</code></p><p>å¯¹äºç¬¬ä¸€ä¸ªå‡½æ•°æ¥è¯´ï¼Œå…ˆæ‰§è¡Œäº† <code>Foo.getName()</code> ï¼Œæ‰€ä»¥ç»“æœä¸º 1ï¼›å¯¹äºåè€…æ¥è¯´ï¼Œ å…ˆæ‰§è¡Œ <code>new Foo()</code> äº§ç”Ÿäº†ä¸€ä¸ªå®ä¾‹ï¼Œç„¶åé€šè¿‡åŸå‹é“¾æ‰¾åˆ°äº† <code>Foo</code> ä¸Šçš„ <code>getName</code> å‡½æ•°ï¼Œ æ‰€ä»¥ç»“æœä¸º 2ã€‚</p><h2 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h2><p><code>instanceof</code> å¯ä»¥æ­£ç¡®çš„åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ï¼Œå› ä¸ºå†…éƒ¨æœºåˆ¶æ˜¯é€šè¿‡åˆ¤æ–­å¯¹è±¡çš„åŸå‹é“¾ ä¸­æ˜¯ä¸æ˜¯èƒ½æ‰¾åˆ°ç±»å‹çš„ prototypeã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è¯•ç€å®ç°ä¸€ä¸‹ instanceof</p><pre><code>function instanceof(left, right) {   // è·å¾—ç±»å‹çš„åŸå‹   let prototype = right.prototype   // è·å¾—å¯¹è±¡çš„åŸå‹   left = left.__proto__   // åˆ¤æ–­å¯¹è±¡çš„ç±»å‹æ˜¯å¦ç­‰äºç±»å‹çš„åŸå‹   while (true) {       if (left === null)           return false       if (prototype === left)           return true       left = left.__proto__ //ä¸å­˜åœ¨æ²¿ç€åŸå‹é“¾ç»§ç»­æ‰¾   }}</code></pre><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><h3 id="åŸå‹é“¾ç»§æ‰¿"><a href="#åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿"></a>åŸå‹é“¾ç»§æ‰¿</h3><p>æ„é€ å‡½æ•°ã€åŸå‹å’Œå®ä¾‹ä¹‹é—´çš„å…³ç³»ï¼šæ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆï¼Œè€Œå®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªåŸå‹å¯¹è±¡çš„æŒ‡é’ˆã€‚<br>ç»§æ‰¿çš„æœ¬è´¨å°±æ˜¯<strong>å¤åˆ¶ï¼Œå³é‡å†™åŸå‹å¯¹è±¡ï¼Œä»£ä¹‹ä»¥ä¸€ä¸ªæ–°ç±»å‹çš„å®ä¾‹</strong>ã€‚</p><pre><code>function SuperType() {    this.property = true;}SuperType.prototype.getSuperValue = function() {    return this.property;}function SubType() {    this.subproperty = false;}// è¿™é‡Œæ˜¯å…³é”®ï¼Œåˆ›å»ºSuperTypeçš„å®ä¾‹ï¼Œå¹¶å°†è¯¥å®ä¾‹èµ‹å€¼ç»™SubType.prototypeSubType.prototype = new SuperType(); SubType.prototype.getSubValue = function() {    return this.subproperty;}var instance = new SubType();console.log(instance.getSuperValue()); // true</code></pre><p><img src="https://user-gold-cdn.xitu.io/2018/10/30/166c2c0107fd80c7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt><br>åŸå‹é“¾æ–¹æ¡ˆå­˜åœ¨çš„ç¼ºç‚¹ï¼šå¤šä¸ªå®ä¾‹å¯¹å¼•ç”¨ç±»å‹çš„æ“ä½œä¼šè¢«ç¯¡æ”¹ã€‚</p><pre><code>function SuperType(){  this.colors = [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;];}function SubType(){}SubType.prototype = new SuperType();var instance1 = new SubType();instance1.colors.push(&quot;black&quot;);alert(instance1.colors); //&quot;red,blue,green,black&quot;var instance2 = new SubType(); alert(instance2.colors); //&quot;red,blue,green,black&quot;</code></pre><h3 id="å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿"><a href="#å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿" class="headerlink" title="å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿"></a>å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿</h3><p>ä½¿ç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å¢å¼ºå­ç±»å®ä¾‹ï¼Œç­‰åŒäºå¤åˆ¶çˆ¶ç±»çš„å®ä¾‹ç»™å­ç±»ï¼ˆä¸ä½¿ç”¨åŸå‹ï¼‰</p><pre><code>function  SuperType(){    this.color=[&quot;red&quot;,&quot;green&quot;,&quot;blue&quot;];}function  SubType(){    //ç»§æ‰¿è‡ªSuperType    SuperType.call(this);}var instance1 = new SubType();instance1.color.push(&quot;black&quot;);alert(instance1.color);//&quot;red,green,blue,black&quot;var instance2 = new SubType();alert(instance2.color);//&quot;red,green,blue&quot;</code></pre><p>æ ¸å¿ƒä»£ç æ˜¯<code>SuperType.call(this)</code>ï¼Œåˆ›å»ºå­ç±»å®ä¾‹æ—¶è°ƒç”¨<code>SuperType</code>æ„é€ å‡½æ•°ï¼Œäºæ˜¯<code>SubType</code>çš„æ¯ä¸ªå®ä¾‹éƒ½ä¼šå°†<code>SuperType</code>ä¸­çš„å±æ€§å¤åˆ¶ä¸€ä»½ã€‚<br>ç¼ºç‚¹ï¼š</p><ul><li>åªèƒ½ç»§æ‰¿çˆ¶ç±»çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œä¸èƒ½ç»§æ‰¿åŸå‹å±æ€§/æ–¹æ³•</li><li>æ— æ³•å®ç°å¤ç”¨ï¼Œæ¯ä¸ªå­ç±»éƒ½æœ‰çˆ¶ç±»å®ä¾‹å‡½æ•°çš„å‰¯æœ¬ï¼Œå½±å“æ€§èƒ½</li></ul><h3 id="ç»„åˆç»§æ‰¿"><a href="#ç»„åˆç»§æ‰¿" class="headerlink" title="ç»„åˆç»§æ‰¿"></a>ç»„åˆç»§æ‰¿</h3><p>ç»„åˆä¸Šè¿°ä¸¤ç§æ–¹æ³•å°±æ˜¯ç»„åˆç»§æ‰¿ã€‚ç”¨åŸå‹é“¾å®ç°å¯¹åŸå‹å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ï¼Œç”¨å€Ÿç”¨æ„é€ å‡½æ•°æŠ€æœ¯æ¥å®ç°å®ä¾‹å±æ€§çš„ç»§æ‰¿ã€‚</p><pre><code>function SuperType(name){  this.name = name;  this.colors = [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;];}SuperType.prototype.sayName = function(){  alert(this.name);};function SubType(name, age){  // ç»§æ‰¿å±æ€§  // ç¬¬äºŒæ¬¡è°ƒç”¨SuperType()  SuperType.call(this, name);  this.age = age;}// ç»§æ‰¿æ–¹æ³•// æ„å»ºåŸå‹é“¾// ç¬¬ä¸€æ¬¡è°ƒç”¨SuperType()SubType.prototype = new SuperType(); // é‡å†™SubType.prototypeçš„constructorå±æ€§ï¼ŒæŒ‡å‘è‡ªå·±çš„æ„é€ å‡½æ•°SubTypeSubType.prototype.constructor = SubType; SubType.prototype.sayAge = function(){    alert(this.age);};var instance1 = new SubType(&quot;Nicholas&quot;, 29);instance1.colors.push(&quot;black&quot;);alert(instance1.colors); //&quot;red,blue,green,black&quot;instance1.sayName(); //&quot;Nicholas&quot;;instance1.sayAge(); //29var instance2 = new SubType(&quot;Greg&quot;, 27);alert(instance2.colors); //&quot;red,blue,green&quot;instance2.sayName(); //&quot;Greg&quot;;instance2.sayAge(); //27</code></pre><p><img src="https://user-gold-cdn.xitu.io/2018/10/30/166c2c010c537ff8?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt><br>ç¼ºç‚¹ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡è°ƒç”¨<code>SuperType()</code>ï¼šç»™<code>SubType.prototype</code>å†™å…¥ä¸¤ä¸ªå±æ€§<code>name</code>ï¼Œ<code>color</code>ã€‚</li><li>ç¬¬äºŒæ¬¡è°ƒç”¨<code>SuperType()</code>ï¼šç»™<code>instance1</code>å†™å…¥ä¸¤ä¸ªå±æ€§<code>nameï¼Œcolor</code>ã€‚</li></ul><p>å®ä¾‹å¯¹è±¡<code>instance1</code>ä¸Šçš„ä¸¤ä¸ªå±æ€§å°±å±è”½äº†å…¶åŸå‹å¯¹è±¡<code>SubType.prototype</code>çš„ä¸¤ä¸ªåŒåå±æ€§ã€‚æ‰€ä»¥ï¼Œç»„åˆæ¨¡å¼çš„ç¼ºç‚¹å°±æ˜¯åœ¨ä½¿ç”¨å­ç±»åˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶ï¼Œå…¶åŸå‹ä¸­ä¼šå­˜åœ¨ä¸¤ä»½ç›¸åŒçš„å±æ€§/æ–¹æ³•ã€‚</p><h3 id="åŸå‹å¼ç»§æ‰¿"><a href="#åŸå‹å¼ç»§æ‰¿" class="headerlink" title="åŸå‹å¼ç»§æ‰¿"></a>åŸå‹å¼ç»§æ‰¿</h3><p>åˆ©ç”¨ä¸€ä¸ªç©ºå¯¹è±¡ä½œä¸ºä¸­ä»‹ï¼Œå°†æŸä¸ªå¯¹è±¡ç›´æ¥èµ‹å€¼ç»™ç©ºå¯¹è±¡æ„é€ å‡½æ•°çš„åŸå‹ã€‚</p><pre><code>function object(obj){  function F(){}  F.prototype = obj;  return new F();}</code></pre><p><code>object()</code>å¯¹ä¼ å…¥å…¶ä¸­çš„å¯¹è±¡æ‰§è¡Œäº†ä¸€æ¬¡æµ…å¤åˆ¶ï¼Œå°†æ„é€ å‡½æ•°Fçš„åŸå‹ç›´æ¥æŒ‡å‘ä¼ å…¥çš„å¯¹è±¡ã€‚</p><pre><code>var person = {  name: &quot;Nicholas&quot;,  friends: [&quot;Shelby&quot;, &quot;Court&quot;, &quot;Van&quot;]};var anotherPerson = object(person);anotherPerson.name = &quot;Greg&quot;;anotherPerson.friends.push(&quot;Rob&quot;);var yetAnotherPerson = object(person);yetAnotherPerson.name = &quot;Linda&quot;;yetAnotherPerson.friends.push(&quot;Barbie&quot;);alert(person.friends);   //&quot;Shelby,Court,Van,Rob,Barbie&quot;</code></pre><p>ç¼ºç‚¹ï¼š</p><ul><li>åŸå‹é“¾ç»§æ‰¿å¤šä¸ªå®ä¾‹çš„å¼•ç”¨ç±»å‹å±æ€§æŒ‡å‘ç›¸åŒï¼Œå­˜åœ¨ç¯¡æ”¹çš„å¯èƒ½ã€‚</li><li>æ— æ³•ä¼ é€’å‚æ•°<br>å¦å¤–ï¼ŒES5ä¸­å­˜åœ¨<code>Object.create()</code>çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿä»£æ›¿ä¸Šé¢çš„<code>object</code>æ–¹æ³•ã€‚</li></ul><h3 id="å¯„ç”Ÿå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿå¼ç»§æ‰¿"></a>å¯„ç”Ÿå¼ç»§æ‰¿</h3><p>æ ¸å¿ƒï¼šåœ¨åŸå‹å¼ç»§æ‰¿çš„åŸºç¡€ä¸Šï¼Œå¢å¼ºå¯¹è±¡ï¼Œè¿”å›æ„é€ å‡½æ•°</p><pre><code>function createAnother(original){  var clone = object(original); // é€šè¿‡è°ƒç”¨ object() å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡  clone.sayHi = function(){  // ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡    alert(&quot;hi&quot;);  };  return clone; // è¿”å›è¿™ä¸ªå¯¹è±¡}</code></pre><p>å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºæ„é€ å‡½æ•°æ–°å¢å±æ€§å’Œæ–¹æ³•ï¼Œä»¥å¢å¼ºå‡½æ•°</p><pre><code>var person = {  name: &quot;Nicholas&quot;,  friends: [&quot;Shelby&quot;, &quot;Court&quot;, &quot;Van&quot;]};var anotherPerson = createAnother(person);anotherPerson.sayHi(); //&quot;hi&quot;</code></pre><p>ç¼ºç‚¹ï¼ˆåŒåŸå‹å¼ç»§æ‰¿ï¼‰ï¼š</p><ul><li>åŸå‹é“¾ç»§æ‰¿å¤šä¸ªå®ä¾‹çš„å¼•ç”¨ç±»å‹å±æ€§æŒ‡å‘ç›¸åŒï¼Œå­˜åœ¨ç¯¡æ”¹çš„å¯èƒ½ã€‚</li><li>æ— æ³•ä¼ é€’å‚æ•°</li></ul><h3 id="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"></a>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</h3><p>ç»“åˆå€Ÿç”¨æ„é€ å‡½æ•°ä¼ é€’å‚æ•°å’Œå¯„ç”Ÿæ¨¡å¼å®ç°ç»§æ‰¿</p><pre><code>function inheritPrototype(subType, superType){  var prototype = Object.create(superType.prototype); // åˆ›å»ºå¯¹è±¡ï¼Œåˆ›å»ºçˆ¶ç±»åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬  prototype.constructor = subType;                    // å¢å¼ºå¯¹è±¡ï¼Œå¼¥è¡¥å› é‡å†™åŸå‹è€Œå¤±å»çš„é»˜è®¤çš„constructor å±æ€§  subType.prototype = prototype;                      // æŒ‡å®šå¯¹è±¡ï¼Œå°†æ–°åˆ›å»ºçš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»çš„åŸå‹}// çˆ¶ç±»åˆå§‹åŒ–å®ä¾‹å±æ€§å’ŒåŸå‹å±æ€§function SuperType(name){  this.name = name;  this.colors = [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;];}SuperType.prototype.sayName = function(){  alert(this.name);};// å€Ÿç”¨æ„é€ å‡½æ•°ä¼ é€’å¢å¼ºå­ç±»å®ä¾‹å±æ€§ï¼ˆæ”¯æŒä¼ å‚å’Œé¿å…ç¯¡æ”¹ï¼‰function SubType(name, age){  SuperType.call(this, name);  this.age = age;}// å°†çˆ¶ç±»åŸå‹æŒ‡å‘å­ç±»inheritPrototype(SubType, SuperType);// æ–°å¢å­ç±»åŸå‹å±æ€§SubType.prototype.sayAge = function(){  alert(this.age);}var instance1 = new SubType(&quot;xyc&quot;, 23);var instance2 = new SubType(&quot;lxy&quot;, 23);instance1.colors.push(&quot;2&quot;); // [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;2&quot;]instance1.colors.push(&quot;3&quot;); // [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;3&quot;]</code></pre><p><img src="https://user-gold-cdn.xitu.io/2018/10/30/166c2c0109df5438?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt><br>è¿™ä¸ªä¾‹å­çš„é«˜æ•ˆç‡ä½“ç°åœ¨å®ƒåªè°ƒç”¨äº†ä¸€æ¬¡<code>SuperType</code> æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å› æ­¤é¿å…äº†åœ¨<code>SubType.prototype</code>ä¸Šåˆ›å»ºä¸å¿…è¦çš„ã€å¤šä½™çš„å±æ€§ã€‚äºæ­¤åŒæ—¶ï¼ŒåŸå‹é“¾è¿˜èƒ½ä¿æŒä¸å˜ï¼›å› æ­¤ï¼Œè¿˜èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨<code>instanceof</code> å’Œ<code>isPrototypeOf()</code><br><strong>è¿™æ˜¯æœ€æˆç†Ÿçš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ç°åœ¨åº“å®ç°çš„æ–¹æ³•</strong></p><h3 id="æ··å…¥æ–¹å¼ç»§æ‰¿å¤šä¸ªå¯¹è±¡"><a href="#æ··å…¥æ–¹å¼ç»§æ‰¿å¤šä¸ªå¯¹è±¡" class="headerlink" title="æ··å…¥æ–¹å¼ç»§æ‰¿å¤šä¸ªå¯¹è±¡"></a>æ··å…¥æ–¹å¼ç»§æ‰¿å¤šä¸ªå¯¹è±¡</h3><pre><code>function MyClass() {     SuperClass.call(this);     OtherSuperClass.call(this);}// ç»§æ‰¿ä¸€ä¸ªç±»MyClass.prototype = Object.create(SuperClass.prototype);// æ··åˆå…¶å®ƒObject.assign(MyClass.prototype, OtherSuperClass.prototype);// é‡æ–°æŒ‡å®šconstructorMyClass.prototype.constructor = MyClass;MyClass.prototype.myMethod = function() {     // do something};</code></pre><p><code>Object.assign</code>ä¼šæŠŠ<code>OtherSuperClass</code>åŸå‹ä¸Šçš„å‡½æ•°æ‹·è´åˆ°<code>MyClass</code>åŸå‹ä¸Šï¼Œä½¿<code>MyClass</code>çš„æ‰€æœ‰å®ä¾‹éƒ½å¯ç”¨<code>OtherSuperClass</code>çš„æ–¹æ³•ã€‚</p><h3 id="ES6ç±»ç»§æ‰¿extends"><a href="#ES6ç±»ç»§æ‰¿extends" class="headerlink" title="ES6ç±»ç»§æ‰¿extends"></a>ES6ç±»ç»§æ‰¿extends</h3><p>extendså…³é”®å­—ä¸»è¦ç”¨äºç±»å£°æ˜æˆ–è€…ç±»è¡¨è¾¾å¼ä¸­ï¼Œä»¥åˆ›å»ºä¸€ä¸ªç±»ï¼Œè¯¥ç±»æ˜¯å¦ä¸€ä¸ªç±»çš„å­ç±»ã€‚å…¶ä¸­constructorè¡¨ç¤ºæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªç±»ä¸­åªèƒ½æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæœ‰å¤šä¸ªä¼šæŠ¥å‡ºSyntaxErroré”™è¯¯,å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šæ„é€ æ–¹æ³•ï¼Œåˆ™ä¼šæ·»åŠ é»˜è®¤çš„ constructoræ–¹æ³•ï¼Œä½¿ç”¨ä¾‹å­å¦‚ä¸‹ã€‚</p><pre><code>class Rectangle {    // constructor    constructor(height, width) {        this.height = height;        this.width = width;    }    // Getter    get area() {        return this.calcArea()    }    // Method    calcArea() {        return this.height * this.width;    }}const rectangle = new Rectangle(10, 20);console.log(rectangle.area);// è¾“å‡º 200-----------------------------------------------------------------// ç»§æ‰¿class Square extends Rectangle {  constructor(length) {    super(length, length);    // å¦‚æœå­ç±»ä¸­å­˜åœ¨æ„é€ å‡½æ•°ï¼Œåˆ™éœ€è¦åœ¨ä½¿ç”¨â€œthisâ€ä¹‹å‰é¦–å…ˆè°ƒç”¨ super()ã€‚    this.name = &#39;Square&#39;;  }  get area() {    return this.height * this.width;  }}const square = new Square(10);console.log(square.area);// è¾“å‡º 100</code></pre><p>extendsç»§æ‰¿çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œå…¶å®ç°å’Œä¸Šè¿°çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ–¹å¼ä¸€æ ·</p><pre><code>function _inherits(subType, superType) {    // åˆ›å»ºå¯¹è±¡ï¼Œåˆ›å»ºçˆ¶ç±»åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬    // å¢å¼ºå¯¹è±¡ï¼Œå¼¥è¡¥å› é‡å†™åŸå‹è€Œå¤±å»çš„é»˜è®¤çš„constructor å±æ€§    // æŒ‡å®šå¯¹è±¡ï¼Œå°†æ–°åˆ›å»ºçš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»çš„åŸå‹    subType.prototype = Object.create(superType &amp;&amp; superType.prototype, {        constructor: {            value: subType,            enumerable: false,            writable: true,            configurable: true        }    });       if (superType) {        Object.setPrototypeOf             ? Object.setPrototypeOf(subType, superType)             : subType.__proto__ = superType;    }}</code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><h4 id="å‡½æ•°å£°æ˜å’Œç±»å£°æ˜çš„åŒºåˆ«"><a href="#å‡½æ•°å£°æ˜å’Œç±»å£°æ˜çš„åŒºåˆ«" class="headerlink" title="å‡½æ•°å£°æ˜å’Œç±»å£°æ˜çš„åŒºåˆ«"></a>å‡½æ•°å£°æ˜å’Œç±»å£°æ˜çš„åŒºåˆ«</h4><p>å‡½æ•°å£°æ˜ä¼šæå‡ï¼Œç±»å£°æ˜ä¸ä¼šã€‚é¦–å…ˆéœ€è¦å£°æ˜ä½ çš„ç±»ï¼Œç„¶åè®¿é—®å®ƒï¼Œå¦åˆ™åƒä¸‹é¢çš„ä»£ç ä¼šæŠ›å‡ºä¸€ä¸ªReferenceErrorã€‚</p><pre><code>let p = new Rectangle(); // ReferenceErrorclass Rectangle {}</code></pre><h4 id="ES5ç»§æ‰¿å’ŒES6ç»§æ‰¿çš„åŒºåˆ«"><a href="#ES5ç»§æ‰¿å’ŒES6ç»§æ‰¿çš„åŒºåˆ«" class="headerlink" title="ES5ç»§æ‰¿å’ŒES6ç»§æ‰¿çš„åŒºåˆ«"></a>ES5ç»§æ‰¿å’ŒES6ç»§æ‰¿çš„åŒºåˆ«</h4><ul><li>ES5çš„ç»§æ‰¿å®è´¨ä¸Šæ˜¯å…ˆåˆ›å»ºå­ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œç„¶åå†å°†çˆ¶ç±»çš„æ–¹æ³•æ·»åŠ åˆ°thisä¸Šï¼ˆParent.call(this)ï¼‰.</li><li>ES6çš„ç»§æ‰¿æœ‰æ‰€ä¸åŒï¼Œå®è´¨ä¸Šæ˜¯å…ˆåˆ›å»ºçˆ¶ç±»çš„å®ä¾‹å¯¹è±¡thisï¼Œç„¶åå†ç”¨å­ç±»çš„æ„é€ å‡½æ•°ä¿®æ”¹thisã€‚å› ä¸ºå­ç±»æ²¡æœ‰è‡ªå·±çš„thiså¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»å…ˆè°ƒç”¨çˆ¶ç±»çš„super()æ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹æŠ¥é”™ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸå‹é“¾ </tag>
            
            <tag> æ„é€ å‡½æ•° </tag>
            
            <tag> ç»§æ‰¿ </tag>
            
            <tag> new </tag>
            
            <tag> instanceof </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½œç”¨åŸŸ</title>
      <link href="/2019/10/04/%E6%89%A7%E8%A1%8C%E6%A0%88/"/>
      <url>/2019/10/04/%E6%89%A7%E8%A1%8C%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<p>è¿™æœŸå®Œå…¨å¤åˆ»æœ¨æ˜“è€å¸ˆçš„åšå®¢ï¼Œå› ä¸ºå†™çš„å¾ˆå¥½ æˆ‘è¿™é‡Œåªæ˜¯è‡ªå·±å¤ä¹ ï¼Œæ²¡æœ‰å•†ç”¨</p><p><a href="https://github.com/yygmind/blog" target="_blank" rel="noopener">æœ¨æ˜“è€å¸ˆåšå®¢åœ°å€</a></p><h1 id="æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡"></a>æ‰§è¡Œä¸Šä¸‹æ–‡</h1><p><strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>æ€»å…±æœ‰ä¸‰ç§ç±»å‹ï¼š</p><p><strong>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šåªæœ‰ä¸€ä¸ªï¼Œæµè§ˆå™¨ä¸­çš„å…¨å±€å¯¹è±¡å°±æ˜¯ <code>window</code> å¯¹è±¡ï¼Œthis æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚</p><p><strong>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šå­˜åœ¨æ— æ•°ä¸ªï¼Œåªæœ‰åœ¨å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™æ‰ä¼šè¢«åˆ›å»ºï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p><strong>Eval å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼š æŒ‡çš„æ˜¯è¿è¡Œåœ¨ <code>eval</code> å‡½æ•°ä¸­çš„ä»£ç ï¼Œå¾ˆå°‘ç”¨è€Œä¸”ä¸å»ºè®®ä½¿ç”¨ã€‚</p><h2 id="æ‰§è¡Œæ ˆ"><a href="#æ‰§è¡Œæ ˆ" class="headerlink" title="æ‰§è¡Œæ ˆ"></a>æ‰§è¡Œæ ˆ</h2><p>æ‰§è¡Œæ ˆï¼Œä¹Ÿå«è°ƒç”¨æ ˆï¼Œå…·æœ‰ <strong>LIFO</strong>ï¼ˆåè¿›å…ˆå‡ºï¼‰ç»“æ„ï¼Œç”¨äºå­˜å‚¨åœ¨ä»£ç æ‰§è¡ŒæœŸé—´åˆ›å»ºçš„æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p>é¦–æ¬¡è¿è¡ŒJSä»£ç æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª<strong>å…¨å±€</strong>æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶Pushåˆ°å½“å‰çš„æ‰§è¡Œæ ˆä¸­ã€‚æ¯å½“å‘ç”Ÿå‡½æ•°è°ƒç”¨ï¼Œå¼•æ“éƒ½ä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶Pushåˆ°å½“å‰æ‰§è¡Œæ ˆçš„æ ˆé¡¶ã€‚</p><p>æ ¹æ®æ‰§è¡Œæ ˆLIFOè§„åˆ™ï¼Œå½“æ ˆé¡¶å‡½æ•°è¿è¡Œå®Œæˆåï¼Œå…¶å¯¹åº”çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å°†ä¼šä»æ‰§è¡Œæ ˆä¸­Popå‡ºï¼Œä¸Šä¸‹æ–‡æ§åˆ¶æƒå°†ç§»åˆ°å½“å‰æ‰§è¡Œæ ˆçš„ä¸‹ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><pre><code>function first() {    console.log(&#39;Inside first function&#39;);    second();    console.log(&#39;Again inside first function&#39;);  }function second() {    console.log(&#39;Inside second function&#39;);  }first();  console.log(&#39;Inside Global Execution Context&#39;);// Inside first function// Inside second function// Again inside first function// Inside Global Execution Context</code></pre><p><img src="https://user-gold-cdn.xitu.io/2019/8/22/16cb80e4579be263?w=1280&h=228&f=webp&s=13834" alt></p><h2 id="æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º"></a>æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º</h2><p>æ‰§è¡Œä¸Šä¸‹æ–‡åˆ†ä¸¤ä¸ªé˜¶æ®µåˆ›å»ºï¼š<strong>1ï¼‰åˆ›å»ºé˜¶æ®µï¼› 2ï¼‰æ‰§è¡Œé˜¶æ®µ</strong></p><p><strong>åˆ›å»ºé˜¶æ®µ</strong></p><p>1ã€ç¡®å®š this çš„å€¼ï¼Œä¹Ÿè¢«ç§°ä¸º This Bindingã€‚</p><p>2ã€LexicalEnvironmentï¼ˆè¯æ³•ç¯å¢ƒï¼‰ ç»„ä»¶è¢«åˆ›å»ºã€‚</p><p>3ã€VariableEnvironmentï¼ˆå˜é‡ç¯å¢ƒï¼‰ ç»„ä»¶è¢«åˆ›å»ºã€‚<br>ç›´æ¥çœ‹ä¼ªä»£ç å¯èƒ½æ›´åŠ ç›´è§‚</p><p>ExecutionContext = {<br>  ThisBinding = <this value>,     // ç¡®å®šthis<br>  LexicalEnvironment = { â€¦ },   // è¯æ³•ç¯å¢ƒ<br>  VariableEnvironment = { â€¦ },  // å˜é‡ç¯å¢ƒ<br>}<br>This Binding<br>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œthis çš„å€¼æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­this çš„å€¼æŒ‡å‘ window å¯¹è±¡ï¼Œè€Œåœ¨nodejsä¸­æŒ‡å‘è¿™ä¸ªæ–‡ä»¶çš„moduleå¯¹è±¡ã€‚</this></p><p>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œthis çš„å€¼å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚å…·ä½“æœ‰ï¼šé»˜è®¤ç»‘å®šã€éšå¼ç»‘å®šã€æ˜¾å¼ç»‘å®šï¼ˆç¡¬ç»‘å®šï¼‰ã€newç»‘å®šã€ç®­å¤´å‡½æ•°ï¼Œå…·ä½“å†…å®¹ä¼šåœ¨ã€thiså…¨é¢è§£æã€‘éƒ¨åˆ†è¯¦è§£ã€‚</p><p>è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰<br>è¯æ³•ç¯å¢ƒæœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†</p><ul><li><p>1ã€ç¯å¢ƒè®°å½•ï¼šå­˜å‚¨å˜é‡å’Œå‡½æ•°å£°æ˜çš„å®é™…ä½ç½®</p></li><li><p>2ã€å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨ï¼šå¯ä»¥è®¿é—®å…¶å¤–éƒ¨è¯æ³•ç¯å¢ƒ</p></li></ul><p>è¯æ³•ç¯å¢ƒæœ‰ä¸¤ç§ç±»å‹</p><ul><li><p>1ã€å…¨å±€ç¯å¢ƒï¼šæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤–éƒ¨ç¯å¢ƒçš„è¯æ³•ç¯å¢ƒï¼Œå…¶å¤–éƒ¨ç¯å¢ƒå¼•ç”¨ä¸º nullã€‚æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆwindow å¯¹è±¡ï¼‰åŠå…¶å…³è”çš„æ–¹æ³•å’Œå±æ€§ï¼ˆä¾‹å¦‚æ•°ç»„æ–¹æ³•ï¼‰ä»¥åŠä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„å…¨å±€å˜é‡ï¼Œthis çš„å€¼æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚</p></li><li><p>2ã€å‡½æ•°ç¯å¢ƒï¼šç”¨æˆ·åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡è¢«å­˜å‚¨åœ¨ç¯å¢ƒè®°å½•ä¸­ï¼ŒåŒ…å«äº†arguments å¯¹è±¡ã€‚å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨å¯ä»¥æ˜¯å…¨å±€ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å†…éƒ¨å‡½æ•°çš„å¤–éƒ¨å‡½æ•°ç¯å¢ƒã€‚</p></li></ul><p>ç›´æ¥çœ‹ä¼ªä»£ç å¯èƒ½æ›´åŠ ç›´è§‚</p><pre><code>GlobalExectionContext = {  // å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡  LexicalEnvironment: {          // è¯æ³•ç¯å¢ƒ    EnvironmentRecord: {           // ç¯å¢ƒè®°å½•      Type: &quot;Object&quot;,                 // å…¨å±€ç¯å¢ƒ      // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ       outer: &lt;null&gt;                    // å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨  }  }FunctionExectionContext = { // å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡  LexicalEnvironment: {        // è¯æ³•ç¯å¢ƒ    EnvironmentRecord: {          // ç¯å¢ƒè®°å½•      Type: &quot;Declarative&quot;,         // å‡½æ•°ç¯å¢ƒ      // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ               // å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨      outer: &lt;Global or outer function environment reference&gt;    }  }</code></pre><p>å˜é‡ç¯å¢ƒ<br>å˜é‡ç¯å¢ƒä¹Ÿæ˜¯ä¸€ä¸ªè¯æ³•ç¯å¢ƒï¼Œå› æ­¤å®ƒå…·æœ‰ä¸Šé¢å®šä¹‰çš„è¯æ³•ç¯å¢ƒçš„æ‰€æœ‰å±æ€§ã€‚</p><p>åœ¨ ES6 ä¸­ï¼Œè¯æ³• ç¯å¢ƒå’Œ å˜é‡ ç¯å¢ƒçš„åŒºåˆ«åœ¨äºå‰è€…ç”¨äºå­˜å‚¨<strong>å‡½æ•°å£°æ˜å’Œå˜é‡</strong>ï¼ˆ let å’Œ const ï¼‰ç»‘å®šï¼Œè€Œåè€…ä»…ç”¨äºå­˜å‚¨<strong>å˜é‡</strong>ï¼ˆ var ï¼‰ç»‘å®šã€‚</p><p>ä½¿ç”¨ä¾‹å­è¿›è¡Œä»‹ç»</p><pre><code>let a = 20;  const b = 30;  var c;function multiply(e, f) {   var g = 20;   return e * f * g;  }c = multiply(20, 30);</code></pre><p>æ‰§è¡Œä¸Šä¸‹æ–‡å¦‚ä¸‹æ‰€ç¤º</p><pre><code>GlobalExectionContext = {  ThisBinding: &lt;Global Object&gt;,  LexicalEnvironment: {      EnvironmentRecord: {        Type: &quot;Object&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        a: &lt; uninitialized &gt;,        b: &lt; uninitialized &gt;,        multiply: &lt; func &gt;      }      outer: &lt;null&gt;    },  VariableEnvironment: {      EnvironmentRecord: {        Type: &quot;Object&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        c: undefined,      }      outer: &lt;null&gt;    }  }FunctionExectionContext = {    ThisBinding: &lt;Global Object&gt;,  LexicalEnvironment: {      EnvironmentRecord: {        Type: &quot;Declarative&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        Arguments: {0: 20, 1: 30, length: 2},      },      outer: &lt;GlobalLexicalEnvironment&gt;    },  VariableEnvironment: {      EnvironmentRecord: {        Type: &quot;Declarative&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        g: undefined      },      outer: &lt;GlobalLexicalEnvironment&gt;    }  }</code></pre><h2 id="æå‡"><a href="#æå‡" class="headerlink" title="æå‡"></a>æå‡</h2><ul><li>1.å˜é‡æå‡<pre><code>console.log(num); //undefinedvar num = 1;</code></pre></li><li>2.å‡½æ•°æå‡<pre><code>foo();  // foo2var foo = function() {  console.log(&#39;foo1&#39;);}foo();  // foo1ï¼Œfooé‡æ–°èµ‹å€¼function foo() {  console.log(&#39;foo2&#39;);}foo(); // foo1</code></pre></li></ul><h2 id="æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ"></a>æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ</h2><p>å› ä¸ºJSå¼•æ“åˆ›å»ºäº†å¾ˆå¤šçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥JSå¼•æ“åˆ›å»ºäº†æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼ˆExecution context stackï¼ŒECSï¼‰æ¥ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚<br>æœ‰å¦‚ä¸‹ä¸¤æ®µä»£ç ï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸¤æ®µä»£ç ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><pre><code>var scope = &quot;global scope&quot;;function checkscope(){    var scope = &quot;local scope&quot;;    function f(){        return scope;    }    return f();}checkscope();</code></pre><pre><code>var scope = &quot;global scope&quot;;function checkscope(){    var scope = &quot;local scope&quot;;    function f(){        return scope;    }    return f;}checkscope()();</code></pre><p>ç­”æ¡ˆæ˜¯ æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„å˜åŒ–ä¸ä¸€æ ·ã€‚</p><p>ç¬¬ä¸€æ®µä»£ç ï¼š</p><pre><code>ECStack.push(&lt;checkscope&gt; functionContext);ECStack.push(&lt;f&gt; functionContext);ECStack.pop();ECStack.pop();</code></pre><p>ç¬¬äºŒæ®µä»£ç ï¼š</p><pre><code>ECStack.push(&lt;checkscope&gt; functionContext);ECStack.pop();ECStack.push(&lt;f&gt; functionContext);ECStack.pop();</code></pre><h2 id="å‡½æ•°ä¸Šä¸‹æ–‡"><a href="#å‡½æ•°ä¸Šä¸‹æ–‡" class="headerlink" title="å‡½æ•°ä¸Šä¸‹æ–‡"></a>å‡½æ•°ä¸Šä¸‹æ–‡</h2><p>åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼Œç”¨æ´»åŠ¨å¯¹è±¡(activation object, AO)æ¥è¡¨ç¤ºå˜é‡å¯¹è±¡ã€‚</p><p><strong>æ´»åŠ¨å¯¹è±¡å’Œå˜é‡å¯¹è±¡</strong>çš„åŒºåˆ«åœ¨äº</p><ul><li>1ã€å˜é‡å¯¹è±¡ï¼ˆVOï¼‰æ˜¯è§„èŒƒä¸Šæˆ–è€…æ˜¯JSå¼•æ“ä¸Šå®ç°çš„ï¼Œå¹¶ä¸èƒ½åœ¨JSç¯å¢ƒä¸­ç›´æ¥è®¿é—®ã€‚</li><li>2ã€å½“è¿›å…¥åˆ°ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡åï¼Œè¿™ä¸ªå˜é‡å¯¹è±¡æ‰ä¼šè¢«æ¿€æ´»ï¼Œæ‰€ä»¥å«æ´»åŠ¨å¯¹è±¡ï¼ˆAOï¼‰ï¼Œè¿™æ—¶å€™æ´»åŠ¨å¯¹è±¡ä¸Šçš„å„ç§å±æ€§æ‰èƒ½è¢«è®¿é—®ã€‚<br>è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªArgumentså¯¹è±¡ï¼Œå¹¶è‡ªåŠ¨åˆå§‹åŒ–å±€éƒ¨å˜é‡argumentsï¼ŒæŒ‡ä»£è¯¥Argumentså¯¹è±¡ã€‚æ‰€æœ‰ä½œä¸ºå‚æ•°ä¼ å…¥çš„å€¼éƒ½ä¼šæˆä¸ºArgumentså¯¹è±¡çš„æ•°ç»„å…ƒç´ ã€‚</li></ul><p>æ‰§è¡Œè¿‡ç¨‹<br>æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä»£ç ä¼šåˆ†æˆä¸¤ä¸ªé˜¶æ®µè¿›è¡Œå¤„ç†</p><ul><li><p>1ã€è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡</p></li><li><p>2ã€ä»£ç æ‰§è¡Œ</p></li></ul><p>è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡<br>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰æ‰§è¡Œä»£ç </p><p>æ­¤æ—¶çš„å˜é‡å¯¹è±¡ä¼šåŒ…æ‹¬ï¼ˆå¦‚ä¸‹é¡ºåºåˆå§‹åŒ–ï¼‰ï¼š</p><ul><li><p>1ã€å‡½æ•°çš„æ‰€æœ‰å½¢å‚ (onlyå‡½æ•°ä¸Šä¸‹æ–‡)ï¼šæ²¡æœ‰å®å‚ï¼Œå±æ€§å€¼è®¾ä¸ºundefinedã€‚</p></li><li><p>2ã€å‡½æ•°å£°æ˜ï¼šå¦‚æœå˜é‡å¯¹è±¡å·²ç»å­˜åœ¨ç›¸åŒåç§°çš„å±æ€§ï¼Œåˆ™å®Œå…¨æ›¿æ¢è¿™ä¸ªå±æ€§ã€‚</p></li><li><p>3ã€å˜é‡å£°æ˜ï¼šå¦‚æœå˜é‡åç§°è·Ÿå·²ç»å£°æ˜çš„å½¢å‚æˆ–å‡½æ•°ç›¸åŒï¼Œåˆ™å˜é‡å£°æ˜ä¸ä¼šå¹²æ‰°å·²ç»å­˜åœ¨çš„è¿™ç±»å±æ€§ã€‚<br>ä¸Šä»£ç å°±ç›´è§‚äº†</p><pre><code>function foo(a) {var b = 2;function c() {}var d = function() {};b = 3;}foo(1);</code></pre><p>å¯¹äºä¸Šé¢çš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™çš„AOæ˜¯</p><pre><code>AO = {  arguments: {      0: 1,      length: 1  },  a: 1,  b: undefined,  c: reference to function c(){},  d: undefined}</code></pre><p>å½¢å‚argumentsè¿™æ—¶å€™å·²ç»æœ‰èµ‹å€¼äº†ï¼Œä½†æ˜¯å˜é‡è¿˜æ˜¯undefinedï¼Œåªæ˜¯åˆå§‹åŒ–çš„å€¼</p></li></ul><p>ä»£ç æ‰§è¡Œ<br>è¿™ä¸ªé˜¶æ®µä¼šé¡ºåºæ‰§è¡Œä»£ç ï¼Œä¿®æ”¹å˜é‡å¯¹è±¡çš„å€¼ï¼Œæ‰§è¡Œå®ŒæˆåAOå¦‚ä¸‹</p><pre><code>AO = {    arguments: {        0: 1,        length: 1    },    a: 1,    b: 3,    c: reference to function c(){},    d: reference to FunctionExpression &quot;d&quot;}</code></pre><p>æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li><p>1ã€å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡åˆå§‹åŒ–æ˜¯å…¨å±€å¯¹è±¡</p></li><li><p>2ã€å‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡åˆå§‹åŒ–åªåŒ…æ‹¬ Arguments å¯¹è±¡</p></li><li><p>3ã€åœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ä¼šç»™å˜é‡å¯¹è±¡æ·»åŠ å½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜ç­‰åˆå§‹çš„å±æ€§å€¼</p></li><li><p>4ã€åœ¨ä»£ç æ‰§è¡Œé˜¶æ®µï¼Œä¼šå†æ¬¡ä¿®æ”¹å˜é‡å¯¹è±¡çš„å±æ€§å€¼</p></li></ul><h2 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h2><ul><li>1.åŸºæœ¬ç±»å‹ï¼šâ€“&gt; æ ˆå†…å­˜ï¼ˆä¸åŒ…å«é—­åŒ…ä¸­çš„å˜é‡ï¼‰</li><li>2.å¼•ç”¨ç±»å‹ï¼šâ€“&gt; å †å†…å­˜</li></ul><h3 id="å†…å­˜å›æ”¶"><a href="#å†…å­˜å›æ”¶" class="headerlink" title="å†…å­˜å›æ”¶"></a>å†…å­˜å›æ”¶</h3><p>JavaScriptæœ‰è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæ¯éš”ä¸€æ®µæ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡é‡Šæ”¾æ“ä½œï¼Œæ‰¾å‡ºé‚£äº›ä¸å†ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Œç„¶åé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ã€‚</p><p><strong>å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡çš„é”€æ¯</strong></p><ul><li>å±€éƒ¨å˜é‡ï¼šå±€éƒ¨ä½œç”¨åŸŸä¸­ï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå±€éƒ¨å˜é‡ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œå› æ­¤åƒåœ¾æ”¶é›†å™¨å¾ˆå®¹æ˜“åšå‡ºåˆ¤æ–­å¹¶å›æ”¶ã€‚</li><li>å…¨å±€å˜é‡ï¼šå…¨å±€å˜é‡ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªåŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´åˆ™å¾ˆéš¾åˆ¤æ–­ï¼Œæ‰€ä»¥åœ¨å¼€å‘ä¸­å°½é‡é¿å…ä½¿ç”¨å…¨å±€å˜é‡ã€‚</li></ul><p>ä»¥Googleçš„V8å¼•æ“ä¸ºä¾‹ï¼ŒV8å¼•æ“ä¸­æ‰€æœ‰çš„JSå¯¹è±¡éƒ½æ˜¯é€šè¿‡<strong>å †</strong>æ¥è¿›è¡Œå†…å­˜åˆ†é…çš„</p><ul><li>åˆå§‹åˆ†é…ï¼šå½“å£°æ˜å˜é‡å¹¶èµ‹å€¼æ—¶ï¼ŒV8å¼•æ“å°±ä¼šåœ¨å †å†…å­˜ä¸­åˆ†é…ç»™è¿™ä¸ªå˜é‡ã€‚</li><li>ç»§ç»­ç”³è¯·ï¼šå½“å·²ç”³è¯·çš„å†…å­˜ä¸è¶³ä»¥å­˜å‚¨è¿™ä¸ªå˜é‡æ—¶ï¼ŒV8å¼•æ“å°±ä¼šç»§ç»­ç”³è¯·å†…å­˜ï¼Œç›´åˆ°å †çš„å¤§å°è¾¾åˆ°äº†V8å¼•æ“çš„å†…å­˜ä¸Šé™ä¸ºæ­¢ã€‚</li></ul><p>V8å¼•æ“å¯¹å †å†…å­˜ä¸­çš„JSå¯¹è±¡è¿›è¡Œåˆ†ä»£ç®¡ç†</p><ul><li>æ–°ç”Ÿä»£ï¼šå­˜æ´»å‘¨æœŸè¾ƒçŸ­çš„JSå¯¹è±¡ï¼Œå¦‚ä¸´æ—¶å˜é‡ã€å­—ç¬¦ä¸²ç­‰ã€‚</li><li>è€ç”Ÿä»£ï¼šç»è¿‡å¤šæ¬¡åƒåœ¾å›æ”¶ä»ç„¶å­˜æ´»ï¼Œå­˜æ´»å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼Œå¦‚ä¸»æ§åˆ¶å™¨ã€æœåŠ¡å™¨å¯¹è±¡ç­‰ã€‚</li></ul><h3 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h3><p>å¯¹åƒåœ¾å›æ”¶ç®—æ³•æ¥è¯´ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯å¦‚ä½•åˆ¤æ–­å†…å­˜å·²ç»ä¸å†ä½¿ç”¨ï¼Œå¸¸ç”¨åƒåœ¾å›æ”¶ç®—æ³•æœ‰ä¸‹é¢ä¸¤ç§ã€‚</p><ul><li>1.å¼•ç”¨è®¡æ•°ï¼ˆç°ä»£æµè§ˆå™¨ä¸å†ä½¿ç”¨ï¼‰</li><li>2.æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰</li></ul><h4 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h4><p>å¼•ç”¨è®¡æ•°ç®—æ³•å®šä¹‰â€œå†…å­˜ä¸å†ä½¿ç”¨â€çš„æ ‡å‡†å¾ˆç®€å•ï¼Œå°±æ˜¯çœ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰<strong>æŒ‡å‘å®ƒçš„å¼•ç”¨</strong>ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–å¯¹è±¡æŒ‡å‘å®ƒäº†ï¼Œè¯´æ˜è¯¥å¯¹è±¡å·²ç»ä¸å†éœ€è¦äº†ã€‚</p><pre><code>// åˆ›å»ºä¸€ä¸ªå¯¹è±¡personï¼Œä»–æœ‰ä¸¤ä¸ªæŒ‡å‘å±æ€§ageå’Œnameçš„å¼•ç”¨var person = {    age: 12,    name: &#39;aaaa&#39;};person.name = null; // è™½ç„¶nameè®¾ç½®ä¸ºnullï¼Œä½†å› ä¸ºpersonå¯¹è±¡è¿˜æœ‰æŒ‡å‘nameçš„å¼•ç”¨ï¼Œå› æ­¤nameä¸ä¼šå›æ”¶var p = person; person = 1;         //åŸæ¥çš„personå¯¹è±¡è¢«èµ‹å€¼ä¸º1ï¼Œä½†å› ä¸ºæœ‰æ–°å¼•ç”¨pæŒ‡å‘åŸpersonå¯¹è±¡ï¼Œå› æ­¤å®ƒä¸ä¼šè¢«å›æ”¶p = null;           //åŸpersonå¯¹è±¡å·²ç»æ²¡æœ‰å¼•ç”¨ï¼Œå¾ˆå¿«ä¼šè¢«å›æ”¶</code></pre><p>å¼•ç”¨è®¡æ•°æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯<strong>å¾ªç¯å¼•ç”¨</strong></p><p>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå°½ç®¡ä»–ä»¬å·²ä¸å†ä½¿ç”¨ï¼Œä½†æ˜¯åƒåœ¾å›æ”¶å™¨ä¸ä¼šè¿›è¡Œå›æ”¶ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p><pre><code>function cycle() {    var o1 = {};    var o2 = {};    o1.a = o2;    o2.a = o1;     return &quot;cycle reference!&quot;}cycle();</code></pre><p>cycleå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åï¼Œå¯¹è±¡o1å’Œo2å®é™…ä¸Šå·²ç»ä¸å†éœ€è¦äº†ï¼Œä½†æ ¹æ®å¼•ç”¨è®¡æ•°çš„åŸåˆ™ï¼Œä»–ä»¬ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ä¾ç„¶å­˜åœ¨ï¼Œå› æ­¤è¿™éƒ¨åˆ†å†…å­˜ä¸ä¼šè¢«å›æ”¶ã€‚æ‰€ä»¥ç°ä»£æµè§ˆå™¨ä¸å†ä½¿ç”¨è¿™ä¸ªç®—æ³•ã€‚</p><p>ä½†æ˜¯IEä¾æ—§ä½¿ç”¨ã€‚</p><pre><code>var div = document.createElement(&quot;div&quot;);div.onclick = function() {    console.log(&quot;click&quot;);};</code></pre><p>ä¸Šé¢çš„å†™æ³•å¾ˆå¸¸è§ï¼Œä½†æ˜¯ä¸Šé¢çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚</p><p>å˜é‡divæœ‰äº‹ä»¶å¤„ç†å‡½æ•°çš„å¼•ç”¨ï¼ŒåŒæ—¶äº‹ä»¶å¤„ç†å‡½æ•°ä¹Ÿæœ‰divçš„å¼•ç”¨ï¼Œå› ä¸ºdivå˜é‡å¯åœ¨å‡½æ•°å†…è¢«è®¿é—®ï¼Œæ‰€ä»¥å¾ªç¯å¼•ç”¨å°±å‡ºç°äº†ã€‚</p><h4 id="æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰"><a href="#æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰"></a>æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰</h4><p>æ ‡è®°æ¸…é™¤ç®—æ³•å°†â€œä¸å†ä½¿ç”¨çš„å¯¹è±¡â€å®šä¹‰ä¸ºâ€œæ— æ³•åˆ°è¾¾çš„å¯¹è±¡â€ã€‚å³ä»æ ¹éƒ¨ï¼ˆåœ¨JSä¸­å°±æ˜¯å…¨å±€å¯¹è±¡ï¼‰å‡ºå‘å®šæ—¶æ‰«æå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå‡¡æ˜¯èƒ½ä»æ ¹éƒ¨åˆ°è¾¾çš„å¯¹è±¡ï¼Œä¿ç•™ã€‚é‚£äº›ä»æ ¹éƒ¨å‡ºå‘æ— æ³•è§¦åŠåˆ°çš„å¯¹è±¡è¢«æ ‡è®°ä¸ºä¸å†ä½¿ç”¨ï¼Œç¨åè¿›è¡Œå›æ”¶ã€‚æ— æ³•è§¦åŠçš„å¯¹è±¡åŒ…å«äº†æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡è¿™ä¸ªæ¦‚å¿µï¼Œä½†åä¹‹æœªå¿…æˆç«‹ã€‚æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å°±å¯ä»¥æ­£ç¡®è¢«åƒåœ¾å›æ”¶å¤„ç†äº†ã€‚</p><p>ç®—æ³•ç”±ä»¥ä¸‹å‡ æ­¥ç»„æˆï¼š</p><ul><li><p>1ã€åƒåœ¾å›æ”¶å™¨åˆ›å»ºäº†ä¸€ä¸ªâ€œrootsâ€åˆ—è¡¨ã€‚roots é€šå¸¸æ˜¯ä»£ç ä¸­å…¨å±€å˜é‡çš„å¼•ç”¨ã€‚JavaScript ä¸­ï¼Œâ€œwindowâ€ å¯¹è±¡æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè¢«å½“ä½œ root ã€‚window å¯¹è±¡æ€»æ˜¯å­˜åœ¨ï¼Œå› æ­¤åƒåœ¾å›æ”¶å™¨å¯ä»¥æ£€æŸ¥å®ƒå’Œå®ƒçš„æ‰€æœ‰å­å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼ˆå³ä¸æ˜¯åƒåœ¾ï¼‰ï¼›</p></li><li><p>2ã€æ‰€æœ‰çš„ roots è¢«æ£€æŸ¥å’Œæ ‡è®°ä¸ºæ¿€æ´»ï¼ˆå³ä¸æ˜¯åƒåœ¾ï¼‰ã€‚æ‰€æœ‰çš„å­å¯¹è±¡ä¹Ÿè¢«é€’å½’åœ°æ£€æŸ¥ã€‚ä» root å¼€å§‹çš„æ‰€æœ‰å¯¹è±¡å¦‚æœæ˜¯å¯è¾¾çš„ï¼Œå®ƒå°±ä¸è¢«å½“ä½œåƒåœ¾ã€‚</p></li><li><p>3ã€æ‰€æœ‰æœªè¢«æ ‡è®°çš„å†…å­˜ä¼šè¢«å½“åšåƒåœ¾ï¼Œæ”¶é›†å™¨ç°åœ¨å¯ä»¥é‡Šæ”¾å†…å­˜ï¼Œå½’è¿˜ç»™æ“ä½œç³»ç»Ÿäº†ã€‚</p></li></ul><p>ç°ä»£çš„åƒåœ¾å›æ”¶å™¨æ”¹è‰¯äº†ç®—æ³•ï¼Œä½†æ˜¯æœ¬è´¨æ˜¯ç›¸åŒçš„ï¼šå¯è¾¾å†…å­˜è¢«æ ‡è®°ï¼Œå…¶ä½™çš„è¢«å½“ä½œåƒåœ¾å›æ”¶ã€‚</p><h2 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h2><p>å¯¹äºæŒç»­è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼Œå¿…é¡»åŠæ—¶é‡Šæ”¾ä¸å†ç”¨åˆ°çš„å†…å­˜ã€‚å¦åˆ™ï¼Œå†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œè½»åˆ™å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œé‡åˆ™å¯¼è‡´è¿›ç¨‹å´©æºƒã€‚ å¯¹äºä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰</p><h3 id="å†…å­˜æ³„æ¼è¯†åˆ«æ–¹æ³•"><a href="#å†…å­˜æ³„æ¼è¯†åˆ«æ–¹æ³•" class="headerlink" title="å†…å­˜æ³„æ¼è¯†åˆ«æ–¹æ³•"></a>å†…å­˜æ³„æ¼è¯†åˆ«æ–¹æ³•</h3><h4 id="æµè§ˆå™¨æ–¹æ³•"><a href="#æµè§ˆå™¨æ–¹æ³•" class="headerlink" title="æµè§ˆå™¨æ–¹æ³•"></a>æµè§ˆå™¨æ–¹æ³•</h4><p>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œé€‰æ‹© Memory<br>åœ¨å³ä¾§çš„Select profiling typeå­—æ®µé‡Œé¢å‹¾é€‰ timeline<br>ç‚¹å‡»å·¦ä¸Šè§’çš„å½•åˆ¶æŒ‰é’®ã€‚<br>åœ¨é¡µé¢ä¸Šè¿›è¡Œå„ç§æ“ä½œï¼Œæ¨¡æ‹Ÿç”¨æˆ·çš„ä½¿ç”¨æƒ…å†µã€‚<br>ä¸€æ®µæ—¶é—´åï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ stop æŒ‰é’®ï¼Œé¢æ¿ä¸Šå°±ä¼šæ˜¾ç¤ºè¿™æ®µæ—¶é—´çš„å†…å­˜å ç”¨æƒ…å†µã€‚</p><h4 id="å‘½ä»¤è¡Œæ–¹æ³•"><a href="#å‘½ä»¤è¡Œæ–¹æ³•" class="headerlink" title="å‘½ä»¤è¡Œæ–¹æ³•"></a>å‘½ä»¤è¡Œæ–¹æ³•</h4><p>ä½¿ç”¨ Node æä¾›çš„ process.memoryUsage æ–¹æ³•ã€‚</p><pre><code>console.log(process.memoryUsage());// è¾“å‡º{   rss: 27709440,        // resident set sizeï¼Œæ‰€æœ‰å†…å­˜å ç”¨ï¼ŒåŒ…æ‹¬æŒ‡ä»¤åŒºå’Œå †æ ˆ  heapTotal: 5685248,   // &quot;å †&quot;å ç”¨çš„å†…å­˜ï¼ŒåŒ…æ‹¬ç”¨åˆ°çš„å’Œæ²¡ç”¨åˆ°çš„  heapUsed: 3449392,    // ç”¨åˆ°çš„å †çš„éƒ¨åˆ†  external: 8772         // V8 å¼•æ“å†…éƒ¨çš„ C++ å¯¹è±¡å ç”¨çš„å†…å­˜}</code></pre><p>åˆ¤æ–­å†…å­˜æ³„æ¼ï¼Œä»¥heapUsedå­—æ®µä¸ºå‡†ã€‚</p><h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h3><p>ES6 æ–°å‡ºçš„ä¸¤ç§æ•°æ®ç»“æ„ï¼š<code>WeakSet</code> å’Œ <code>WeakMap</code>ï¼Œè¡¨ç¤ºè¿™æ˜¯å¼±å¼•ç”¨ï¼Œå®ƒä»¬å¯¹äºå€¼çš„å¼•ç”¨éƒ½æ˜¯ä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶çš„ã€‚</p><pre><code>const wm = new WeakMap();const element = document.getElementById(&#39;example&#39;);wm.set(element, &#39;some information&#39;);wm.get(element) // &quot;some information&quot;</code></pre><p>å…ˆæ–°å»ºä¸€ä¸ª Weakmap å®ä¾‹ï¼Œç„¶åå°†ä¸€ä¸ª DOM èŠ‚ç‚¹ä½œä¸ºé”®åå­˜å…¥è¯¥å®ä¾‹ï¼Œå¹¶å°†ä¸€äº›é™„åŠ ä¿¡æ¯ä½œä¸ºé”®å€¼ï¼Œä¸€èµ·å­˜æ”¾åœ¨ WeakMap é‡Œé¢ã€‚è¿™æ—¶ï¼ŒWeakMap é‡Œé¢å¯¹elementçš„å¼•ç”¨å°±æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šè¢«è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p><h3 id="å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼"><a href="#å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼" class="headerlink" title="å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼"></a>å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼</h3><h4 id="æ„å¤–çš„å…¨å±€å˜é‡"><a href="#æ„å¤–çš„å…¨å±€å˜é‡" class="headerlink" title="æ„å¤–çš„å…¨å±€å˜é‡"></a>æ„å¤–çš„å…¨å±€å˜é‡</h4><p>æœªå®šä¹‰çš„å˜é‡ä¼šåœ¨å…¨å±€å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°å˜é‡ï¼Œå¦‚ä¸‹ã€‚</p><pre><code>function foo(arg) {    bar = &quot;this is a hidden global variable&quot;;}å‡½æ•° foo å†…éƒ¨å¿˜è®°ä½¿ç”¨ var ï¼Œå®é™…ä¸ŠJSä¼šæŠŠbaræŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ä¸Šï¼Œæ„å¤–åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡ã€‚function foo(arg) {    window.bar = &quot;this is an explicit global variable&quot;;}å¦ä¸€ä¸ªæ„å¤–çš„å…¨å±€å˜é‡å¯èƒ½ç”± this åˆ›å»ºã€‚function foo() {    this.variable = &quot;potential accidental global&quot;;}// Foo è°ƒç”¨è‡ªå·±ï¼Œthis æŒ‡å‘äº†å…¨å±€å¯¹è±¡ï¼ˆwindowï¼‰// è€Œä¸æ˜¯ undefinedfoo();</code></pre><p>è§£å†³æ–¹æ³•ï¼šåœ¨ JavaScript æ–‡ä»¶å¤´éƒ¨åŠ ä¸Š â€˜use strictâ€™ï¼Œä½¿ç”¨ä¸¥æ ¼æ¨¡å¼é¿å…æ„å¤–çš„å…¨å±€å˜é‡ï¼Œæ­¤æ—¶ä¸Šä¾‹ä¸­çš„thisæŒ‡å‘undefinedã€‚å¦‚æœå¿…é¡»ä½¿ç”¨å…¨å±€å˜é‡å­˜å‚¨å¤§é‡æ•°æ®æ—¶ï¼Œç¡®ä¿ç”¨å®Œä»¥åæŠŠå®ƒè®¾ç½®ä¸º null æˆ–è€…é‡æ–°å®šä¹‰ã€‚</p><h4 id="è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°"><a href="#è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°" class="headerlink" title="è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°"></a>è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°</h4><p>è®¡æ—¶å™¨setIntervalä»£ç å¾ˆå¸¸è§</p><pre><code>var someResource = getData();setInterval(function() {    var node = document.getElementById(&#39;Node&#39;);    if(node) {        // å¤„ç† node å’Œ someResource        node.innerHTML = JSON.stringify(someResource));    }}, 1000);</code></pre><p>ä¸Šé¢çš„ä¾‹å­è¡¨æ˜ï¼Œåœ¨èŠ‚ç‚¹nodeæˆ–è€…æ•°æ®ä¸å†éœ€è¦æ—¶ï¼Œå®šæ—¶å™¨ä¾æ—§æŒ‡å‘è¿™äº›æ•°æ®ã€‚æ‰€ä»¥å“ªæ€•å½“nodeèŠ‚ç‚¹è¢«ç§»é™¤åï¼Œinterval ä»æ—§å­˜æ´»å¹¶ä¸”åƒåœ¾å›æ”¶å™¨æ²¡åŠæ³•å›æ”¶ï¼Œå®ƒçš„ä¾èµ–ä¹Ÿæ²¡åŠæ³•è¢«å›æ”¶ï¼Œé™¤éç»ˆæ­¢å®šæ—¶å™¨ã€‚</p><pre><code>var element = document.getElementById(&#39;button&#39;);function onClick(event) {    element.innerHTML = &#39;text&#39;;}element.addEventListener(&#39;click&#39;, onClick);</code></pre><p>å¯¹äºä¸Šé¢è§‚å¯Ÿè€…çš„ä¾‹å­ï¼Œä¸€æ—¦å®ƒä»¬ä¸å†éœ€è¦ï¼ˆæˆ–è€…å…³è”çš„å¯¹è±¡å˜æˆä¸å¯è¾¾ï¼‰ï¼Œæ˜ç¡®åœ°ç§»é™¤å®ƒä»¬éå¸¸é‡è¦ã€‚è€çš„ IE 6 æ˜¯æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„ã€‚å› ä¸ºè€ç‰ˆæœ¬çš„ IE æ˜¯æ— æ³•æ£€æµ‹ DOM èŠ‚ç‚¹ä¸ JavaScript ä»£ç ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚<br>ä½†æ˜¯ï¼Œç°ä»£çš„æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ IE å’Œ Microsoft Edgeï¼‰ä½¿ç”¨äº†æ›´å…ˆè¿›çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆæ ‡è®°æ¸…é™¤ï¼‰ï¼Œå·²ç»å¯ä»¥æ­£ç¡®æ£€æµ‹å’Œå¤„ç†å¾ªç¯å¼•ç”¨äº†ã€‚å³å›æ”¶èŠ‚ç‚¹å†…å­˜æ—¶ï¼Œä¸å¿…éè¦è°ƒç”¨<code>removeEventListener</code>äº†ã€‚</p><h4 id="è„±ç¦»-DOM-çš„å¼•ç”¨"><a href="#è„±ç¦»-DOM-çš„å¼•ç”¨" class="headerlink" title="è„±ç¦» DOM çš„å¼•ç”¨"></a>è„±ç¦» DOM çš„å¼•ç”¨</h4><p>å¦‚æœæŠŠDOM å­˜æˆå­—å…¸ï¼ˆJSON é”®å€¼å¯¹ï¼‰æˆ–è€…æ•°ç»„ï¼Œæ­¤æ—¶ï¼ŒåŒæ ·çš„ DOM å…ƒç´ å­˜åœ¨ä¸¤ä¸ªå¼•ç”¨ï¼šä¸€ä¸ªåœ¨ DOMæ ‘ä¸­ï¼Œå¦ä¸€ä¸ªåœ¨å­—å…¸ä¸­ã€‚é‚£ä¹ˆå°†æ¥éœ€è¦æŠŠä¸¤ä¸ªå¼•ç”¨éƒ½æ¸…é™¤ã€‚</p><pre><code>var elements = {    button: document.getElementById(&#39;button&#39;),    image: document.getElementById(&#39;image&#39;),    text: document.getElementById(&#39;text&#39;)};function doStuff() {    image.src = &#39;http://some.url/image&#39;;    button.click();    console.log(text.innerHTML);    // æ›´å¤šé€»è¾‘}function removeButton() {    // æŒ‰é’®æ˜¯ body çš„åä»£å…ƒç´     document.body.removeChild(document.getElementById(&#39;button&#39;));    // æ­¤æ—¶ï¼Œä»æ—§å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ #button çš„å¼•ç”¨    // elements å­—å…¸ã€‚button å…ƒç´ ä»æ—§åœ¨å†…å­˜ä¸­ï¼Œä¸èƒ½è¢« GC å›æ”¶ã€‚}</code></pre><p>å¦‚æœä»£ç ä¸­ä¿å­˜äº†è¡¨æ ¼æŸä¸€ä¸ª<code>&lt;td&gt;</code> çš„å¼•ç”¨ã€‚å°†æ¥å†³å®šåˆ é™¤æ•´ä¸ªè¡¨æ ¼çš„æ—¶å€™ï¼Œç›´è§‰è®¤ä¸º GC ä¼šå›æ”¶é™¤äº†å·²ä¿å­˜çš„<code>&lt;td&gt;</code>ä»¥å¤–çš„å…¶å®ƒèŠ‚ç‚¹ã€‚å®é™…æƒ…å†µå¹¶éå¦‚æ­¤ï¼šæ­¤ <code>&lt;td&gt;</code> æ˜¯è¡¨æ ¼çš„å­èŠ‚ç‚¹ï¼Œå­å…ƒç´ ä¸çˆ¶å…ƒç´ æ˜¯å¼•ç”¨å…³ç³»ã€‚ç”±äºä»£ç ä¿ç•™äº†<code>&lt;td&gt;</code> çš„å¼•ç”¨ï¼Œå¯¼è‡´æ•´ä¸ªè¡¨æ ¼ä»å¾…åœ¨å†…å­˜ä¸­ã€‚æ‰€ä»¥ä¿å­˜ DOM å…ƒç´ å¼•ç”¨çš„æ—¶å€™ï¼Œè¦å°å¿ƒè°¨æ…ã€‚</p><h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>é—­åŒ…çš„å…³é”®æ˜¯åŒ¿åå‡½æ•°å¯ä»¥è®¿é—®çˆ¶çº§ä½œç”¨åŸŸçš„å˜é‡ã€‚</p><pre><code>var theThing = null;var replaceThing = function () {  var originalThing = theThing;  var unused = function () {    if (originalThing)      console.log(&quot;hi&quot;);  };  theThing = {    longStr: new Array(1000000).join(&#39;*&#39;),    someMethod: function () {      console.log(someMessage);    }  };};setInterval(replaceThing, 1000);</code></pre><p>æ¯æ¬¡è°ƒç”¨ replaceThing ï¼ŒtheThing å¾—åˆ°ä¸€ä¸ªåŒ…å«ä¸€ä¸ªå¤§æ•°ç»„å’Œä¸€ä¸ªæ–°é—­åŒ…ï¼ˆsomeMethodï¼‰çš„æ–°å¯¹è±¡ã€‚åŒæ—¶ï¼Œå˜é‡ unused æ˜¯ä¸€ä¸ªå¼•ç”¨ originalThing çš„é—­åŒ…ï¼ˆå…ˆå‰çš„ replaceThing åˆè°ƒç”¨äº† theThing ï¼‰ã€‚someMethod å¯ä»¥é€šè¿‡ theThing ä½¿ç”¨ï¼ŒsomeMethod ä¸ unused åˆ†äº«é—­åŒ…ä½œç”¨åŸŸï¼Œå°½ç®¡ unused ä»æœªä½¿ç”¨ï¼Œå®ƒå¼•ç”¨çš„ originalThing è¿«ä½¿å®ƒä¿ç•™åœ¨å†…å­˜ä¸­ï¼ˆé˜²æ­¢è¢«å›æ”¶ï¼‰ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šåœ¨ replaceThing çš„æœ€åæ·»åŠ  originalThing = null ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‰§è¡Œæ ˆ </tag>
            
            <tag> å†…å­˜ </tag>
            
            <tag> æå‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„</title>
      <link href="/2019/09/28/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2019/09/28/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h2 id="çº¿æ€§ç»“æ„"><a href="#çº¿æ€§ç»“æ„" class="headerlink" title="çº¿æ€§ç»“æ„"></a>çº¿æ€§ç»“æ„</h2><h3 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h3><p>æ ˆæ˜¯ä¸€ç§éµä»<strong>å…ˆè¿›åå‡º (LIFO)</strong> åŸåˆ™çš„æœ‰åºé›†åˆï¼›æ–°æ·»åŠ çš„æˆ–å¾…åˆ é™¤çš„å…ƒç´ éƒ½ä¿å­˜åœ¨æ ˆçš„æœ«å°¾ï¼Œç§°ä½œæ ˆé¡¶ï¼Œå¦ä¸€ç«¯ä¸ºæ ˆåº•ã€‚åœ¨æ ˆé‡Œï¼Œæ–°å…ƒç´ éƒ½é è¿‘æ ˆé¡¶ï¼Œæ—§å…ƒç´ éƒ½æ¥è¿‘æ ˆåº•ã€‚</p><pre><code>class Stack {    constructor() {        this.items = []    }    // å…¥æ ˆ    push(element) {         this.items.push(element)    }    // å‡ºæ ˆ    pop() {        return this.items.pop()    }    // æœ«ä½    get peek() {        return this.items[this.items.length - 1]    }    // æ˜¯å¦ä¸ºç©ºæ ˆ    get isEmpty() {        return !this.items.length    }    // å°ºå¯¸    get size() {        return this.items.length    }    // æ¸…ç©ºæ ˆ    clear() {        this.items = []    }    // æ‰“å°æ ˆæ•°æ®    print() {        console.log(this.items.toString())    }}</code></pre><p>ä½¿ç”¨æ ˆç±»ï¼š</p><pre><code>// å®ä¾‹åŒ–ä¸€ä¸ªæ ˆconst stack = new Stack()console.log(stack.isEmpty) // true// æ·»åŠ å…ƒç´ stack.push(5)stack.push(8)// è¯»å–å±æ€§å†æ·»åŠ console.log(stack.peek) // 8stack.push(11)console.log(stack.size) // 3console.log(stack.isEmpty) // false</code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è°ƒç”¨æ ˆ</title>
      <link href="/2019/09/28/%E8%B0%83%E7%94%A8%E6%A0%88/"/>
      <url>/2019/09/28/%E8%B0%83%E7%94%A8%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<p>è¿™æœŸå®Œå…¨å¤åˆ»æœ¨æ˜“è€å¸ˆçš„åšå®¢ï¼Œå› ä¸ºå†™çš„å¾ˆå¥½ æˆ‘è¿™é‡Œåªæ˜¯è‡ªå·±å¤ä¹ ï¼Œæ²¡æœ‰å•†ç”¨</p><p><a href="https://github.com/yygmind/blog" target="_blank" rel="noopener">æœ¨æ˜“è€å¸ˆåšå®¢åœ°å€</a></p><h1 id="æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡"></a>æ‰§è¡Œä¸Šä¸‹æ–‡</h1><p><strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>æ€»å…±æœ‰ä¸‰ç§ç±»å‹ï¼š</p><p><strong>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šåªæœ‰ä¸€ä¸ªï¼Œæµè§ˆå™¨ä¸­çš„å…¨å±€å¯¹è±¡å°±æ˜¯ <code>window</code> å¯¹è±¡ï¼Œthis æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚</p><p><strong>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šå­˜åœ¨æ— æ•°ä¸ªï¼Œåªæœ‰åœ¨å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™æ‰ä¼šè¢«åˆ›å»ºï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p><strong>Eval å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼š æŒ‡çš„æ˜¯è¿è¡Œåœ¨ <code>eval</code> å‡½æ•°ä¸­çš„ä»£ç ï¼Œå¾ˆå°‘ç”¨è€Œä¸”ä¸å»ºè®®ä½¿ç”¨ã€‚</p><h2 id="æ‰§è¡Œæ ˆ"><a href="#æ‰§è¡Œæ ˆ" class="headerlink" title="æ‰§è¡Œæ ˆ"></a>æ‰§è¡Œæ ˆ</h2><p>æ‰§è¡Œæ ˆï¼Œä¹Ÿå«è°ƒç”¨æ ˆï¼Œå…·æœ‰ <strong>LIFO</strong>ï¼ˆåè¿›å…ˆå‡ºï¼‰ç»“æ„ï¼Œç”¨äºå­˜å‚¨åœ¨ä»£ç æ‰§è¡ŒæœŸé—´åˆ›å»ºçš„æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p>é¦–æ¬¡è¿è¡ŒJSä»£ç æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª<strong>å…¨å±€</strong>æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶Pushåˆ°å½“å‰çš„æ‰§è¡Œæ ˆä¸­ã€‚æ¯å½“å‘ç”Ÿå‡½æ•°è°ƒç”¨ï¼Œå¼•æ“éƒ½ä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶Pushåˆ°å½“å‰æ‰§è¡Œæ ˆçš„æ ˆé¡¶ã€‚</p><p>æ ¹æ®æ‰§è¡Œæ ˆ<strong>LIFO</strong>è§„åˆ™ï¼Œå½“æ ˆé¡¶å‡½æ•°è¿è¡Œå®Œæˆåï¼Œå…¶å¯¹åº”çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å°†ä¼šä»æ‰§è¡Œæ ˆä¸­<strong>Pop</strong>å‡ºï¼Œä¸Šä¸‹æ–‡æ§åˆ¶æƒå°†ç§»åˆ°å½“å‰æ‰§è¡Œæ ˆçš„ä¸‹ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><pre><code>function first() {    console.log(&#39;Inside first function&#39;);    second();    console.log(&#39;Again inside first function&#39;);  }function second() {    console.log(&#39;Inside second function&#39;);  }first();  console.log(&#39;Inside Global Execution Context&#39;);// Inside first function// Inside second function// Again inside first function// Inside Global Execution Context</code></pre><p><img src="https://user-gold-cdn.xitu.io/2019/8/22/16cb80e4579be263?w=1280&h=228&f=webp&s=13834" alt></p><h2 id="æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º"></a>æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º</h2><p>æ‰§è¡Œä¸Šä¸‹æ–‡åˆ†ä¸¤ä¸ªé˜¶æ®µåˆ›å»ºï¼š<strong>1ï¼‰åˆ›å»ºé˜¶æ®µï¼› 2ï¼‰æ‰§è¡Œé˜¶æ®µ</strong></p><p><strong>åˆ›å»ºé˜¶æ®µ</strong></p><p>1ã€ç¡®å®š <code>this</code> çš„å€¼ï¼Œä¹Ÿè¢«ç§°ä¸º <strong>This Binding</strong>ã€‚</p><p>2ã€<strong>LexicalEnvironmentï¼ˆè¯æ³•ç¯å¢ƒï¼‰</strong> ç»„ä»¶è¢«åˆ›å»ºã€‚</p><p>3ã€<strong>VariableEnvironmentï¼ˆå˜é‡ç¯å¢ƒï¼‰</strong> ç»„ä»¶è¢«åˆ›å»ºã€‚<br>ç›´æ¥çœ‹ä¼ªä»£ç å¯èƒ½æ›´åŠ ç›´è§‚</p><pre><code>ExecutionContext = {    ThisBinding = &lt;this value&gt;,     // ç¡®å®šthis   LexicalEnvironment = { ... },   // è¯æ³•ç¯å¢ƒ  VariableEnvironment = { ... },  // å˜é‡ç¯å¢ƒ}</code></pre><h3 id="This-Binding"><a href="#This-Binding" class="headerlink" title="This Binding"></a>This Binding</h3><p>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>this</code> çš„å€¼æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­<code>this</code> çš„å€¼æŒ‡å‘ <code>window</code> å¯¹è±¡ï¼Œè€Œåœ¨nodejsä¸­æŒ‡å‘è¿™ä¸ªæ–‡ä»¶çš„<code>module</code>å¯¹è±¡ã€‚</p><p>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>this</code> çš„å€¼å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚å…·ä½“æœ‰ï¼šé»˜è®¤ç»‘å®šã€éšå¼ç»‘å®šã€æ˜¾å¼ç»‘å®šï¼ˆç¡¬ç»‘å®šï¼‰ã€newç»‘å®šã€ç®­å¤´å‡½æ•°.</p><h3 id="è¯æ³•ç¯å¢ƒï¼ˆLexical-Environmentï¼‰"><a href="#è¯æ³•ç¯å¢ƒï¼ˆLexical-Environmentï¼‰" class="headerlink" title="è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰"></a>è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰</h3><p>è¯æ³•ç¯å¢ƒæœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†</p><ul><li><p>1ã€ç¯å¢ƒè®°å½•ï¼šå­˜å‚¨å˜é‡å’Œå‡½æ•°å£°æ˜çš„å®é™…ä½ç½®</p></li><li><p>2ã€å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨ï¼šå¯ä»¥è®¿é—®å…¶å¤–éƒ¨è¯æ³•ç¯å¢ƒ</p></li></ul><p>è¯æ³•ç¯å¢ƒæœ‰ä¸¤ç§ç±»å‹</p><ul><li><p>1ã€å…¨å±€ç¯å¢ƒï¼šæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤–éƒ¨ç¯å¢ƒçš„è¯æ³•ç¯å¢ƒï¼Œå…¶å¤–éƒ¨ç¯å¢ƒå¼•ç”¨ä¸º nullã€‚æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆwindow å¯¹è±¡ï¼‰åŠå…¶å…³è”çš„æ–¹æ³•å’Œå±æ€§ï¼ˆä¾‹å¦‚æ•°ç»„æ–¹æ³•ï¼‰ä»¥åŠä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„å…¨å±€å˜é‡ï¼Œthis çš„å€¼æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚</p></li><li><p>2ã€å‡½æ•°ç¯å¢ƒï¼šç”¨æˆ·åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡è¢«å­˜å‚¨åœ¨ç¯å¢ƒè®°å½•ä¸­ï¼ŒåŒ…å«äº†arguments å¯¹è±¡ã€‚å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨å¯ä»¥æ˜¯å…¨å±€ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å†…éƒ¨å‡½æ•°çš„å¤–éƒ¨å‡½æ•°ç¯å¢ƒã€‚</p></li></ul><p>ç›´æ¥çœ‹ä¼ªä»£ç å¯èƒ½æ›´åŠ ç›´è§‚</p><pre><code>GlobalExectionContext = {  // å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡  LexicalEnvironment: {          // è¯æ³•ç¯å¢ƒ    EnvironmentRecord: {           // ç¯å¢ƒè®°å½•      Type: &quot;Object&quot;,                 // å…¨å±€ç¯å¢ƒ      // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ       outer: &lt;null&gt;                    // å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨  }  }FunctionExectionContext = { // å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡  LexicalEnvironment: {        // è¯æ³•ç¯å¢ƒ    EnvironmentRecord: {          // ç¯å¢ƒè®°å½•      Type: &quot;Declarative&quot;,         // å‡½æ•°ç¯å¢ƒ      // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ               // å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨      outer: &lt;Global or outer function environment reference&gt;    }  }</code></pre><h3 id="å˜é‡ç¯å¢ƒ"><a href="#å˜é‡ç¯å¢ƒ" class="headerlink" title="å˜é‡ç¯å¢ƒ"></a>å˜é‡ç¯å¢ƒ</h3><p>å˜é‡ç¯å¢ƒä¹Ÿæ˜¯ä¸€ä¸ªè¯æ³•ç¯å¢ƒï¼Œå› æ­¤å®ƒå…·æœ‰ä¸Šé¢å®šä¹‰çš„è¯æ³•ç¯å¢ƒçš„æ‰€æœ‰å±æ€§ã€‚</p><p>åœ¨ ES6 ä¸­ï¼Œè¯æ³• ç¯å¢ƒå’Œ å˜é‡ ç¯å¢ƒçš„åŒºåˆ«åœ¨äºå‰è€…ç”¨äºå­˜å‚¨<strong>å‡½æ•°å£°æ˜å’Œå˜é‡</strong>ï¼ˆ let å’Œ const ï¼‰ç»‘å®šï¼Œè€Œåè€…ä»…ç”¨äºå­˜å‚¨<strong>å˜é‡</strong>ï¼ˆ var ï¼‰ç»‘å®šã€‚</p><p>ä½¿ç”¨ä¾‹å­è¿›è¡Œä»‹ç»</p><pre><code>let a = 20;  const b = 30;  var c;function multiply(e, f) {   var g = 20;   return e * f * g;  }c = multiply(20, 30);</code></pre><p>æ‰§è¡Œä¸Šä¸‹æ–‡å¦‚ä¸‹æ‰€ç¤º</p><pre><code>GlobalExectionContext = {  ThisBinding: &lt;Global Object&gt;,  LexicalEnvironment: {      EnvironmentRecord: {        Type: &quot;Object&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        a: &lt; uninitialized &gt;,        b: &lt; uninitialized &gt;,        multiply: &lt; func &gt;      }      outer: &lt;null&gt;    },  VariableEnvironment: {      EnvironmentRecord: {        Type: &quot;Object&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        c: undefined,      }      outer: &lt;null&gt;    }  }FunctionExectionContext = {    ThisBinding: &lt;Global Object&gt;,  LexicalEnvironment: {      EnvironmentRecord: {        Type: &quot;Declarative&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        Arguments: {0: 20, 1: 30, length: 2},      },      outer: &lt;GlobalLexicalEnvironment&gt;    },  VariableEnvironment: {      EnvironmentRecord: {        Type: &quot;Declarative&quot;,        // æ ‡è¯†ç¬¦ç»‘å®šåœ¨è¿™é‡Œ        g: undefined      },      outer: &lt;GlobalLexicalEnvironment&gt;    }  }</code></pre><h2 id="æå‡"><a href="#æå‡" class="headerlink" title="æå‡"></a>æå‡</h2><ul><li><p>1.å˜é‡æå‡</p><pre><code>console.log(num); //undefinedvar num = 1;</code></pre></li><li><p>2.å‡½æ•°æå‡</p><pre><code>foo();  // foo2var foo = function() {  console.log(&#39;foo1&#39;);}foo();  // foo1ï¼Œfooé‡æ–°èµ‹å€¼function foo() {  console.log(&#39;foo2&#39;);}foo(); // foo1</code></pre></li></ul><h2 id="æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ"></a>æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ</h2><p>å› ä¸ºJSå¼•æ“åˆ›å»ºäº†å¾ˆå¤šçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥JSå¼•æ“åˆ›å»ºäº†æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼ˆExecution context stackï¼ŒECSï¼‰æ¥ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><p>æœ‰å¦‚ä¸‹ä¸¤æ®µä»£ç ï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸¤æ®µä»£ç ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><pre><code>var scope = &quot;global scope&quot;;function checkscope(){    var scope = &quot;local scope&quot;;    function f(){        return scope;    }    return f();}checkscope();</code></pre><pre><code>var scope = &quot;global scope&quot;;function checkscope(){    var scope = &quot;local scope&quot;;    function f(){        return scope;    }    return f;}checkscope()();</code></pre><p>ç­”æ¡ˆæ˜¯ æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„å˜åŒ–ä¸ä¸€æ ·ã€‚</p><p>ç¬¬ä¸€æ®µä»£ç ï¼š</p><pre><code>ECStack.push(&lt;checkscope&gt; functionContext);ECStack.push(&lt;f&gt; functionContext);ECStack.pop();ECStack.pop();</code></pre><p>ç¬¬äºŒæ®µä»£ç ï¼š</p><pre><code>ECStack.push(&lt;checkscope&gt; functionContext);ECStack.pop();ECStack.push(&lt;f&gt; functionContext);ECStack.pop();</code></pre><h2 id="å‡½æ•°ä¸Šä¸‹æ–‡"><a href="#å‡½æ•°ä¸Šä¸‹æ–‡" class="headerlink" title="å‡½æ•°ä¸Šä¸‹æ–‡"></a>å‡½æ•°ä¸Šä¸‹æ–‡</h2><p>åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼Œç”¨æ´»åŠ¨å¯¹è±¡(activation object, AO)æ¥è¡¨ç¤ºå˜é‡å¯¹è±¡ã€‚</p><p><strong>æ´»åŠ¨å¯¹è±¡å’Œå˜é‡å¯¹è±¡</strong>çš„åŒºåˆ«åœ¨äº</p><ul><li>1ã€å˜é‡å¯¹è±¡ï¼ˆVOï¼‰æ˜¯è§„èŒƒä¸Šæˆ–è€…æ˜¯JSå¼•æ“ä¸Šå®ç°çš„ï¼Œå¹¶ä¸èƒ½åœ¨JSç¯å¢ƒä¸­ç›´æ¥è®¿é—®ã€‚</li><li>2ã€å½“è¿›å…¥åˆ°ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡åï¼Œè¿™ä¸ªå˜é‡å¯¹è±¡æ‰ä¼šè¢«æ¿€æ´»ï¼Œæ‰€ä»¥å«æ´»åŠ¨å¯¹è±¡ï¼ˆAOï¼‰ï¼Œè¿™æ—¶å€™æ´»åŠ¨å¯¹è±¡ä¸Šçš„å„ç§å±æ€§æ‰èƒ½è¢«è®¿é—®ã€‚<br>è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªArgumentså¯¹è±¡ï¼Œå¹¶è‡ªåŠ¨åˆå§‹åŒ–å±€éƒ¨å˜é‡argumentsï¼ŒæŒ‡ä»£è¯¥Argumentså¯¹è±¡ã€‚æ‰€æœ‰ä½œä¸ºå‚æ•°ä¼ å…¥çš„å€¼éƒ½ä¼šæˆä¸ºArgumentså¯¹è±¡çš„æ•°ç»„å…ƒç´ ã€‚</li></ul><p>æ‰§è¡Œè¿‡ç¨‹<br>æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä»£ç ä¼šåˆ†æˆä¸¤ä¸ªé˜¶æ®µè¿›è¡Œå¤„ç†</p><ul><li><p>1ã€è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡</p></li><li><p>2ã€ä»£ç æ‰§è¡Œ</p></li></ul><p>è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡<br>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰æ‰§è¡Œä»£ç </p><p>æ­¤æ—¶çš„å˜é‡å¯¹è±¡ä¼šåŒ…æ‹¬ï¼ˆå¦‚ä¸‹é¡ºåºåˆå§‹åŒ–ï¼‰ï¼š</p><ul><li><p>1ã€å‡½æ•°çš„æ‰€æœ‰å½¢å‚ (onlyå‡½æ•°ä¸Šä¸‹æ–‡)ï¼šæ²¡æœ‰å®å‚ï¼Œå±æ€§å€¼è®¾ä¸ºundefinedã€‚</p></li><li><p>2ã€å‡½æ•°å£°æ˜ï¼šå¦‚æœå˜é‡å¯¹è±¡å·²ç»å­˜åœ¨ç›¸åŒåç§°çš„å±æ€§ï¼Œåˆ™å®Œå…¨æ›¿æ¢è¿™ä¸ªå±æ€§ã€‚</p></li><li><p>3ã€å˜é‡å£°æ˜ï¼šå¦‚æœå˜é‡åç§°è·Ÿå·²ç»å£°æ˜çš„å½¢å‚æˆ–å‡½æ•°ç›¸åŒï¼Œåˆ™å˜é‡å£°æ˜ä¸ä¼šå¹²æ‰°å·²ç»å­˜åœ¨çš„è¿™ç±»å±æ€§ã€‚<br>ä¸Šä»£ç å°±ç›´è§‚äº†</p><pre><code>function foo(a) {var b = 2;function c() {}var d = function() {};b = 3;}foo(1);</code></pre><p>å¯¹äºä¸Šé¢çš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™çš„AOæ˜¯</p><pre><code>AO = {  arguments: {      0: 1,      length: 1  },  a: 1,  b: undefined,  c: reference to function c(){},  d: undefined}</code></pre><p>å½¢å‚argumentsè¿™æ—¶å€™å·²ç»æœ‰èµ‹å€¼äº†ï¼Œä½†æ˜¯å˜é‡è¿˜æ˜¯undefinedï¼Œåªæ˜¯åˆå§‹åŒ–çš„å€¼</p></li></ul><p>ä»£ç æ‰§è¡Œ<br>è¿™ä¸ªé˜¶æ®µä¼šé¡ºåºæ‰§è¡Œä»£ç ï¼Œä¿®æ”¹å˜é‡å¯¹è±¡çš„å€¼ï¼Œæ‰§è¡Œå®ŒæˆåAOå¦‚ä¸‹</p><pre><code>AO = {    arguments: {        0: 1,        length: 1    },    a: 1,    b: 3,    c: reference to function c(){},    d: reference to FunctionExpression &quot;d&quot;}</code></pre><p>æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li><p>1ã€å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡åˆå§‹åŒ–æ˜¯å…¨å±€å¯¹è±¡</p></li><li><p>2ã€å‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡åˆå§‹åŒ–åªåŒ…æ‹¬ Arguments å¯¹è±¡</p></li><li><p>3ã€åœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ä¼šç»™å˜é‡å¯¹è±¡æ·»åŠ å½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜ç­‰åˆå§‹çš„å±æ€§å€¼</p></li><li><p>4ã€åœ¨ä»£ç æ‰§è¡Œé˜¶æ®µï¼Œä¼šå†æ¬¡ä¿®æ”¹å˜é‡å¯¹è±¡çš„å±æ€§å€¼</p></li></ul><h2 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h2><ul><li>1.åŸºæœ¬ç±»å‹ï¼šâ€“&gt; æ ˆå†…å­˜ï¼ˆä¸åŒ…å«é—­åŒ…ä¸­çš„å˜é‡ï¼‰</li><li>2.å¼•ç”¨ç±»å‹ï¼šâ€“&gt; å †å†…å­˜</li></ul><p><strong>å†…å­˜å›æ”¶</strong></p><p>JavaScriptæœ‰è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæ¯éš”ä¸€æ®µæ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡é‡Šæ”¾æ“ä½œï¼Œæ‰¾å‡ºé‚£äº›ä¸å†ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Œç„¶åé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ã€‚</p><p><strong>å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡çš„é”€æ¯</strong></p><ul><li>å±€éƒ¨å˜é‡ï¼šå±€éƒ¨ä½œç”¨åŸŸä¸­ï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå±€éƒ¨å˜é‡ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œå› æ­¤åƒåœ¾æ”¶é›†å™¨å¾ˆå®¹æ˜“åšå‡ºåˆ¤æ–­å¹¶å›æ”¶ã€‚</li><li>å…¨å±€å˜é‡ï¼šå…¨å±€å˜é‡ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªåŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´åˆ™å¾ˆéš¾åˆ¤æ–­ï¼Œæ‰€ä»¥åœ¨å¼€å‘ä¸­å°½é‡é¿å…ä½¿ç”¨å…¨å±€å˜é‡ã€‚</li></ul><p>ä»¥Googleçš„V8å¼•æ“ä¸ºä¾‹ï¼ŒV8å¼•æ“ä¸­æ‰€æœ‰çš„JSå¯¹è±¡éƒ½æ˜¯é€šè¿‡<strong>å †</strong>æ¥è¿›è¡Œå†…å­˜åˆ†é…çš„</p><ul><li>åˆå§‹åˆ†é…ï¼šå½“å£°æ˜å˜é‡å¹¶èµ‹å€¼æ—¶ï¼ŒV8å¼•æ“å°±ä¼šåœ¨å †å†…å­˜ä¸­åˆ†é…ç»™è¿™ä¸ªå˜é‡ã€‚</li><li>ç»§ç»­ç”³è¯·ï¼šå½“å·²ç”³è¯·çš„å†…å­˜ä¸è¶³ä»¥å­˜å‚¨è¿™ä¸ªå˜é‡æ—¶ï¼ŒV8å¼•æ“å°±ä¼šç»§ç»­ç”³è¯·å†…å­˜ï¼Œç›´åˆ°å †çš„å¤§å°è¾¾åˆ°äº†V8å¼•æ“çš„å†…å­˜ä¸Šé™ä¸ºæ­¢ã€‚</li></ul><p>V8å¼•æ“å¯¹å †å†…å­˜ä¸­çš„JSå¯¹è±¡è¿›è¡Œåˆ†ä»£ç®¡ç†</p><ul><li>æ–°ç”Ÿä»£ï¼šå­˜æ´»å‘¨æœŸè¾ƒçŸ­çš„JSå¯¹è±¡ï¼Œå¦‚ä¸´æ—¶å˜é‡ã€å­—ç¬¦ä¸²ç­‰ã€‚</li><li>è€ç”Ÿä»£ï¼šç»è¿‡å¤šæ¬¡åƒåœ¾å›æ”¶ä»ç„¶å­˜æ´»ï¼Œå­˜æ´»å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼Œå¦‚ä¸»æ§åˆ¶å™¨ã€æœåŠ¡å™¨å¯¹è±¡ç­‰ã€‚</li></ul><h3 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h3><p>å¯¹åƒåœ¾å›æ”¶ç®—æ³•æ¥è¯´ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯å¦‚ä½•åˆ¤æ–­å†…å­˜å·²ç»ä¸å†ä½¿ç”¨ï¼Œå¸¸ç”¨åƒåœ¾å›æ”¶ç®—æ³•æœ‰ä¸‹é¢ä¸¤ç§ã€‚</p><ul><li>1.å¼•ç”¨è®¡æ•°ï¼ˆç°ä»£æµè§ˆå™¨ä¸å†ä½¿ç”¨ï¼‰</li><li>2.æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰</li></ul><h4 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h4><p>å¼•ç”¨è®¡æ•°ç®—æ³•å®šä¹‰â€œå†…å­˜ä¸å†ä½¿ç”¨â€çš„æ ‡å‡†å¾ˆç®€å•ï¼Œå°±æ˜¯çœ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰<strong>æŒ‡å‘å®ƒçš„å¼•ç”¨</strong>ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–å¯¹è±¡æŒ‡å‘å®ƒäº†ï¼Œè¯´æ˜è¯¥å¯¹è±¡å·²ç»ä¸å†éœ€è¦äº†ã€‚</p><pre><code>// åˆ›å»ºä¸€ä¸ªå¯¹è±¡personï¼Œä»–æœ‰ä¸¤ä¸ªæŒ‡å‘å±æ€§ageå’Œnameçš„å¼•ç”¨var person = {    age: 12,    name: &#39;aaaa&#39;};person.name = null; // è™½ç„¶nameè®¾ç½®ä¸ºnullï¼Œä½†å› ä¸ºpersonå¯¹è±¡è¿˜æœ‰æŒ‡å‘nameçš„å¼•ç”¨ï¼Œå› æ­¤nameä¸ä¼šå›æ”¶var p = person; person = 1;         //åŸæ¥çš„personå¯¹è±¡è¢«èµ‹å€¼ä¸º1ï¼Œä½†å› ä¸ºæœ‰æ–°å¼•ç”¨pæŒ‡å‘åŸpersonå¯¹è±¡ï¼Œå› æ­¤å®ƒä¸ä¼šè¢«å›æ”¶p = null;           //åŸpersonå¯¹è±¡å·²ç»æ²¡æœ‰å¼•ç”¨ï¼Œå¾ˆå¿«ä¼šè¢«å›æ”¶</code></pre><p>å¼•ç”¨è®¡æ•°æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯<strong>å¾ªç¯å¼•ç”¨</strong></p><p>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå°½ç®¡ä»–ä»¬å·²ä¸å†ä½¿ç”¨ï¼Œä½†æ˜¯åƒåœ¾å›æ”¶å™¨ä¸ä¼šè¿›è¡Œå›æ”¶ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p><pre><code>function cycle() {    var o1 = {};    var o2 = {};    o1.a = o2;    o2.a = o1;     return &quot;cycle reference!&quot;}cycle();</code></pre><p>cycleå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åï¼Œå¯¹è±¡o1å’Œo2å®é™…ä¸Šå·²ç»ä¸å†éœ€è¦äº†ï¼Œä½†æ ¹æ®å¼•ç”¨è®¡æ•°çš„åŸåˆ™ï¼Œä»–ä»¬ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ä¾ç„¶å­˜åœ¨ï¼Œå› æ­¤è¿™éƒ¨åˆ†å†…å­˜ä¸ä¼šè¢«å›æ”¶ã€‚æ‰€ä»¥ç°ä»£æµè§ˆå™¨ä¸å†ä½¿ç”¨è¿™ä¸ªç®—æ³•ã€‚</p><p>ä½†æ˜¯IEä¾æ—§ä½¿ç”¨ã€‚</p><pre><code>var div = document.createElement(&quot;div&quot;);div.onclick = function() {    console.log(&quot;click&quot;);};</code></pre><p>ä¸Šé¢çš„å†™æ³•å¾ˆå¸¸è§ï¼Œä½†æ˜¯ä¸Šé¢çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚</p><p>å˜é‡divæœ‰äº‹ä»¶å¤„ç†å‡½æ•°çš„å¼•ç”¨ï¼ŒåŒæ—¶äº‹ä»¶å¤„ç†å‡½æ•°ä¹Ÿæœ‰divçš„å¼•ç”¨ï¼Œå› ä¸ºdivå˜é‡å¯åœ¨å‡½æ•°å†…è¢«è®¿é—®ï¼Œæ‰€ä»¥å¾ªç¯å¼•ç”¨å°±å‡ºç°äº†ã€‚</p><h4 id="æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰"><a href="#æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰"></a>æ ‡è®°æ¸…é™¤ï¼ˆå¸¸ç”¨ï¼‰</h4><p>æ ‡è®°æ¸…é™¤ç®—æ³•å°†â€œä¸å†ä½¿ç”¨çš„å¯¹è±¡â€å®šä¹‰ä¸ºâ€œæ— æ³•åˆ°è¾¾çš„å¯¹è±¡â€ã€‚å³ä»æ ¹éƒ¨ï¼ˆåœ¨JSä¸­å°±æ˜¯å…¨å±€å¯¹è±¡ï¼‰å‡ºå‘å®šæ—¶æ‰«æå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå‡¡æ˜¯èƒ½ä»æ ¹éƒ¨åˆ°è¾¾çš„å¯¹è±¡ï¼Œä¿ç•™ã€‚é‚£äº›ä»æ ¹éƒ¨å‡ºå‘æ— æ³•è§¦åŠåˆ°çš„å¯¹è±¡è¢«æ ‡è®°ä¸ºä¸å†ä½¿ç”¨ï¼Œç¨åè¿›è¡Œå›æ”¶ã€‚æ— æ³•è§¦åŠçš„å¯¹è±¡åŒ…å«äº†æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡è¿™ä¸ªæ¦‚å¿µï¼Œä½†åä¹‹æœªå¿…æˆç«‹ã€‚æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å°±å¯ä»¥æ­£ç¡®è¢«åƒåœ¾å›æ”¶å¤„ç†äº†ã€‚</p><p>ç®—æ³•ç”±ä»¥ä¸‹å‡ æ­¥ç»„æˆï¼š</p><ul><li><p>1ã€åƒåœ¾å›æ”¶å™¨åˆ›å»ºäº†ä¸€ä¸ªâ€œrootsâ€åˆ—è¡¨ã€‚roots é€šå¸¸æ˜¯ä»£ç ä¸­å…¨å±€å˜é‡çš„å¼•ç”¨ã€‚JavaScript ä¸­ï¼Œâ€œwindowâ€ å¯¹è±¡æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè¢«å½“ä½œ root ã€‚window å¯¹è±¡æ€»æ˜¯å­˜åœ¨ï¼Œå› æ­¤åƒåœ¾å›æ”¶å™¨å¯ä»¥æ£€æŸ¥å®ƒå’Œå®ƒçš„æ‰€æœ‰å­å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼ˆå³ä¸æ˜¯åƒåœ¾ï¼‰ï¼›</p></li><li><p>2ã€æ‰€æœ‰çš„ roots è¢«æ£€æŸ¥å’Œæ ‡è®°ä¸ºæ¿€æ´»ï¼ˆå³ä¸æ˜¯åƒåœ¾ï¼‰ã€‚æ‰€æœ‰çš„å­å¯¹è±¡ä¹Ÿè¢«é€’å½’åœ°æ£€æŸ¥ã€‚ä» root å¼€å§‹çš„æ‰€æœ‰å¯¹è±¡å¦‚æœæ˜¯å¯è¾¾çš„ï¼Œå®ƒå°±ä¸è¢«å½“ä½œåƒåœ¾ã€‚</p></li><li><p>3ã€æ‰€æœ‰æœªè¢«æ ‡è®°çš„å†…å­˜ä¼šè¢«å½“åšåƒåœ¾ï¼Œæ”¶é›†å™¨ç°åœ¨å¯ä»¥é‡Šæ”¾å†…å­˜ï¼Œå½’è¿˜ç»™æ“ä½œç³»ç»Ÿäº†ã€‚</p></li></ul><p>ç°ä»£çš„åƒåœ¾å›æ”¶å™¨æ”¹è‰¯äº†ç®—æ³•ï¼Œä½†æ˜¯æœ¬è´¨æ˜¯ç›¸åŒçš„ï¼šå¯è¾¾å†…å­˜è¢«æ ‡è®°ï¼Œå…¶ä½™çš„è¢«å½“ä½œåƒåœ¾å›æ”¶ã€‚</p><h2 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h2><p>å¯¹äºæŒç»­è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼Œå¿…é¡»åŠæ—¶é‡Šæ”¾ä¸å†ç”¨åˆ°çš„å†…å­˜ã€‚å¦åˆ™ï¼Œå†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œè½»åˆ™å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œé‡åˆ™å¯¼è‡´è¿›ç¨‹å´©æºƒã€‚ å¯¹äºä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰<br><strong>å†…å­˜æ³„æ¼è¯†åˆ«æ–¹æ³•</strong></p><ul><li>1ã€<strong>æµè§ˆå™¨æ–¹æ³•</strong><br>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œé€‰æ‹© Memory<br>åœ¨å³ä¾§çš„Select profiling typeå­—æ®µé‡Œé¢å‹¾é€‰ timeline<br>ç‚¹å‡»å·¦ä¸Šè§’çš„å½•åˆ¶æŒ‰é’®ã€‚<br>åœ¨é¡µé¢ä¸Šè¿›è¡Œå„ç§æ“ä½œï¼Œæ¨¡æ‹Ÿç”¨æˆ·çš„ä½¿ç”¨æƒ…å†µã€‚<br>ä¸€æ®µæ—¶é—´åï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ stop æŒ‰é’®ï¼Œé¢æ¿ä¸Šå°±ä¼šæ˜¾ç¤ºè¿™æ®µæ—¶é—´çš„å†…å­˜å ç”¨æƒ…å†µã€‚</li><li>2ã€<strong>å‘½ä»¤è¡Œæ–¹æ³•</strong><br>ä½¿ç”¨ Node æä¾›çš„ process.memoryUsage æ–¹æ³•ã€‚<pre><code>console.log(process.memoryUsage());// è¾“å‡º{ rss: 27709440,        // resident set sizeï¼Œæ‰€æœ‰å†…å­˜å ç”¨ï¼ŒåŒ…æ‹¬æŒ‡ä»¤åŒºå’Œå †æ ˆheapTotal: 5685248,   // &quot;å †&quot;å ç”¨çš„å†…å­˜ï¼ŒåŒ…æ‹¬ç”¨åˆ°çš„å’Œæ²¡ç”¨åˆ°çš„heapUsed: 3449392,    // ç”¨åˆ°çš„å †çš„éƒ¨åˆ†external: 8772         // V8 å¼•æ“å†…éƒ¨çš„ C++ å¯¹è±¡å ç”¨çš„å†…å­˜}</code></pre>åˆ¤æ–­å†…å­˜æ³„æ¼ï¼Œä»¥heapUsedå­—æ®µä¸ºå‡†ã€‚</li></ul><p><strong>WeakMap</strong></p><p>ES6 æ–°å‡ºçš„ä¸¤ç§æ•°æ®ç»“æ„ï¼š<code>WeakSet</code> å’Œ <code>WeakMap</code>ï¼Œè¡¨ç¤ºè¿™æ˜¯å¼±å¼•ç”¨ï¼Œå®ƒä»¬å¯¹äºå€¼çš„å¼•ç”¨éƒ½æ˜¯ä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶çš„ã€‚</p><pre><code>const wm = new WeakMap();const element = document.getElementById(&#39;example&#39;);wm.set(element, &#39;some information&#39;);wm.get(element) // &quot;some information&quot;</code></pre><p>å…ˆæ–°å»ºä¸€ä¸ª Weakmap å®ä¾‹ï¼Œç„¶åå°†ä¸€ä¸ª DOM èŠ‚ç‚¹ä½œä¸ºé”®åå­˜å…¥è¯¥å®ä¾‹ï¼Œå¹¶å°†ä¸€äº›é™„åŠ ä¿¡æ¯ä½œä¸ºé”®å€¼ï¼Œä¸€èµ·å­˜æ”¾åœ¨ WeakMap é‡Œé¢ã€‚è¿™æ—¶ï¼ŒWeakMap é‡Œé¢å¯¹elementçš„å¼•ç”¨å°±æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šè¢«è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p><h3 id="å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼"><a href="#å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼" class="headerlink" title="å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼"></a>å››ç§å¸¸è§çš„JSå†…å­˜æ³„æ¼</h3><h4 id="æ„å¤–çš„å…¨å±€å˜é‡"><a href="#æ„å¤–çš„å…¨å±€å˜é‡" class="headerlink" title="æ„å¤–çš„å…¨å±€å˜é‡"></a>æ„å¤–çš„å…¨å±€å˜é‡</h4><p>æœªå®šä¹‰çš„å˜é‡ä¼šåœ¨å…¨å±€å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°å˜é‡ï¼Œå¦‚ä¸‹ã€‚</p><pre><code>function foo(arg) {    bar = &quot;this is a hidden global variable&quot;;}å‡½æ•° foo å†…éƒ¨å¿˜è®°ä½¿ç”¨ var ï¼Œå®é™…ä¸ŠJSä¼šæŠŠbaræŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ä¸Šï¼Œæ„å¤–åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡ã€‚function foo(arg) {    window.bar = &quot;this is an explicit global variable&quot;;}å¦ä¸€ä¸ªæ„å¤–çš„å…¨å±€å˜é‡å¯èƒ½ç”± this åˆ›å»ºã€‚function foo() {    this.variable = &quot;potential accidental global&quot;;}// Foo è°ƒç”¨è‡ªå·±ï¼Œthis æŒ‡å‘äº†å…¨å±€å¯¹è±¡ï¼ˆwindowï¼‰// è€Œä¸æ˜¯ undefinedfoo();</code></pre><p>è§£å†³æ–¹æ³•ï¼šåœ¨ JavaScript æ–‡ä»¶å¤´éƒ¨åŠ ä¸Š â€˜use strictâ€™ï¼Œä½¿ç”¨ä¸¥æ ¼æ¨¡å¼é¿å…æ„å¤–çš„å…¨å±€å˜é‡ï¼Œæ­¤æ—¶ä¸Šä¾‹ä¸­çš„thisæŒ‡å‘undefinedã€‚å¦‚æœå¿…é¡»ä½¿ç”¨å…¨å±€å˜é‡å­˜å‚¨å¤§é‡æ•°æ®æ—¶ï¼Œç¡®ä¿ç”¨å®Œä»¥åæŠŠå®ƒè®¾ç½®ä¸º <code>null</code> æˆ–è€…é‡æ–°å®šä¹‰ã€‚</p><h4 id="è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°"><a href="#è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°" class="headerlink" title="è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°"></a>è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°</h4><p>è®¡æ—¶å™¨setIntervalä»£ç å¾ˆå¸¸è§</p><pre><code>var someResource = getData();setInterval(function() {    var node = document.getElementById(&#39;Node&#39;);    if(node) {        // å¤„ç† node å’Œ someResource        node.innerHTML = JSON.stringify(someResource));    }}, 1000);</code></pre><p>ä¸Šé¢çš„ä¾‹å­è¡¨æ˜ï¼Œåœ¨èŠ‚ç‚¹nodeæˆ–è€…æ•°æ®ä¸å†éœ€è¦æ—¶ï¼Œå®šæ—¶å™¨ä¾æ—§æŒ‡å‘è¿™äº›æ•°æ®ã€‚æ‰€ä»¥å“ªæ€•å½“nodeèŠ‚ç‚¹è¢«ç§»é™¤åï¼Œinterval ä»æ—§å­˜æ´»å¹¶ä¸”åƒåœ¾å›æ”¶å™¨æ²¡åŠæ³•å›æ”¶ï¼Œå®ƒçš„ä¾èµ–ä¹Ÿæ²¡åŠæ³•è¢«å›æ”¶ï¼Œé™¤éç»ˆæ­¢å®šæ—¶å™¨ã€‚</p><pre><code>var element = document.getElementById(&#39;button&#39;);function onClick(event) {    element.innerHTML = &#39;text&#39;;}element.addEventListener(&#39;click&#39;, onClick);</code></pre><p>å¯¹äºä¸Šé¢è§‚å¯Ÿè€…çš„ä¾‹å­ï¼Œä¸€æ—¦å®ƒä»¬ä¸å†éœ€è¦ï¼ˆæˆ–è€…å…³è”çš„å¯¹è±¡å˜æˆä¸å¯è¾¾ï¼‰ï¼Œæ˜ç¡®åœ°ç§»é™¤å®ƒä»¬éå¸¸é‡è¦ã€‚è€çš„ IE 6 æ˜¯æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„ã€‚å› ä¸ºè€ç‰ˆæœ¬çš„ IE æ˜¯æ— æ³•æ£€æµ‹ DOM èŠ‚ç‚¹ä¸ JavaScript ä»£ç ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚<br>ä½†æ˜¯ï¼Œç°ä»£çš„æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ IE å’Œ Microsoft Edgeï¼‰ä½¿ç”¨äº†æ›´å…ˆè¿›çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆæ ‡è®°æ¸…é™¤ï¼‰ï¼Œå·²ç»å¯ä»¥æ­£ç¡®æ£€æµ‹å’Œå¤„ç†å¾ªç¯å¼•ç”¨äº†ã€‚å³å›æ”¶èŠ‚ç‚¹å†…å­˜æ—¶ï¼Œä¸å¿…éè¦è°ƒç”¨<code>removeEventListener</code>äº†ã€‚</p><h4 id="è„±ç¦»-DOM-çš„å¼•ç”¨"><a href="#è„±ç¦»-DOM-çš„å¼•ç”¨" class="headerlink" title="è„±ç¦» DOM çš„å¼•ç”¨"></a>è„±ç¦» DOM çš„å¼•ç”¨</h4><p>å¦‚æœæŠŠDOM å­˜æˆå­—å…¸ï¼ˆJSON é”®å€¼å¯¹ï¼‰æˆ–è€…æ•°ç»„ï¼Œæ­¤æ—¶ï¼ŒåŒæ ·çš„ DOM å…ƒç´ å­˜åœ¨ä¸¤ä¸ªå¼•ç”¨ï¼šä¸€ä¸ªåœ¨ DOMæ ‘ä¸­ï¼Œå¦ä¸€ä¸ªåœ¨å­—å…¸ä¸­ã€‚é‚£ä¹ˆå°†æ¥éœ€è¦æŠŠä¸¤ä¸ªå¼•ç”¨éƒ½æ¸…é™¤ã€‚</p><pre><code>var elements = {    button: document.getElementById(&#39;button&#39;),    image: document.getElementById(&#39;image&#39;),    text: document.getElementById(&#39;text&#39;)};function doStuff() {    image.src = &#39;http://some.url/image&#39;;    button.click();    console.log(text.innerHTML);    // æ›´å¤šé€»è¾‘}function removeButton() {    // æŒ‰é’®æ˜¯ body çš„åä»£å…ƒç´     document.body.removeChild(document.getElementById(&#39;button&#39;));    // æ­¤æ—¶ï¼Œä»æ—§å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ #button çš„å¼•ç”¨    // elements å­—å…¸ã€‚button å…ƒç´ ä»æ—§åœ¨å†…å­˜ä¸­ï¼Œä¸èƒ½è¢« GC å›æ”¶ã€‚}</code></pre><p>å¦‚æœä»£ç ä¸­ä¿å­˜äº†è¡¨æ ¼æŸä¸€ä¸ª<code>&lt;td&gt;</code> çš„å¼•ç”¨ã€‚å°†æ¥å†³å®šåˆ é™¤æ•´ä¸ªè¡¨æ ¼çš„æ—¶å€™ï¼Œç›´è§‰è®¤ä¸º GC ä¼šå›æ”¶é™¤äº†å·²ä¿å­˜çš„<code>&lt;td&gt;</code>ä»¥å¤–çš„å…¶å®ƒèŠ‚ç‚¹ã€‚å®é™…æƒ…å†µå¹¶éå¦‚æ­¤ï¼šæ­¤ <code>&lt;td&gt;</code> æ˜¯è¡¨æ ¼çš„å­èŠ‚ç‚¹ï¼Œå­å…ƒç´ ä¸çˆ¶å…ƒç´ æ˜¯å¼•ç”¨å…³ç³»ã€‚ç”±äºä»£ç ä¿ç•™äº†<code>&lt;td&gt;</code> çš„å¼•ç”¨ï¼Œå¯¼è‡´æ•´ä¸ªè¡¨æ ¼ä»å¾…åœ¨å†…å­˜ä¸­ã€‚æ‰€ä»¥ä¿å­˜ DOM å…ƒç´ å¼•ç”¨çš„æ—¶å€™ï¼Œè¦å°å¿ƒè°¨æ…ã€‚</p><h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>é—­åŒ…çš„å…³é”®æ˜¯åŒ¿åå‡½æ•°å¯ä»¥è®¿é—®çˆ¶çº§ä½œç”¨åŸŸçš„å˜é‡ã€‚</p><pre><code>var theThing = null;var replaceThing = function () {  var originalThing = theThing;  var unused = function () {    if (originalThing)      console.log(&quot;hi&quot;);  };  theThing = {    longStr: new Array(1000000).join(&#39;*&#39;),    someMethod: function () {      console.log(someMessage);    }  };};setInterval(replaceThing, 1000);</code></pre><p>æ¯æ¬¡è°ƒç”¨ replaceThing ï¼ŒtheThing å¾—åˆ°ä¸€ä¸ªåŒ…å«ä¸€ä¸ªå¤§æ•°ç»„å’Œä¸€ä¸ªæ–°é—­åŒ…ï¼ˆsomeMethodï¼‰çš„æ–°å¯¹è±¡ã€‚åŒæ—¶ï¼Œå˜é‡ unused æ˜¯ä¸€ä¸ªå¼•ç”¨ originalThing çš„é—­åŒ…ï¼ˆå…ˆå‰çš„ replaceThing åˆè°ƒç”¨äº† theThing ï¼‰ã€‚someMethod å¯ä»¥é€šè¿‡ theThing ä½¿ç”¨ï¼ŒsomeMethod ä¸ unused åˆ†äº«é—­åŒ…ä½œç”¨åŸŸï¼Œå°½ç®¡ unused ä»æœªä½¿ç”¨ï¼Œå®ƒå¼•ç”¨çš„ originalThing è¿«ä½¿å®ƒä¿ç•™åœ¨å†…å­˜ä¸­ï¼ˆé˜²æ­¢è¢«å›æ”¶ï¼‰ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šåœ¨ replaceThing çš„æœ€åæ·»åŠ  originalThing = null ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…å­˜ </tag>
            
            <tag> æå‡ </tag>
            
            <tag> è°ƒç”¨æ ˆ </tag>
            
            <tag> å†…å­˜æ³„æ¼ </tag>
            
            <tag> ä¸Šä¸‹æ–‡ </tag>
            
            <tag> åƒåœ¾å›æ”¶ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºæœ¬æ•°æ®ç±»å‹</title>
      <link href="/2019/09/20/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2019/09/20/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å†…ç½®ç±»å‹"><a href="#å†…ç½®ç±»å‹" class="headerlink" title="å†…ç½®ç±»å‹"></a>å†…ç½®ç±»å‹</h1><p>JS ä¸­åˆ†ä¸ºä¸ƒç§å†…ç½®ç±»å‹ï¼Œä¸ƒç§å†…ç½®ç±»å‹åˆåˆ†ä¸ºä¸¤å¤§ç±»å‹ï¼šåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ï¼ˆObjectï¼‰ã€‚ åŸºæœ¬ç±»å‹æœ‰å…­ç§ï¼š <code>null</code>ï¼Œ<code>undefined</code>ï¼Œ<code>boolean</code>ï¼Œ<code>number</code>ï¼Œ<code>string</code>ï¼Œ<code>symbol</code>ã€‚</p><h2 id="Typeof"><a href="#Typeof" class="headerlink" title="Typeof"></a>Typeof</h2><p>typeof å¯¹äºåŸºæœ¬ç±»å‹ï¼Œé™¤äº† null éƒ½å¯ä»¥æ˜¾ç¤ºæ­£ç¡®çš„ç±»å‹<br><img src="https://user-gold-cdn.xitu.io/2019/8/8/16c6ee7529bae2d7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt><br>000 å¼€å¤´ä»£è¡¨æ˜¯å¯¹è±¡ï¼Œç„¶è€Œ null è¡¨ç¤º ä¸ºå…¨é›¶ï¼Œæ‰€ä»¥å°†å®ƒé”™è¯¯çš„åˆ¤æ–­ä¸º object ã€‚</p><h2 id="instanceof-å’Œ-Object-prototype-toString-call"><a href="#instanceof-å’Œ-Object-prototype-toString-call" class="headerlink" title="instanceof å’Œ Object.prototype.toString.call"></a>instanceof å’Œ Object.prototype.toString.call</h2><p>typeof æ— æ³•åˆ¤æ–­æ•°ç»„ï¼Œå¯¹è±¡.<br>å¯ä»¥é€šè¿‡<code>Object.prototype.toString.call(xx)</code>ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è·å¾—ç±»ä¼¼ <code>[Object Type]</code> çš„å­—ç¬¦ä¸²ã€‚<br><code>instanceof</code> å¯ä»¥æ­£ç¡®çš„åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ï¼Œå› ä¸ºå†…éƒ¨æœºåˆ¶æ˜¯é€šè¿‡åˆ¤æ–­å¯¹è±¡çš„åŸå‹é“¾ ä¸­æ˜¯ä¸æ˜¯èƒ½æ‰¾åˆ°ç±»å‹çš„ <code>prototype</code>ã€‚</p><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><h3 id="ToStringè´Ÿè´£å¤„ç†éå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²çš„å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#ToStringè´Ÿè´£å¤„ç†éå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²çš„å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="ToStringè´Ÿè´£å¤„ç†éå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²çš„å¼ºåˆ¶ç±»å‹è½¬æ¢"></a><code>ToString</code>è´Ÿè´£å¤„ç†éå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²çš„å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><p>nullè½¬æ¢ä¸ºâ€™nullâ€™,undefinedè½¬æ¢ä¸ºâ€™undefinedâ€™,å…¶ä»–åŸºæœ¬ç±»å‹éƒ½è°ƒç”¨åŸºæœ¬ç±»å‹çš„åŒ…è£…å¯¹è±¡å±æ€§toString()å¹¶è¿”å›å€¼ã€‚</p><pre><code>const a = 123; const _a = new Number(123); console.log(String(a), _a.toString());               //&#39;123&#39; &#39;123&#39; æ•°å­—çš„å­—ç¬¦ä¸²åŒ–éµå¾ªé€šç”¨è§„åˆ™ï¼Œä½†æ˜¯æå°æå¤§æ•°å­—ä½¿ç”¨æŒ‡æ•°å½¢å¼const a = 1.07*1000*1000*1000*1000*1000*1000*1000;console.log(String(a));                               //&#39;1.07e+21&#39;</code></pre><p>å¯¹äºæ™®é€šå¯¹è±¡æ¥è¯´ï¼Œé™¤éè‡ªè¡Œå®šä¹‰ï¼Œå¦åˆ™<code>toString()</code>è¿”å›<code>Object.prototype.toString()</code>çš„å€¼,å…¶ä»–å¯¹è±¡æœ‰è‡ªå·±çš„<code>toString()</code>æ–¹æ³•åˆ™è°ƒç”¨è‡ªå·±çš„è¯¥æ–¹æ³•.</p><pre><code>const b = {};console.log(String(b));                                //[object object]</code></pre><p>å¯¹äºæ•°ç»„æ¥è¯´ä¼šè½¬æˆä»¥â€œï¼Œâ€æ‹¼æ¥å„é¡¹çš„å­—ç¬¦ä¸²</p><pre><code>const arr = [{s:1},2,3]console.log(arr.toString())                           //&quot;[object Object],2,3&quot;</code></pre><h3 id="ToNumberè´Ÿè´£å¤„ç†éæ•°å­—åˆ°æ•°å­—çš„å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#ToNumberè´Ÿè´£å¤„ç†éæ•°å­—åˆ°æ•°å­—çš„å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="ToNumberè´Ÿè´£å¤„ç†éæ•°å­—åˆ°æ•°å­—çš„å¼ºåˆ¶ç±»å‹è½¬æ¢"></a><code>ToNumber</code>è´Ÿè´£å¤„ç†éæ•°å­—åˆ°æ•°å­—çš„å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><p>trueè½¬æ¢ä¸º1ï¼Œfalseè½¬æ¢ä¸º0ï¼Œundefinedè½¬æ¢ä¸ºNaNï¼Œnullè½¬æ¢ä¸º0</p><pre><code>console.log(Number(null));                                //0 console.log(Number(undefined));                           //NaNconsole.log(Number(true));                                //1console.log(Number(false));                               //0</code></pre><p>å¯¹å­—ç¬¦ä¸²çš„å¤„ç†éµå¾ªæ•°å­—å¸¸é‡çš„ç›¸å…³è§„å®š/è¯­æ³•ï¼Œå¤„ç†å¤±è´¥æ—¶è¿”å›NaN</p><pre><code>console.log(Number(&#39;123&#39;));                               //123console.log(Number(&#39;0b111&#39;));                             //7console.log(Number(&#39;0o123&#39;));                             //83console.log(Number(&#39;0x123&#39;));                             //291console.log(Number(&#39;123a&#39;));                              //NaNconsole.log(Number(&#39;a123&#39;));                              //NaN</code></pre><p>å¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰ä¼šé¦–å…ˆæŒ‰ç…§<code>ToPrimitive</code>æŠ½è±¡æ“ä½œè¢«è½¬æ¢ä¸ºç›¸åº”çš„åŸºæœ¬ç±»å‹å€¼ï¼Œå†æŒ‰ç…§å‰ä¸¤æ¡è§„åˆ™å¤„ç†ï¼›å¦‚æœæŸä¸ªå¯¹è±¡å³ä¸å­˜åœ¨<code>valueOf</code>æ–¹æ³•ä¹Ÿä¸å­˜åœ¨<code>toString</code>æ–¹æ³•ï¼Œåˆ™ä¼šäº§ç”Ÿ<code>TypeError</code>é”™è¯¯ï¼ˆä¾‹å¦‚Object.create(null)ä¸å­˜åœ¨ä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼‰</p><pre><code>const arr = [1, 2, 3]; console.log(Number(arr));                               //NaNconsole.log(Number(arr.toString()));                    //NaNconst num = new Number(123);console.log(Number(num));                               //123console.log(Number(num.valueOf()));                     //123const bool = new Boolean(true);console.log(bool.valueOf());                           //trueconsole.log(Number(bool));                             //1console.log(Number(bool.valueOf()));                   //1const obj1 = {  toString:()=&gt;&quot;21&quot;}const obj2 = {  valueOf:()=&gt;&quot;42&quot;,  toString:()=&gt;&quot;21&quot;}const obj3 = {  a:1}console.log(Number(obj1));                              //21console.log(Number(obj2));                              //42console.log(obj3.toString());                           //[object Object]console.log(Number(obj3));                              //NaNconst obj = Object.create(null);console.log(Number(obj));                               //TypeError</code></pre><h3 id="ToBooleanè´Ÿè´£å¤„ç†éå¸ƒå°”å€¼åˆ°å¸ƒå°”å€¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè§„åˆ™å¦‚ä¸‹"><a href="#ToBooleanè´Ÿè´£å¤„ç†éå¸ƒå°”å€¼åˆ°å¸ƒå°”å€¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè§„åˆ™å¦‚ä¸‹" class="headerlink" title="ToBooleanè´Ÿè´£å¤„ç†éå¸ƒå°”å€¼åˆ°å¸ƒå°”å€¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè§„åˆ™å¦‚ä¸‹"></a><code>ToBoolean</code>è´Ÿè´£å¤„ç†éå¸ƒå°”å€¼åˆ°å¸ƒå°”å€¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè§„åˆ™å¦‚ä¸‹</h3><p>å¯ä»¥è¢«è½¬æ¢ä¸º<code>false</code>çš„å€¼ï¼ˆ<code>undefined</code>ï¼Œ<code>null</code>ï¼Œ<code>false</code>ï¼Œ <code>0</code>å’Œ<code>NaN</code>ï¼Œâ€™â€™ï¼‰</p><p>å…¶ä»–éƒ½è¢«è½¬æ¢ä¸ºtrueï¼ˆåˆ‡è®°ï¼šå°è£…å¯¹è±¡å‡è¢«è½¬ä¸ºtrueï¼‰</p><h2 id="éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢</h2><p>éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p><p>ä¸€å…ƒè¿ç®—ç¬¦åŠ å·ï¼ˆ+ï¼‰é¦–å…ˆæŠŠéåŸºæœ¬ç±»å‹é€šè¿‡ToPrimitiveæŠ½è±¡æ“ä½œè½¬æ¢ä¸ºåŸºæœ¬ç±»å‹ï¼Œå¦‚æœåŠ å·ä¸­çš„ä¸¤é¡¹æœ‰ä¸€é¡¹æ˜¯å­—ç¬¦ä¸²ï¼Œå¦ä¸€é¡¹åˆ™è¿›è¡ŒToStringæ“ä½œï¼Œè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¦‚æœæ˜¯å¸ƒå°”å€¼åŠ æ•°å­—ï¼Œåˆ™å¯¹å¸ƒå°”è¿›è¡ŒToNumberæ“ä½œå†æ±‚å’Œ</p><p>éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºæ•°å­—ï¼Œé€šè¿‡ä¸€å…ƒè¿ç®—ç¬¦-ã€/ã€*è½¬æ¢ï¼Œéµå¾ªToNumberçš„æŠ½è±¡å€¼æ“ä½œè§„åˆ™</p><p>éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼</p><p>if(..)è¯­å¥ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼</p><p>for(..;..;..)è¯­å¥çš„ç¬¬äºŒä¸ªæ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼</p><p>while(..)å’Œdo..while(..)çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼</p><p>?:ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼</p><p>é€»è¾‘è¿ç®—ç¬¦||å’Œ&amp;&amp;å·¦è¾¹çš„æ“ä½œæ•°ï¼ˆa||bç­‰åŒäºa?a:bï¼Œa&amp;&amp;bç­‰åŒäºa?b:aï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç±»å‹ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
